<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Nestly" />
  <meta name="theme-color" content="#0d0d0f" />
  <title>Nestly</title>
  <link rel="apple-touch-icon" href="icon.png" />
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { background:#0d0d0f; -webkit-tap-highlight-color:transparent; overscroll-behavior:none; }
    #root { min-height:100vh; }
    #loading-screen { position:fixed;inset:0;background:#0d0d0f;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:12px;z-index:999; }
    .spinner { width:32px;height:32px;border:3px solid #333;border-top-color:#e8c547;border-radius:50%;animation:spin 0.8s linear infinite; }
    @keyframes spin { to { transform:rotate(360deg); } }
    #auth-screen { position:fixed;inset:0;background:#0d0d0f;z-index:998;display:none;align-items:center;justify-content:center;padding:24px;font-family:'DM Sans','Segoe UI',sans-serif; }
    #auth-screen input { width:100%;background:#181820;border:1px solid #252530;color:#f0ede8;border-radius:10px;padding:13px 16px;font-size:15px;outline:none;margin-bottom:10px;box-sizing:border-box;font-family:inherit; }
    #auth-screen input:focus { border-color:#e8c547; }
    #auth-screen button { width:100%;border:none;border-radius:10px;padding:14px;font-size:15px;font-weight:700;cursor:pointer;font-family:inherit;margin-bottom:8px; }
    .auth-primary { background:#e8c547;color:#0d0d0f; }
    .auth-secondary { background:#1a1a22;color:#888; }
    .auth-link { background:transparent!important;color:#555!important;font-size:13px!important;padding:8px!important; }
    #auth-error { color:#e74c3c;font-size:13px;margin-bottom:10px;min-height:18px;text-align:center; }
  </style>
</head>
<body>
  <div id="loading-screen">
    <div class="spinner"></div>
    <div id="loading-msg" style="color:#555;font-size:13px;font-family:sans-serif">Caricamento...</div>
  </div>
  <div id="root"></div>
  <div id="auth-screen">
    <div style="width:100%;max-width:380px">
      <div style="font-family:'DM Serif Display',serif;font-size:28px;color:#e8c547;margin-bottom:6px;text-align:center">MoneyPal</div>
      <div id="auth-subtitle" style="font-size:13px;color:#555;margin-bottom:28px;text-align:center">Accedi o crea una famiglia</div>
      <div id="auth-error"></div>
      <div id="auth-form-login">
        <button class="auth-google" onclick="doGoogleLogin()" style="display:flex;align-items:center;justify-content:center;gap:10px;background:#fff;color:#1f1f1f;border-radius:10px;padding:13px;font-size:15px;font-weight:600;cursor:pointer;border:none;width:100%;margin-bottom:10px;font-family:inherit">
          <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.08 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.18 1.48-4.97 2.31-8.16 2.31-6.26 0-11.57-3.59-13.46-8.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
          Accedi con Google
        </button>
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
          <div style="flex:1;height:1px;background:#252530"></div>
          <span style="font-size:11px;color:#444">oppure con email</span>
          <div style="flex:1;height:1px;background:#252530"></div>
        </div>
        <input type="email" id="auth-email" placeholder="Email" autocomplete="email" />
        <input type="password" id="auth-password" placeholder="Password" autocomplete="current-password" />
        <button class="auth-primary" onclick="doLogin()">üîê Accedi</button>
        <button class="auth-link" onclick="showRegister()">Non hai un account? Crea famiglia ‚Üí</button>
        <button class="auth-link" onclick="showJoin()">Hai un codice famiglia? Unisciti ‚Üí</button>
      </div>
      <div id="auth-form-register" style="display:none">
        <button class="auth-google" onclick="doGoogleLogin()" style="display:flex;align-items:center;justify-content:center;gap:10px;background:#fff;color:#1f1f1f;border-radius:10px;padding:13px;font-size:15px;font-weight:600;cursor:pointer;border:none;width:100%;margin-bottom:10px;font-family:inherit">
          <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.08 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.18 1.48-4.97 2.31-8.16 2.31-6.26 0-11.57-3.59-13.46-8.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
          Crea famiglia con Google
        </button>
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
          <div style="flex:1;height:1px;background:#252530"></div>
          <span style="font-size:11px;color:#444">oppure con email</span>
          <div style="flex:1;height:1px;background:#252530"></div>
        </div>
        <div style="font-size:12px;color:#666;margin-bottom:10px">Crea una nuova famiglia ‚Äî potrai invitare altri con un codice</div>
        <div style="font-size:12px;color:#27ae60;background:rgba(39,174,96,0.1);border:1px solid rgba(39,174,96,0.25);border-radius:8px;padding:10px;margin-bottom:10px">
          ‚úÖ <strong>I tuoi dati esistenti verranno migrati automaticamente</strong> ‚Äî non perderai nulla
        </div>
        <input type="email" id="reg-email" placeholder="Email" autocomplete="email" />
        <input type="password" id="reg-password" placeholder="Password (min 6 caratteri)" autocomplete="new-password" />
        <input type="text" id="reg-name" placeholder="Nome famiglia (es. Diego &amp; Carmen)" />
        <button class="auth-primary" onclick="doRegister()">‚ú® Crea famiglia</button>
        <button class="auth-link" onclick="showLogin()">‚Üê Torna al login</button>
      </div>
      <div id="auth-form-join" style="display:none">
        <div style="font-size:12px;color:#666;margin-bottom:10px">Inserisci il codice a 6 lettere che ti ha dato il tuo partner</div>
        <input type="email" id="join-email" placeholder="Email" autocomplete="email" />
        <input type="password" id="join-password" placeholder="Password" autocomplete="new-password" />
        <input type="text" id="join-code" placeholder="Codice famiglia (es. ABC123)" style="text-transform:uppercase;letter-spacing:3px;font-size:18px;text-align:center" maxlength="6" />
        <button class="auth-primary" onclick="doJoin()">üîó Unisciti alla famiglia</button>
        <button class="auth-link" onclick="showLogin()">‚Üê Torna al login</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/recharts@2.12.0/umd/Recharts.js"></script>

  <script>
  window.addEventListener('load', function() {
    try {
      if (!window.React || !window.ReactDOM) throw new Error('React non caricato');
      const { useState, useEffect } = React;
      const { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, Legend, Cell } = window.Recharts || {};

      firebase.initializeApp({
        apiKey: "AIzaSyBDTMPfdMxsvstKYpvQh_95URYfN5JdzEE",
        authDomain: "moneypal-89fcf.firebaseapp.com",
        databaseURL: "https://moneypal-89fcf-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "moneypal-89fcf",
        storageBucket: "moneypal-89fcf.firebasestorage.app",
        messagingSenderId: "290834672771",
        appId: "1:290834672771:web:0e92b118cefea511a1bfb6"
      });

      const _db = firebase.database();
      const _auth = firebase.auth();
      const _cache = {};
      let _ref = null;
      let _currentFamilyId = null;
      let _appStarted = false;

      // ‚îÄ‚îÄ Auth helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function genCode() {
        return Math.random().toString(36).substring(2,8).toUpperCase();
      }

      function setAuthError(msg) {
        document.getElementById('auth-error').textContent = msg;
      }

      function showLogin() {
        setAuthError('');
        document.getElementById('auth-form-login').style.display = '';
        document.getElementById('auth-form-register').style.display = 'none';
        document.getElementById('auth-form-join').style.display = 'none';
        document.getElementById('auth-subtitle').textContent = 'Accedi alla tua famiglia';
      }

      function showRegister() {
        setAuthError('');
        document.getElementById('auth-form-login').style.display = 'none';
        document.getElementById('auth-form-register').style.display = '';
        document.getElementById('auth-form-join').style.display = 'none';
        document.getElementById('auth-subtitle').textContent = 'Crea una nuova famiglia';
      }

      function showJoin() {
        setAuthError('');
        document.getElementById('auth-form-login').style.display = 'none';
        document.getElementById('auth-form-register').style.display = 'none';
        document.getElementById('auth-form-join').style.display = '';
        document.getElementById('auth-subtitle').textContent = 'Unisciti a una famiglia esistente';
      }

      window.showLogin = showLogin;
      window.showRegister = showRegister;
      window.showJoin = showJoin;

      async function doLogin() {
        const email = document.getElementById('auth-email').value.trim();
        const pass = document.getElementById('auth-password').value;
        setAuthError('');
        if (!email || !pass) { setAuthError('Inserisci email e password'); return; }
        try {
          await _auth.signInWithEmailAndPassword(email, pass);
        } catch(e) {
          const msgs = { 'auth/user-not-found':'Utente non trovato', 'auth/wrong-password':'Password errata', 'auth/invalid-email':'Email non valida', 'auth/invalid-credential':'Email o password errati' };
          setAuthError(msgs[e.code] || e.message);
        }
      }

      async function doRegister() {
        const email = document.getElementById('reg-email').value.trim();
        const pass = document.getElementById('reg-password').value;
        const name = document.getElementById('reg-name').value.trim();
        setAuthError('');
        if (!email || !pass || !name) { setAuthError('Compila tutti i campi'); return; }
        if (pass.length < 6) { setAuthError('Password minimo 6 caratteri'); return; }
        try {
          const cred = await _auth.createUserWithEmailAndPassword(email, pass);
          const uid = cred.user.uid;
          const code = genCode();
          // Save family mapping
          await _db.ref('userFamily/' + uid).set(uid);
          await _db.ref('familyCodes/' + code).set(uid);
          await _db.ref('familyMeta/' + uid).set({ name, code, owner: email, createdAt: Date.now() });
          // üîÑ Migrate existing data from budget/family ‚Üí budget/{uid}
          const existingSnap = await _db.ref('budget/family').once('value');
          const existingData = existingSnap.val();
          if (existingData && Object.keys(existingData).length > 0) {
            await _db.ref('budget/' + uid).update(existingData);
            console.log('‚úÖ Dati migrati da budget/family a budget/' + uid);
          } else {
            // No existing data ‚Üí set names from form
            await _db.ref('budget/' + uid + '/bgt-names').set(JSON.stringify({p1: name.split(/[&\/]/)[0]?.trim() || '', p2: name.split(/[&\/]/)[1]?.trim() || ''}));
          }
        } catch(e) {
          const msgs = { 'auth/email-already-in-use':'Email gi√† registrata ‚Äî prova ad accedere', 'auth/weak-password':'Password troppo debole', 'auth/invalid-email':'Email non valida' };
          setAuthError(msgs[e.code] || e.message);
        }
      }

      async function doJoin() {
        const email = document.getElementById('join-email').value.trim();
        const pass = document.getElementById('join-password').value;
        const code = document.getElementById('join-code').value.trim().toUpperCase();
        setAuthError('');
        if (!email || !pass || !code) { setAuthError('Compila tutti i campi'); return; }
        try {
          // Check code first
          const snap = await _db.ref('familyCodes/' + code).once('value');
          if (!snap.val()) { setAuthError('Codice famiglia non trovato'); return; }
          const familyId = snap.val();
          // Create or login user
          let uid;
          try {
            const cred = await _auth.createUserWithEmailAndPassword(email, pass);
            uid = cred.user.uid;
          } catch(e) {
            if (e.code === 'auth/email-already-in-use') {
              const cred = await _auth.signInWithEmailAndPassword(email, pass);
              uid = cred.user.uid;
            } else throw e;
          }
          await _db.ref('userFamily/' + uid).set(familyId);
        } catch(e) {
          const msgs = { 'auth/wrong-password':'Password errata', 'auth/invalid-email':'Email non valida', 'auth/weak-password':'Password troppo debole (min 6 caratteri)', 'auth/invalid-credential':'Credenziali non valide' };
          setAuthError(msgs[e.code] || e.message);
        }
      }

      window.doLogin = doLogin;
      window.doRegister = doRegister;
      window.doJoin = doJoin;

      async function doGoogleLogin() {
        setAuthError('');
        try {
          const provider = new firebase.auth.GoogleAuthProvider();
          const cred = await _auth.signInWithPopup(provider);
          const user = cred.user;
          const uid = user.uid;
          // Check if this user already has a family
          const famSnap = await _db.ref('userFamily/' + uid).once('value');
          if (!famSnap.val()) {
            // First time with Google ‚Üí create new family, migrate old data
            const code = genCode();
            const name = user.displayName || user.email.split('@')[0];
            await _db.ref('userFamily/' + uid).set(uid);
            await _db.ref('familyCodes/' + code).set(uid);
            await _db.ref('familyMeta/' + uid).set({ name, code, owner: user.email, createdAt: Date.now() });
            // Migrate existing budget/family data if present
            const existingSnap = await _db.ref('budget/family').once('value');
            const existingData = existingSnap.val();
            if (existingData && Object.keys(existingData).length > 0) {
              await _db.ref('budget/' + uid).update(existingData);
            }
          }
          // onAuthStateChanged will handle the rest
        } catch(e) {
          if (e.code === 'auth/popup-closed-by-user') return;
          if (e.code === 'auth/account-exists-with-different-credential') {
            setAuthError('Questa email √® gi√† registrata con email/password. Accedi con email/password.');
            return;
          }
          setAuthError(e.message);
        }
      }
      window.doGoogleLogin = doGoogleLogin;

      // ‚îÄ‚îÄ Start app with a specific family ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function startApp(familyId) {
        if (_appStarted) return;
        _appStarted = true;
        _currentFamilyId = familyId;
        _ref = _db.ref('budget/' + familyId);
        window._familyId = familyId;

        // Override localStorage ‚Üí Firebase
        const lsProxy = {
          getItem:    (k) => k in _cache ? _cache[k] : null,
          setItem:    (k, v) => { _cache[k] = v; _ref.update({[k]: v}).catch(console.error); },
          removeItem: (k) => { delete _cache[k]; _ref.child(k).remove().catch(()=>{}); },
          clear: () => {},
          key: (i) => Object.keys(_cache)[i] || null,
          get length() { return Object.keys(_cache).length; }
        };
        try {
          Object.defineProperty(window, 'localStorage', { value: lsProxy, writable: false, configurable: true });
        } catch(e) {
          const orig = window.localStorage;
          orig.getItem = lsProxy.getItem;
          orig.setItem = lsProxy.setItem;
          orig.removeItem = lsProxy.removeItem;
        }

        // Real-time sync banner
        let _firstLoad = true;
        _ref.on('value', snap => {
          const remote = snap.val() || {};
          if (_firstLoad) { Object.assign(_cache, remote); return; }
          const changed = Object.keys(remote).some(k => remote[k] !== _cache[k]);
          if (changed) {
            Object.assign(_cache, remote);
            if (!document.getElementById('sync-banner')) {
              const b = document.createElement('div');
              b.id = 'sync-banner';
              b.style.cssText = 'position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:#e8c547;color:#0d0d0f;padding:10px 22px;border-radius:20px;font-weight:700;font-size:13px;cursor:pointer;z-index:9999;box-shadow:0 4px 20px rgba(0,0,0,0.5);white-space:nowrap';
              b.textContent = 'üîÑ Dati aggiornati ‚Äî tocca per ricaricare';
              b.onclick = () => location.reload();
              document.body.appendChild(b);
              setTimeout(() => b.remove(), 8000);
            }
          }
        });

        document.getElementById('loading-msg').textContent = 'Caricamento dati...';
        document.getElementById('auth-screen').style.display = 'none';
        _ref.once('value')
          .then(snap => { const d = snap.val(); if (d) Object.assign(_cache, d); })
          .catch(e => console.warn('Firebase error:', e))
          .finally(() => {
            _firstLoad = false;
            document.getElementById('loading-screen').style.display = 'none';










































function FormField({ label, labelColor, children }) {
    return React.createElement("div", null,
        React.createElement("div", { style: {
            fontSize: 12, fontWeight: 700, color: labelColor || "#ccc",
            marginBottom: 7, letterSpacing: 0.5, textTransform: "uppercase"
        } }, label),
        children);
}

function useIsMobile() {
    const [m, setM] = (0, React.useState)(typeof window !== 'undefined' ? window.innerWidth < 768 : true);
    (0, React.useEffect)(() => {
        const fn = () => setM(window.innerWidth < 768);
        window.addEventListener('resize', fn);
        return () => window.removeEventListener('resize', fn);
    }, []);
    return m;
}
function SimpleBarChart({ data, bars, height = 180, showValues = false }) {
    const [tooltip, setTooltip] = React.useState(null);
    if (!data || data.length === 0)
        return null;
    const maxVal = Math.max(1, ...data.flatMap(d => bars.map(b => Math.abs(d[b.dataKey] || 0))));
    const fmt2 = v => v >= 1000 ? (v / 1000).toFixed(1) + 'k' : String(Math.round(v));
    const fmtFull = v => new Intl.NumberFormat('it-IT', { style: 'currency', currency: 'EUR' }).format(v || 0);
    const gridLines = [maxVal, maxVal * 0.75, maxVal * 0.5, maxVal * 0.25, 0];
    return (React.createElement("div", { style: { width: '100%', position: 'relative' } },
        tooltip && (React.createElement("div", { style: { position: 'absolute', top: 0, left: '50%', transform: 'translateX(-50%)', background: '#1a1a26', border: '1px solid #2a2a38', borderRadius: 8, padding: '8px 14px', zIndex: 10, pointerEvents: 'none', whiteSpace: 'nowrap' } },
            React.createElement("div", { style: { fontSize: 11, color: '#e8c547', fontWeight: 700, marginBottom: 4 } }, tooltip.name),
            tooltip.items.map((item, i) => (React.createElement("div", { key: i, style: { fontSize: 11, color: item.color, marginBottom: 2 } },
                item.label,
                ": ",
                fmtFull(item.val)))))),
        React.createElement("div", { style: { display: 'flex', alignItems: 'flex-end', gap: 4, height: height, paddingLeft: 44, paddingRight: 8, position: 'relative' } },
            gridLines.slice(0, -1).map((v, i) => (React.createElement("div", { key: i, style: { position: 'absolute', left: 44, right: 8, bottom: 22 + ((v / maxVal) * (height - 22)), borderTop: '1px dashed #1e1e28', pointerEvents: 'none' } },
                React.createElement("span", { style: { position: 'absolute', left: -42, top: -8, fontSize: 9, color: '#444' } }, fmt2(v))))),
            data.map((d, di) => (React.createElement("div", { key: di, style: { flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', minWidth: bars.length > 1 ? bars.length * 10 + 4 : 12 }, onMouseEnter: () => setTooltip({ name: d.name, items: bars.map(b => ({ label: b.name, val: d[b.dataKey] || 0, color: b.fill })) }), onMouseLeave: () => setTooltip(null) },
                React.createElement("div", { style: { width: '100%', display: 'flex', gap: 2, alignItems: 'flex-end', height: height - 22 } }, bars.map((b, bi) => {
                    const val = d[b.dataKey] || 0;
                    const pct = maxVal > 0 ? (Math.abs(val) / maxVal) * 100 : 0;
                    return (React.createElement("div", { key: bi, style: { flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'flex-end', height: '100%' } },
                        showValues && val > 0 && React.createElement("div", { style: { fontSize: 8, color: b.fill, marginBottom: 2, fontWeight: 700 } }, fmt2(val)),
                        React.createElement("div", { style: { width: '100%', height: pct + '%', background: b.fill, borderRadius: '3px 3px 0 0', minHeight: val > 0 ? 3 : 0, transition: 'opacity 0.15s', opacity: tooltip && tooltip.name !== d.name ? 0.5 : 1 } })));
                })),
                React.createElement("div", { style: { fontSize: 9, color: '#666', marginTop: 3, textAlign: 'center', letterSpacing: 0.3 } }, d.name))))),
        bars.length > 1 && React.createElement("div", { style: { display: 'flex', gap: 14, justifyContent: 'center', marginTop: 10, flexWrap: 'wrap' } }, bars.map((b, i) => (React.createElement("div", { key: i, style: { display: 'flex', alignItems: 'center', gap: 5 } },
            React.createElement("div", { style: { width: 12, height: 12, background: b.fill, borderRadius: 3 } }),
            React.createElement("span", { style: { fontSize: 11, color: '#888' } }, b.name)))))));
}
const TRANSLATIONS = {
    it: {
        months: ["Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno", "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre"],
        days: ["Dom", "Lun", "Mar", "Mer", "Gio", "Ven", "Sab"],
        appSubtitle: "La tua casa",
        // Main tabs
        tabEntrate: "Entrate", tabBudget: "Budget", tabSpese: "Spese", tabCasa: "Casa", tabMeal: "Cucina",
        // Sub tabs
        subPlan: "Plan", subDaily: "Daily", subOverview: "Grafici",
        subUscite: "Uscite", subStorico: "Storico",
        subBollette: "Bollette", subGrafici: "Grafici", subPellet: "Pellet",
        subProgetti: "Progetti", subMutuo: "Mutuo",
        // Mutuo
        mutuoTitle: "Mutuo üè†", mutuoAddRate: "‚ûï Aggiungi Rata", mutuoRata: "Rata",
        mutuoData: "Data pagamento", mutuoCapitale: "Quota Capitale",
        mutuoInteressi: "Quota Interessi", mutuoTotale: "Totale Rata",
        mutuoResiduo: "Residuo Debito", mutuoNote: "Note",
        mutuoNoRate: "Nessuna rata ancora ‚Äî aggiungi la prima", mutuoEdit: "Modifica rata",
        mutuoSave: "Salva", mutuoCancel: "Annulla", mutuoDelete: "Elimina",
        mutuoOverview: "Overview Mutuo", mutuoTotalePagato: "Totale Pagato",
        mutuoTotaleInteressi: "di cui Interessi", mutuoTotaleCapitale: "di cui Capitale",
        // Progetti
        progettiTitle: "Progetti Casa üî®", progettiAdd: "‚ûï Aggiungi Progetto",
        progettiNome: "Nome Progetto", progettiFornitore: "Fornitore / Artigiano",
        progettiCategoria: "Categoria", progettiImporto: "Importo",
        progettiData: "Data", progettiStato: "Stato", progettiNote: "Note",
        progettiSave: "Salva Progetto", progettiEdit: "‚úèÔ∏è Modifica",
        progettiDelete: "Elimina", progettiNoData: "Nessun progetto ancora",
        progettiTotale: "Totale Progetti", progettiPagato: "Pagato",
        progettiDaPagare: "Da Pagare", progettiOverview: "Overview",
        // Meal Planner
        mealTitle: "Meal Planner üçΩÔ∏è", mealRicette: "Ricette", mealPranzo: "Pranzo", mealCena: "Cena",
        mealWeek: "Settimana", mealAddRicetta: "‚ûï Nuova Ricetta",
        mealPranzo: "Pranzo", mealCena: "Cena",
        mealShuffle: "üîÄ Shuffle settimana", mealNoRicette: "Nessuna ricetta ancora",
        mealNome: "Nome ricetta", mealIngredienti: "Ingredienti",
        mealPreparazione: "Preparazione", mealTempi: "Tempo (min)",
        mealPorte: "Porzioni", mealSave: "Salva Ricetta", mealEdit: "Modifica",
        mealDelete: "Elimina", mealDuplica: "Duplica settimana",
        // Settings
        settingsTitle: "Impostazioni", settingsPerson1: "Persona 1", settingsPerson2: "Persona 2",
        settingsSave: "Salva modifiche", settingsStart: "Inizia ‚Üí", settingsCancel: "Annulla",
        settingsLang: "Lingua",
        settingsOnboardingTitle: "Inserisci i nomi delle due persone per iniziare",
        // Export/Import
        exportImportTitle: "Esporta / Importa", exportTitle: "Esporta dati",
        exportDesc: "Copia il testo qui sotto e salvalo. Incollalo nella sezione Importa su un altro dispositivo.",
        exportCopy: "üìã Copia negli appunti",
        importTitle: "Importa dati",
        importDesc: "Incolla qui il testo esportato da un altro dispositivo.",
        importWarning: "I dati attuali verranno sovrascritti.",
        importBtn: "Importa e sostituisci",
        importOk: "‚úÖ Dati importati con successo!",
        importErr: "‚ùå Formato non valido. Assicurati di incollare il testo completo.",
        // Entrate
        contribution: "Contributo famiglia", familyTotal: "Totale famiglia",
        // Plan
        planWarning: "Inserisci gli stipendi in Entrate per il calcolo automatico",
        copyFromPrev: "Copia Plan da", overwrite: "(sovrascrive)",
        copyConfirm: "Sovrascrivere", copyWith: "con i valori di",
        copyYes: "S√¨, copia", addItem: "+ Aggiungi voce",
        planSummary: "Riepilogo", grandTotal: "Totale Plan",
        // Daily
        dailyBudget: "Budget Mensile", remaining: "Rimanente",
        initialAvg: "Media/Giorno iniziale",
        updatedAvg: "Media/Giorno oggi", daysLeft: "giorni rimasti",
        budgetUse: "Utilizzo budget", todayMarker: "oggi",
        noPlanData: "Inserisci i valori nel Plan ‚Üí Revolut Cointestato per attivare il Daily Budget",
        // Uscite
        newExpense: "+ Nuova Spesa", editExpense: "‚úèÔ∏è Modifica Spesa",
        saveExpense: "Salva Spesa", saveChanges: "üíæ Salva Modifiche",
        category: "Categoria", merchant: "Esercente / Descrizione",
        merchantPlaceholder: "es. Esselunga, Zara...", date: "Data", amount: "Importo",
        noExpenses: "Nessuna spesa questo mese", noFilter: "Nessuna spesa con questo filtro",
        allCategories: "Tutte le categorie", byCategory: "Per Categoria",
        totalMonth: "Totale", numExpenses: "spese",
        sortDateDesc: "Data ‚Üì", sortDateAsc: "Data ‚Üë", sortAmountDesc: "Importo ‚Üì", sortByCat: "Categoria",
        // Storico
        storicoTitle: "Storico Entrate", noData: "Nessun dato ancora",
        // Bollette
        bolletteTitle: "Bollette", yearSummary: "Riepilogo Annuale",
        monthlyDetail: "Dettaglio Mensile ‚Äî tocca un campo per modificarlo",
        netLuce: "Luce netta", pannelliCredit: "PANNELLI (credito)", luceSpesa: "LUCE (spesa)",
        delete: "Elimina", note: "NOTE",
        // Grafici
        graficiTitle: "Grafici Bollette", monthlyTrend: "Andamento Mensile", yearlyTotals: "Totale per Anno",
        luceNetta: "Luce Netta (Luce ‚àí Pannelli)", gasePellet: "Gas e Pellet", gasePelletAnno: "Gas e Pellet per Anno",
        luceAnno: "Luce per Anno", acquaAnno: "Acqua per Anno",
        noGraficiData: "Inserisci dati nelle Bollette per vedere i grafici",
        // Pellet
        pelletTitle: "Tracker Pellet ü™µ", currentStatus: "Situazione attuale",
        bagsLeft: "sacchi rimasti", avgPerDay: "Media/giorno", bags: "sacchi",
        totalBought: "Totale comprati", addRow: "‚ûï Nuova riga", editRow: "‚úèÔ∏è Modifica riga",
        bought: "üõí Comprati", consumed: "üî• Consumati", add: "Aggiungi",
        daysRemain: "giorni", finishOn: "finiscono il", noTracking: "Aggiungi la prima riga per iniziare il tracking",
        // Overview
        overviewTitle: "Grafici", monthlyPlan: "Piano Mensile", familyMonthly: "Totale Famiglia ‚Äî Ultimi mesi",
        essential: "Essential", extra: "Extra", saving: "Saving",
        // Categories
        catSpesa: "Spesa", catMangiare: "Mangiare Fuori", catProgrammati: "Programmati",
        catShopping: "Shopping", catVarie: "Varie", catDivertimento: "Divertimento",
        catSalute: "Salute", catTrasporti: "Trasporti", catServizi: "Servizi",
        // Sections
        sectionComune: "COMUNE", sectionPersonale: "PERSONALE", sectionRisparmi: "RISPARMI",
        autoSplit: "split auto %", manualSplit: "manuali",
        revolut: "Revolut Cointestato", spent: "Speso", perDay: "‚Ç¨/giorno", dayLabel: "giorno", monthlyPlanLabel: "Piano Mensile", familyMonthlyLabel: "Totale Famiglia ‚Äî Ultimi mesi",
    },
    en: {
        months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
        days: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
        appSubtitle: "Your home",
        tabEntrate: "Income", tabBudget: "Budget", tabSpese: "Expenses", tabCasa: "Home", tabMeal: "Kitchen",
        subPlan: "Plan", subDaily: "Daily", subOverview: "Grafici",
        subUscite: "Expenses", subStorico: "History",
        subBollette: "Bills", subGrafici: "Charts", subPellet: "Pellet",
        subProgetti: "Projects", subMutuo: "Mortgage",
        mutuoTitle: "Mortgage üè†", mutuoAddRate: "‚ûï Add Payment", mutuoRata: "Payment",
        mutuoData: "Payment date", mutuoCapitale: "Principal",
        mutuoInteressi: "Interest", mutuoTotale: "Total", mutuoResiduo: "Remaining debt",
        mutuoNote: "Notes", mutuoNoRate: "No payments yet ‚Äî add the first one", mutuoEdit: "Edit payment",
        mutuoSave: "Save", mutuoCancel: "Cancel", mutuoDelete: "Delete",
        mutuoOverview: "Mortgage Overview", mutuoTotalePagato: "Total Paid",
        mutuoTotaleInteressi: "of which Interest", mutuoTotaleCapitale: "of which Principal",
        progettiTitle: "Home Projects üî®", progettiAdd: "‚ûï Add Project",
        progettiNome: "Project name", progettiFornitore: "Supplier", progettiCategoria: "Category",
        progettiImporto: "Amount", progettiData: "Date", progettiStato: "Status", progettiNote: "Notes",
        progettiSave: "Save Project", progettiEdit: "‚úèÔ∏è Edit", progettiDelete: "Delete",
        progettiNoData: "No projects yet", progettiTotale: "Total Projects",
        progettiPagato: "Paid", progettiDaPagare: "To Pay", progettiOverview: "Overview",
        mealTitle: "Meal Planner üçΩÔ∏è", mealRicette: "Recipes", mealWeek: "Week",
        mealAddRicetta: "‚ûï New Recipe", mealPranzo: "Lunch", mealCena: "Dinner",
        mealShuffle: "üîÄ Shuffle week", mealNoRicette: "No recipes yet",
        mealNome: "Recipe name", mealIngredienti: "Ingredients", mealPreparazione: "Instructions",
        mealTempi: "Time (min)", mealPorte: "Servings", mealSave: "Save Recipe",
        mealEdit: "Edit", mealDelete: "Delete", mealDuplica: "Duplicate week",
        settingsTitle: "Settings", settingsPerson1: "Person 1", settingsPerson2: "Person 2",
        settingsSave: "Save changes", settingsStart: "Start ‚Üí", settingsCancel: "Cancel",
        settingsLang: "Language",
        settingsOnboardingTitle: "Enter the names of the two people to get started",
        exportImportTitle: "Export / Import", exportTitle: "Export data",
        exportDesc: "Copy the text below and save it. Paste it in the Import section on another device.",
        exportCopy: "üìã Copy to clipboard",
        importTitle: "Import data",
        importDesc: "Paste here the text exported from another device.",
        importWarning: "Current data will be overwritten.",
        importBtn: "Import and replace",
        importOk: "‚úÖ Data imported successfully!",
        importErr: "‚ùå Invalid format. Make sure you paste the full text.",
        contribution: "Family contribution", familyTotal: "Family total",
        planWarning: "Enter salaries in Income for automatic calculation",
        copyFromPrev: "Copy Plan from", overwrite: "(overwrites)",
        copyConfirm: "Overwrite", copyWith: "with values from",
        copyYes: "Yes, copy", addItem: "+ Add item",
        planSummary: "Summary", grandTotal: "Total Plan",
        dailyBudget: "Monthly Budget", remaining: "Remaining",
        initialAvg: "Initial avg/day",
        updatedAvg: "Today's avg/day", daysLeft: "days left",
        budgetUse: "Budget usage", todayMarker: "today",
        noPlanData: "Enter values in Plan ‚Üí Revolut Cointestato to activate Daily Budget",
        newExpense: "+ New Expense", editExpense: "‚úèÔ∏è Edit Expense",
        saveExpense: "Save Expense", saveChanges: "üíæ Save Changes",
        category: "Category", merchant: "Merchant / Description",
        merchantPlaceholder: "e.g. Amazon, Zara...", date: "Date", amount: "Amount",
        noExpenses: "No expenses this month", noFilter: "No expenses with this filter",
        allCategories: "All categories", byCategory: "By Category",
        totalMonth: "Total", numExpenses: "expenses",
        sortDateDesc: "Date ‚Üì", sortDateAsc: "Date ‚Üë", sortAmountDesc: "Amount ‚Üì", sortByCat: "Category",
        storicoTitle: "Income History", noData: "No data yet",
        bolletteTitle: "Bills", yearSummary: "Yearly Summary",
        monthlyDetail: "Monthly Detail ‚Äî tap a field to edit",
        netLuce: "Net electricity", pannelliCredit: "SOLAR PANELS (credit)", luceSpesa: "ELECTRICITY (expense)",
        delete: "Delete", note: "NOTES",
        graficiTitle: "Bill Charts", monthlyTrend: "Monthly Trend", yearlyTotals: "Yearly Totals",
        luceNetta: "Net Electricity (Elec ‚àí Solar)", gasePellet: "Gas & Pellet", gasePelletAnno: "Gas & Pellet per Year",
        luceAnno: "Electricity per Year", acquaAnno: "Water per Year",
        noGraficiData: "Enter bill data to see charts",
        pelletTitle: "Pellet Tracker ü™µ", currentStatus: "Current status",
        bagsLeft: "bags remaining", avgPerDay: "Avg/day", bags: "bags",
        totalBought: "Total bought", addRow: "‚ûï New row", editRow: "‚úèÔ∏è Edit row",
        bought: "üõí Bought", consumed: "üî• Consumed", add: "Add",
        daysRemain: "days", finishOn: "run out on", noTracking: "Add first row to start tracking",
        overviewTitle: "Grafici", monthlyPlan: "Monthly Plan", familyMonthly: "Family Total ‚Äî Last months",
        essential: "Essential", extra: "Extra", saving: "Saving",
        catSpesa: "Groceries", catMangiare: "Eating Out", catProgrammati: "Scheduled",
        catShopping: "Shopping", catVarie: "Misc", catDivertimento: "Entertainment",
        catSalute: "Health", catTrasporti: "Transport", catServizi: "Services",
        sectionComune: "SHARED", sectionPersonale: "PERSONAL", sectionRisparmi: "SAVINGS",
        autoSplit: "auto split %", manualSplit: "manual",
        revolut: "Joint Revolut", spent: "Spent", perDay: "‚Ç¨/day", dayLabel: "day", monthlyPlanLabel: "Monthly Plan", familyMonthlyLabel: "Family Total ‚Äî Last months",
    },
    es: {
        months: ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"],
        days: ["Dom", "Lun", "Mar", "Mi√©", "Jue", "Vie", "S√°b"],
        appSubtitle: "Tu hogar",
        tabEntrate: "Ingresos", tabBudget: "Presupuesto", tabSpese: "Gastos", tabCasa: "Casa",
        subPlan: "Plan", subDaily: "Diario", subOverview: "Grafici",
        subUscite: "Gastos", subStorico: "Historial",
        subBollette: "Facturas", subGrafici: "Gr√°ficos", subPellet: "Pellet",
        settingsTitle: "Ajustes", settingsPerson1: "Persona 1", settingsPerson2: "Persona 2",
        settingsSave: "Guardar cambios", settingsStart: "Empezar ‚Üí", settingsCancel: "Cancelar",
        settingsLang: "Idioma",
        settingsOnboardingTitle: "Introduce los nombres de las dos personas para empezar",
        exportImportTitle: "Exportar / Importar", exportTitle: "Exportar datos",
        exportDesc: "Copia el texto y gu√°rdalo. P√©galo en Importar en otro dispositivo.",
        exportCopy: "üìã Copiar al portapapeles",
        importTitle: "Importar datos",
        importDesc: "Pega aqu√≠ el texto exportado desde otro dispositivo.",
        importWarning: "Los datos actuales ser√°n sobreescritos.",
        importBtn: "Importar y reemplazar",
        importOk: "‚úÖ ¬°Datos importados con √©xito!",
        importErr: "‚ùå Formato no v√°lido. Aseg√∫rate de pegar el texto completo.",
        contribution: "Contribuci√≥n familiar", familyTotal: "Total familiar",
        planWarning: "Introduce los sueldos en Ingresos para el c√°lculo autom√°tico",
        copyFromPrev: "Copiar Plan de", overwrite: "(sobreescribe)",
        copyConfirm: "¬øSobreescribir", copyWith: "con los valores de",
        copyYes: "S√≠, copiar", addItem: "+ A√±adir elemento",
        planSummary: "Resumen", grandTotal: "Total Plan",
        dailyBudget: "Presupuesto Mensual", remaining: "Restante",
        initialAvg: "Media/d√≠a inicial",
        updatedAvg: "Media/d√≠a hoy", daysLeft: "d√≠as restantes",
        budgetUse: "Uso del presupuesto", todayMarker: "hoy",
        noPlanData: "Introduce valores en Plan ‚Üí Revolut Cointestato para activar el Diario",
        newExpense: "+ Nuevo Gasto", editExpense: "‚úèÔ∏è Editar Gasto",
        saveExpense: "Guardar Gasto", saveChanges: "üíæ Guardar Cambios",
        category: "Categor√≠a", merchant: "Comercio / Descripci√≥n",
        merchantPlaceholder: "ej. Mercadona, Zara...", date: "Fecha", amount: "Importe",
        noExpenses: "Sin gastos este mes", noFilter: "Sin gastos con este filtro",
        allCategories: "Todas las categor√≠as", byCategory: "Por Categor√≠a",
        totalMonth: "Total", numExpenses: "gastos",
        sortDateDesc: "Fecha ‚Üì", sortDateAsc: "Fecha ‚Üë", sortAmountDesc: "Importe ‚Üì", sortByCat: "Categor√≠a",
        storicoTitle: "Historial de Ingresos", noData: "Sin datos todav√≠a",
        bolletteTitle: "Facturas", yearSummary: "Resumen Anual",
        monthlyDetail: "Detalle Mensual ‚Äî toca un campo para editar",
        netLuce: "Electricidad neta", pannelliCredit: "PANELES SOLARES (cr√©dito)", luceSpesa: "ELECTRICIDAD (gasto)",
        delete: "Eliminar", note: "NOTAS",
        graficiTitle: "Gr√°ficos Facturas", monthlyTrend: "Tendencia Mensual", yearlyTotals: "Totales Anuales",
        luceNetta: "Electricidad neta (Elec ‚àí Solar)", gasePellet: "Gas y Pellet", gasePelletAnno: "Gas y Pellet por A√±o",
        luceAnno: "Electricidad por A√±o", acquaAnno: "Agua por A√±o",
        noGraficiData: "Introduce datos en Facturas para ver los gr√°ficos",
        pelletTitle: "Tracker Pellet ü™µ", currentStatus: "Situaci√≥n actual",
        bagsLeft: "sacos restantes", avgPerDay: "Media/d√≠a", bags: "sacos",
        totalBought: "Total comprado", addRow: "‚ûï Nueva fila", editRow: "‚úèÔ∏è Editar fila",
        bought: "üõí Comprados", consumed: "üî• Consumidos", add: "A√±adir",
        daysRemain: "d√≠as", finishOn: "se acaban el", noTracking: "A√±ade la primera fila para empezar",
        overviewTitle: "Grafici", monthlyPlan: "Plan Mensual", familyMonthly: "Total Familiar ‚Äî √öltimos meses",
        essential: "Esencial", extra: "Extra", saving: "Ahorro",
        catSpesa: "Compras", catMangiare: "Comer Fuera", catProgrammati: "Programados",
        catShopping: "Compras", catVarie: "Varios", catDivertimento: "Entretenimiento",
        catSalute: "Salud", catTrasporti: "Transporte", catServizi: "Servicios",
        sectionComune: "COM√öN", sectionPersonale: "PERSONAL", sectionRisparmi: "AHORROS",
        autoSplit: "reparto auto %", manualSplit: "manual",
        revolut: "Revolut Conjunto", spent: "Gastado", perDay: "‚Ç¨/d√≠a", dayLabel: "d√≠a", monthlyPlanLabel: "Plan Mensual", familyMonthlyLabel: "Total Familiar ‚Äî √öltimos meses",
    },
    de: {
        months: ["Januar", "Februar", "M√§rz", "April", "Mai", "Juni", "Juli", "August", "September", "Oktober", "November", "Dezember"],
        days: ["So", "Mo", "Di", "Mi", "Do", "Fr", "Sa"],
        appSubtitle: "Dein Zuhause",
        tabEntrate: "Einnahmen", tabBudget: "Budget", tabSpese: "Ausgaben", tabCasa: "Haus",
        subPlan: "Plan", subDaily: "T√§glich", subOverview: "Grafici",
        subUscite: "Ausgaben", subStorico: "Verlauf",
        subBollette: "Rechnungen", subGrafici: "Diagramme", subPellet: "Pellet",
        settingsTitle: "Einstellungen", settingsPerson1: "Person 1", settingsPerson2: "Person 2",
        settingsSave: "√Ñnderungen speichern", settingsStart: "Starten ‚Üí", settingsCancel: "Abbrechen",
        settingsLang: "Sprache",
        settingsOnboardingTitle: "Namen der zwei Personen eingeben um zu starten",
        exportImportTitle: "Exportieren / Importieren", exportTitle: "Daten exportieren",
        exportDesc: "Kopiere den Text und speichere ihn. F√ºge ihn auf einem anderen Ger√§t ein.",
        exportCopy: "üìã In Zwischenablage kopieren",
        importTitle: "Daten importieren",
        importDesc: "F√ºge hier den exportierten Text von einem anderen Ger√§t ein.",
        importWarning: "Aktuelle Daten werden √ºberschrieben.",
        importBtn: "Importieren und ersetzen",
        importOk: "‚úÖ Daten erfolgreich importiert!",
        importErr: "‚ùå Ung√ºltiges Format. Stelle sicher, dass du den vollst√§ndigen Text einf√ºgst.",
        contribution: "Familienbeitrag", familyTotal: "Familien-Gesamt",
        planWarning: "Geh√§lter in Einnahmen eingeben f√ºr automatische Berechnung",
        copyFromPrev: "Plan kopieren von", overwrite: "(√ºberschreibt)",
        copyConfirm: "√úberschreiben", copyWith: "mit Werten von",
        copyYes: "Ja, kopieren", addItem: "+ Eintrag hinzuf√ºgen",
        planSummary: "Zusammenfassung", grandTotal: "Plan Gesamt",
        dailyBudget: "Monatsbudget", remaining: "Verbleibend",
        initialAvg: "√ò/Tag (initial)",
        updatedAvg: "√ò/Tag (heute)", daysLeft: "Tage verbleibend",
        budgetUse: "Budgetnutzung", todayMarker: "heute",
        noPlanData: "Werte im Plan eingeben um das Tagesbudget zu aktivieren",
        newExpense: "+ Neue Ausgabe", editExpense: "‚úèÔ∏è Ausgabe bearbeiten",
        saveExpense: "Ausgabe speichern", saveChanges: "üíæ √Ñnderungen speichern",
        category: "Kategorie", merchant: "H√§ndler / Beschreibung",
        merchantPlaceholder: "z.B. Lidl, Zara...", date: "Datum", amount: "Betrag",
        noExpenses: "Keine Ausgaben diesen Monat", noFilter: "Keine Ausgaben mit diesem Filter",
        allCategories: "Alle Kategorien", byCategory: "Nach Kategorie",
        totalMonth: "Gesamt", numExpenses: "Ausgaben",
        sortDateDesc: "Datum ‚Üì", sortDateAsc: "Datum ‚Üë", sortAmountDesc: "Betrag ‚Üì", sortByCat: "Kategorie",
        storicoTitle: "Einnahmenverlauf", noData: "Noch keine Daten",
        bolletteTitle: "Rechnungen", yearSummary: "Jahreszusammenfassung",
        monthlyDetail: "Monatsdetail ‚Äî Feld antippen zum Bearbeiten",
        netLuce: "Netto-Strom", pannelliCredit: "SOLARANLAGE (Gutschrift)", luceSpesa: "STROM (Ausgabe)",
        delete: "L√∂schen", note: "NOTIZEN",
        graficiTitle: "Rechnungsdiagramme", monthlyTrend: "Monatlicher Trend", yearlyTotals: "Jahreszahlen",
        luceNetta: "Netto-Strom (Strom ‚àí Solar)", gasePellet: "Gas & Pellet", gasePelletAnno: "Gas & Pellet pro Jahr",
        luceAnno: "Strom pro Jahr", acquaAnno: "Wasser pro Jahr",
        noGraficiData: "Rechnungsdaten eingeben um Diagramme zu sehen",
        pelletTitle: "Pellet-Tracker ü™µ", currentStatus: "Aktuelle Lage",
        bagsLeft: "S√§cke verbleibend", avgPerDay: "√ò/Tag", bags: "S√§cke",
        totalBought: "Gesamt gekauft", addRow: "‚ûï Neue Zeile", editRow: "‚úèÔ∏è Zeile bearbeiten",
        bought: "üõí Gekauft", consumed: "üî• Verbraucht", add: "Hinzuf√ºgen",
        daysRemain: "Tage", finishOn: "gehen aus am", noTracking: "Erste Zeile hinzuf√ºgen um zu starten",
        overviewTitle: "Grafici", monthlyPlan: "Monatsplan", familyMonthly: "Familie Gesamt ‚Äî Letzte Monate",
        essential: "Wesentlich", extra: "Extra", saving: "Ersparnisse",
        catSpesa: "Einkauf", catMangiare: "Essen gehen", catProgrammati: "Geplant",
        catShopping: "Shopping", catVarie: "Sonstiges", catDivertimento: "Unterhaltung",
        catSalute: "Gesundheit", catTrasporti: "Transport", catServizi: "Dienste",
        sectionComune: "GEMEINSAM", sectionPersonale: "PERS√ñNLICH", sectionRisparmi: "ERSPARNISSE",
        autoSplit: "auto Aufteilung %", manualSplit: "manuell",
        revolut: "Gemeinsames Revolut", spent: "Ausgegeben", perDay: "‚Ç¨/Tag", dayLabel: "Tag", monthlyPlanLabel: "Monatsplan", familyMonthlyLabel: "Familie Gesamt ‚Äî Letzte Monate",
    },
    fr: {
        months: ["Janvier", "F√©vrier", "Mars", "Avril", "Mai", "Juin", "Juillet", "Ao√ªt", "Septembre", "Octobre", "Novembre", "D√©cembre"],
        days: ["Dim", "Lun", "Mar", "Mer", "Jeu", "Ven", "Sam"],
        appSubtitle: "Votre maison",
        tabEntrate: "Revenus", tabBudget: "Budget", tabSpese: "D√©penses", tabCasa: "Maison",
        subPlan: "Plan", subDaily: "Quotidien", subOverview: "Grafici",
        subUscite: "D√©penses", subStorico: "Historique",
        subBollette: "Factures", subGrafici: "Graphiques", subPellet: "Pellet",
        settingsTitle: "Param√®tres", settingsPerson1: "Personne 1", settingsPerson2: "Personne 2",
        settingsSave: "Enregistrer", settingsStart: "Commencer ‚Üí", settingsCancel: "Annuler",
        settingsLang: "Langue",
        settingsOnboardingTitle: "Entrez les noms des deux personnes pour commencer",
        exportImportTitle: "Exporter / Importer", exportTitle: "Exporter les donn√©es",
        exportDesc: "Copiez le texte ci-dessous. Collez-le dans Importer sur un autre appareil.",
        exportCopy: "üìã Copier dans le presse-papiers",
        importTitle: "Importer les donn√©es",
        importDesc: "Collez ici le texte export√© depuis un autre appareil.",
        importWarning: "Les donn√©es actuelles seront √©cras√©es.",
        importBtn: "Importer et remplacer",
        importOk: "‚úÖ Donn√©es import√©es avec succ√®s !",
        importErr: "‚ùå Format invalide. Assurez-vous de coller le texte complet.",
        contribution: "Contribution familiale", familyTotal: "Total familial",
        planWarning: "Entrez les salaires dans Revenus pour le calcul automatique",
        copyFromPrev: "Copier le Plan de", overwrite: "(√©crase)",
        copyConfirm: "√âcraser", copyWith: "avec les valeurs de",
        copyYes: "Oui, copier", addItem: "+ Ajouter un √©l√©ment",
        planSummary: "R√©capitulatif", grandTotal: "Total Plan",
        dailyBudget: "Budget Mensuel", remaining: "Restant",
        initialAvg: "Moy/jour initial",
        updatedAvg: "Moy/jour aujourd'hui", daysLeft: "jours restants",
        budgetUse: "Utilisation budget", todayMarker: "aujourd'hui",
        noPlanData: "Entrez des valeurs dans Plan ‚Üí Revolut Cointestato pour activer le Budget Quotidien",
        newExpense: "+ Nouvelle D√©pense", editExpense: "‚úèÔ∏è Modifier D√©pense",
        saveExpense: "Enregistrer", saveChanges: "üíæ Enregistrer",
        category: "Cat√©gorie", merchant: "Commer√ßant / Description",
        merchantPlaceholder: "ex. Carrefour, Zara...", date: "Date", amount: "Montant",
        noExpenses: "Aucune d√©pense ce mois", noFilter: "Aucune d√©pense avec ce filtre",
        allCategories: "Toutes les cat√©gories", byCategory: "Par Cat√©gorie",
        totalMonth: "Total", numExpenses: "d√©penses",
        sortDateDesc: "Date ‚Üì", sortDateAsc: "Date ‚Üë", sortAmountDesc: "Montant ‚Üì", sortByCat: "Cat√©gorie",
        storicoTitle: "Historique des Revenus", noData: "Pas encore de donn√©es",
        bolletteTitle: "Factures", yearSummary: "R√©capitulatif Annuel",
        monthlyDetail: "D√©tail Mensuel ‚Äî touchez un champ pour modifier",
        netLuce: "√âlectricit√© nette", pannelliCredit: "PANNEAUX SOLAIRES (cr√©dit)", luceSpesa: "√âLECTRICIT√â (d√©pense)",
        delete: "Supprimer", note: "NOTES",
        graficiTitle: "Graphiques Factures", monthlyTrend: "Tendance Mensuelle", yearlyTotals: "Totaux Annuels",
        luceNetta: "√âlectricit√© nette (√âlec ‚àí Solaire)", gasePellet: "Gaz & Pellet", gasePelletAnno: "Gaz & Pellet par An",
        luceAnno: "√âlectricit√© par An", acquaAnno: "Eau par An",
        noGraficiData: "Entrez des donn√©es dans Factures pour voir les graphiques",
        pelletTitle: "Tracker Pellet ü™µ", currentStatus: "Situation actuelle",
        bagsLeft: "sacs restants", avgPerDay: "Moy/jour", bags: "sacs",
        totalBought: "Total achet√©", addRow: "‚ûï Nouvelle ligne", editRow: "‚úèÔ∏è Modifier ligne",
        bought: "üõí Achet√©s", consumed: "üî• Consomm√©s", add: "Ajouter",
        daysRemain: "jours", finishOn: "se terminent le", noTracking: "Ajoutez la premi√®re ligne pour commencer",
        overviewTitle: "Grafici", monthlyPlan: "Plan Mensuel", familyMonthly: "Total Famille ‚Äî Derniers mois",
        essential: "Essentiel", extra: "Extra", saving: "√âpargne",
        catSpesa: "Courses", catMangiare: "Resto", catProgrammati: "Programm√©s",
        catShopping: "Shopping", catVarie: "Divers", catDivertimento: "Loisirs",
        catSalute: "Sant√©", catTrasporti: "Transport", catServizi: "Services",
        sectionComune: "COMMUN", sectionPersonale: "PERSONNEL", sectionRisparmi: "√âPARGNE",
        autoSplit: "r√©partition auto %", manualSplit: "manuel",
        revolut: "Revolut Commun", spent: "D√©pens√©", perDay: "‚Ç¨/jour", dayLabel: "jour", monthlyPlanLabel: "Plan Mensuel", familyMonthlyLabel: "Total Famille ‚Äî Derniers mois",
    },
};
const LANG_OPTIONS = [
    { code: "it", label: "üáÆüáπ Italiano" },
    { code: "en", label: "üá¨üáß English" },
    { code: "es", label: "üá™üá∏ Espa√±ol" },
    { code: "de", label: "üá©üá™ Deutsch" },
    { code: "fr", label: "üá´üá∑ Fran√ßais" },
];
const YEARS = [2024, 2025, 2026, 2027];
const CATEGORIE_BASE = [
    { id: "spesa", tKey: "catSpesa", color: "#e67e22", bg: "rgba(230,126,34,0.2)" },
    { id: "mangiare_fuori", tKey: "catMangiare", color: "#27ae60", bg: "rgba(39,174,96,0.2)" },
    { id: "programmati", tKey: "catProgrammati", color: "#2980b9", bg: "rgba(41,128,185,0.2)" },
    { id: "shopping", tKey: "catShopping", color: "#8e44ad", bg: "rgba(142,68,173,0.2)" },
    { id: "varie", tKey: "catVarie", color: "#7f8c8d", bg: "rgba(127,140,141,0.2)" },
    { id: "divertimento", tKey: "catDivertimento", color: "#16a085", bg: "rgba(22,160,133,0.2)" },
    { id: "salute", tKey: "catSalute", color: "#e74c3c", bg: "rgba(231,76,60,0.2)" },
    { id: "trasporti", tKey: "catTrasporti", color: "#c0392b", bg: "rgba(192,57,43,0.2)" },
    { id: "servizi", tKey: "catServizi", color: "#2c3e50", bg: "rgba(44,62,80,0.2)" },
];
const PLAN_STRUCTURE = [
    {
        id: "revolut_cointestato", label: "Revolut Cointestato", section: "COMUNE", splitMode: "auto",
        color: "#c0392b", bg: "rgba(192,57,43,0.13)", borderColor: "rgba(192,57,43,0.35)", pill: "#c0392b",
        items: [
            { id: "spese_essenziali", name: "Spese Essenziali", desc: "", cat: "essential" },
            { id: "netflix", name: "Netflix", desc: "Visa Condivisa Diego", day: 3, cat: "extra" },
            { id: "discovery", name: "Discovery+", desc: "Visa Condivisa Diego", day: 8, cat: "extra" },
            { id: "icloud", name: "iCloud+ Apple", desc: "Visa Condivisa Diego", day: 6, cat: "extra" },
            { id: "disney", name: "Disney+", desc: "Visa Condivisa Diego", day: 10, cat: "extra" },
            { id: "assic_betty", name: "Assicurazione Betty", desc: "", day: 4, cat: "essential" },
            { id: "telethon", name: "Telethon", desc: "", day: 16, cat: "extra" },
            { id: "amazon_prime", name: "Amazon Prime", desc: "Visa Condivisa Diego", day: 19, cat: "extra" },
            { id: "paramount", name: "Paramount", desc: "Visa Condivisa Diego", day: 18, cat: "extra" },
            { id: "youtube", name: "Youtube Premium", desc: "Visa Condivisa Diego", day: 28, cat: "extra" },
            { id: "hello_fresh", name: "Hello Fresh", desc: "", cat: "extra" },
            { id: "easypark", name: "EasyPark", desc: "Visa Condivisa Diego", cat: "extra" },
        ],
    },
    {
        id: "vaults", label: "Vaults", section: "COMUNE", splitMode: "auto",
        color: "#d35400", bg: "rgba(211,84,0,0.10)", borderColor: "rgba(211,84,0,0.32)", pill: "#d35400",
        items: [
            { id: "contanti", name: "Contanti", desc: "", cat: "essential" },
            { id: "mutuo", name: "Mutuo", desc: "Rata 28¬∞ (‚Ç¨800) + Interessi Passivi Annuali Marzo (‚Ç¨1.500)", cat: "essential" },
            { id: "scuole", name: "Scuole Puzzetti", desc: "Mensa + Doposcuola + LingoKids", cat: "essential" },
            { id: "bollette", name: "Bollette", desc: "Enel + Telepass + Fastweb (15¬∞) + Prima assic. Casa (‚Ç¨313,90 ann. 04/12)", cat: "essential" },
            { id: "macchina", name: "Macchina", desc: "Ass. RCA Conte.it ‚Ç¨415 ann. | Finanziamento ‚Ç¨568,21/mese | Anticipo dopo 4 anni ‚Ç¨12.000", cat: "essential" },
            { id: "assic_medica", name: "Assicurazione Medica", desc: "UniSalute", cat: "essential" },
            { id: "pulizia_casa", name: "Pulizia Casa", desc: "Barbara", cat: "extra" },
            { id: "montagna", name: "Montagna", desc: "Romeno, etc.", cat: "extra" },
            { id: "mare", name: "Mare", desc: "", cat: "extra" },
            { id: "viaggi", name: "Viaggi", desc: "Roma, Torino, Ponti, Weekend, Estero + Parigi-Disneyland (fine Maggio)", cat: "extra" },
            { id: "bettona", name: "Bettona & Caramellina", desc: "Spese veterinarie, sitting", cat: "extra" },
            { id: "regali", name: "Regali", desc: "Natale, Compleanni, Onomastici", cat: "extra" },
            { id: "vestiti_ed", name: "Vestiti Elena & Davide", desc: "", cat: "extra" },
            { id: "sfizi_famiglia", name: "Sfizi Famiglia", desc: "Per casa, lavori, etc.", cat: "extra" },
            { id: "mangiare_fuori", name: "Mangiare Fuori", desc: "", cat: "extra" },
            { id: "attivita_puzzetti", name: "Attivit√† Puzzetti", desc: "Centro estivo, Nuoto Davide, Inglese", cat: "extra" },
            { id: "matrimonio", name: "Matrimonio", desc: "", cat: "extra" },
        ],
    },
    {
        id: "personale", label: "Personale", section: "PERSONALE", splitMode: "manual",
        color: "#6c3483", bg: "rgba(108,52,131,0.12)", borderColor: "rgba(108,52,131,0.35)", pill: "#8e44ad",
        items: [
            { id: "pensione", name: "Pensione", desc: "", cat: "saving" },
            { id: "onepassword", name: "1Password", desc: "‚Ç¨31,69 ‚Äì Annuale ‚Äì 14 Set", cat: "extra" },
            { id: "google_one", name: "Google One", desc: "‚Ç¨99,99 ‚Äì Annuale ‚Äì 25 Feb", cat: "extra" },
            { id: "dentista", name: "Dentista", desc: "Pulizia dei denti", cat: "essential" },
            { id: "ps_plus", name: "PS+", desc: "‚Ç¨125 ‚Äì Annuale ‚Äì 12 Mar", cat: "extra" },
            { id: "crossfit", name: "Crossfit / Pilates", desc: "", cat: "extra" },
            { id: "surfshark", name: "Surfshark", desc: "‚Ç¨50 ‚Äì Annuale ‚Äì 17 Feb ‚Äì PayPal Diego", cat: "extra" },
            { id: "vestiti_sfizi", name: "Vestiti / Sfizi", desc: "", cat: "extra" },
            { id: "parrucchiere", name: "Parrucchiere / Estetista", desc: "", cat: "extra" },
            { id: "commercialista", name: "Commercialista", desc: "", cat: "essential" },
            { id: "telefonino", name: "Telefonino", desc: "", cat: "essential" },
        ],
    },
    {
        id: "risparmi", label: "Risparmi", section: "RISPARMI", splitMode: "manual",
        color: "#1e8449", bg: "rgba(30,132,73,0.10)", borderColor: "rgba(30,132,73,0.32)", pill: "#27ae60",
        items: [
            { id: "risparmi", name: "Risparmi", desc: "", cat: "saving" },
        ],
    },
];
const SECTION_LABELS = {
    COMUNE: { color: "#c0392b", label: "COMUNE", tKey: "sectionComune" },
    PERSONALE: { color: "#6c3483", label: "PERSONALE", tKey: "sectionPersonale" },
    RISPARMI: { color: "#1e8449", label: "RISPARMI", tKey: "sectionRisparmi" },
};
const fmt = (n) => new Intl.NumberFormat("it-IT", { style: "currency", currency: "EUR" }).format(n || 0);
const pct = (n) => (typeof n === "number" ? n.toFixed(1) + "%" : "0.0%");
const today = () => {
    const d = new Date();
    return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, "0")}-${String(d.getDate()).padStart(2, "0")}`;
};
function FamilyCodeWidget() {
    const [meta, setMeta] = React.useState(null);
    React.useEffect(() => {
        if (window._getFamilyMeta)
            window._getFamilyMeta().then(setMeta).catch(() => { });
    }, []);
    if (!meta || !meta.code)
        return null;
    return (React.createElement("div", { style: { margin: "8px 20px 0", background: "rgba(232,197,71,0.07)", border: "1px solid rgba(232,197,71,0.2)", borderRadius: 10, padding: "10px 14px" } }, React.createElement("div", { style: { fontSize: 9, color: "#666", fontWeight: 700, letterSpacing: 1, marginBottom: 4 } }, "CODICE FAMIGLIA"), React.createElement("div", { style: { fontSize: 20, fontWeight: 700, color: "#e8c547", letterSpacing: 4, marginBottom: 2 } }, meta.code), React.createElement("div", { style: { fontSize: 10, color: "#555" } }, "Condividilo col tuo partner")));
}
function FamilyCodeModal() {
    const [meta, setMeta] = React.useState(null);
    React.useEffect(() => {
        if (window._getFamilyMeta)
            window._getFamilyMeta().then(setMeta).catch(() => { });
    }, []);
    if (!meta || !meta.code)
        return null;
    return (React.createElement("div", { style: { background: "rgba(232,197,71,0.07)", border: "1px solid rgba(232,197,71,0.2)", borderRadius: 12, padding: "14px 16px", marginTop: 4 } }, React.createElement("div", { style: { fontSize: 9, color: "#666", fontWeight: 700, letterSpacing: 1, marginBottom: 6 } }, "CODICE FAMIGLIA"), React.createElement("div", { style: { fontSize: 26, fontWeight: 700, color: "#e8c547", letterSpacing: 6, textAlign: "center", marginBottom: 6 } }, meta.code), React.createElement("div", { style: { fontSize: 11, color: "#555", textAlign: "center" } }, "Condividi con il tuo partner per accedere agli stessi dati")));
}
function App() {
    const isMobile = useIsMobile();
    const [tab, setTab] = (0, React.useState)("entrate");
    const [subTab, setSubTab] = (0, React.useState)("plan");
    const [lang, setLang] = (0, React.useState)("it");
    const [month, setMonth] = (0, React.useState)(new Date().getMonth());
    const [year, setYear] = (0, React.useState)(new Date().getFullYear());
    const [history, setHistory] = (0, React.useState)({});
    const [plan, setPlan] = (0, React.useState)({});
    const [structure, setStructure] = (0, React.useState)(PLAN_STRUCTURE);
    const [uscite, setUscite] = (0, React.useState)([]);
    const [loaded, setLoaded] = (0, React.useState)(false);
    const [collapsed, setCollapsed] = (0, React.useState)({});
    const [expandedDesc, setExpandedDesc] = (0, React.useState)({});
    const [names, setNames] = (0, React.useState)({ p1: "", p2: "" });
    const [showSetup, setShowSetup] = (0, React.useState)(false);
    const [showExportImport, setShowExportImport] = (0, React.useState)(false);
    const [importText, setImportText] = (0, React.useState)("");
    const [importStatus, setImportStatus] = (0, React.useState)(null); // "ok" | "error"
    const [setupDraft, setSetupDraft] = (0, React.useState)({ p1: "", p2: "" });
    // New expense form
    const [newCat, setNewCat] = (0, React.useState)(CATEGORIE_BASE[0].id);
    const [newEsercente, setNewEsercente] = (0, React.useState)("");
    const [newDate, setNewDate] = (0, React.useState)(today());
    const [newAmount, setNewAmount] = (0, React.useState)("");
    const [filterCat, setFilterCat] = (0, React.useState)("all");
    const [sortBy, setSortBy] = (0, React.useState)("date_desc");
    const [showForm, setShowForm] = (0, React.useState)(false);
    const [confirmCopy, setConfirmCopy] = (0, React.useState)(false);
    const [editingId, setEditingId] = (0, React.useState)(null);
    const [bollette, setBollette] = (0, React.useState)([]);
    const [activeCell, setActiveCell] = (0, React.useState)(null);
    const [pelletLog, setPelletLog] = (0, React.useState)([]);
    const [pelletForm, setPelletForm] = (0, React.useState)({ date: today(), comprati: "", consumati: "" });
    const [editingPellet, setEditingPellet] = (0, React.useState)(null);
    // Mutuo state
    const [mutuoRate, setMutuoRate] = (0, React.useState)([]);
    const [showMutuoForm, setShowMutuoForm] = (0, React.useState)(false);
    const [editingMutuo, setEditingMutuo] = (0, React.useState)(null);
    const [mutuoForm, setMutuoForm] = (0, React.useState)({ data: today(), capitale: "", interessi: "", totale: "", residuo: "", note: "" });
    // Progetti state
    const [progetti, setProgetti] = (0, React.useState)([]);
    const [showProgettiForm, setShowProgettiForm] = (0, React.useState)(false);
    const [editingProgetto, setEditingProgetto] = (0, React.useState)(null);
    const [progettoForm, setProgettoForm] = (0, React.useState)({ nome: "", fornitore: "", categoria: "Ristrutturazione", data: today(), importo: "", stato: "in_corso", note: "" });
    // Meal Planner state
    const [ricette, setRicette] = (0, React.useState)([]);
    const [mealWeek, setMealWeek] = (0, React.useState)({});
    const [mealSubTab, setMealSubTab] = (0, React.useState)("ricette");
    const [showRicettaForm, setShowRicettaForm] = (0, React.useState)(false);
    const [editingRicetta, setEditingRicetta] = (0, React.useState)(null);
    const [ricettaForm, setRicettaForm] = (0, React.useState)({ nome: "", ingredienti: "", preparazione: "", tempi: "", porte: "4", note: "" });
    const [ricettaDetail, setRicettaDetail] = (0, React.useState)(null);
    const [bolletteSubTab, setBolletteSubTab] = (0, React.useState)("inserimento");
    const [showPelletForm, setShowPelletForm] = (0, React.useState)(false);
    const [editingItem, setEditingItem] = (0, React.useState)(null); // id of item being edited (day/desc)
    const [editItemDraft, setEditItemDraft] = (0, React.useState)({ day: "", desc: "" });
    const [dragItem, setDragItem] = (0, React.useState)(null); // { groupId, itemId, index }
    const [dragOver, setDragOver] = (0, React.useState)(null); // { groupId, index }
    const key = `${year}-${String(month + 1).padStart(2, "0")}`;
    (0, React.useEffect)(() => {
        async function load() {
            try {
                const h = localStorage.getItem("bgt-history");
                if (h)
                    setHistory(JSON.parse(h));
            }
            catch (_a) { }
            try {
                const p = localStorage.getItem("bgt-plan");
                if (p)
                    setPlan(JSON.parse(p));
            }
            catch (_b) { }
            try {
                const s = localStorage.getItem("bgt-structure");
                if (s) {
                    const stored = JSON.parse(s);
                    // Merge day property from PLAN_STRUCTURE defaults into stored structure
                    const merged = stored.map(group => {
                        const defaultGroup = PLAN_STRUCTURE.find(g => g.id === group.id);
                        if (!defaultGroup)
                            return group;
                        // Migrate: rename "Risparmi Diego"/"Risparmi Carmen" ‚Üí "Risparmi"
                        let items = group.items.map(i => {
                            if (i.name === "Risparmi Diego" || i.name === "Risparmi Carmen")
                                return Object.assign(Object.assign({}, i), { name: "Risparmi" });
                            return i;
                        });
                        return Object.assign(Object.assign({}, group), { items: items.map(item => {
                                var _a;
                                const defaultItem = defaultGroup.items.find(i => i.id === item.id);
                                return defaultItem ? Object.assign(Object.assign({}, item), { day: (_a = item.day) !== null && _a !== void 0 ? _a : defaultItem.day, cat: item.cat || defaultItem.cat }) : item;
                            }) });
                    });
                    setStructure(merged);
                }
            }
            catch (_c) { }
            try {
                const n = localStorage.getItem("bgt-names");
                if (n)
                    setNames(JSON.parse(n));
            }
            catch (_d) { }
            try {
                const l = localStorage.getItem("bgt-lang");
                if (l)
                    setLang(l);
            }
            catch (_e) { }
            try {
                const u = localStorage.getItem("bgt-uscite");
                if (u)
                    setUscite(JSON.parse(u));
            }
            catch (_f) { }
            try {
                const b = localStorage.getItem("bgt-bollette");
                if (b)
                    setBollette(JSON.parse(b));
            }
            catch (_g) { }
            try {
                const p = localStorage.getItem("bgt-pellet");
                if (p)
                    setPelletLog(JSON.parse(p));
            }
            catch (_h) { }
            try {
                const m = localStorage.getItem("bgt-mutuo");
                if (m) setMutuoRate(JSON.parse(m));
            } catch (_i) { }
            try {
                const pr = localStorage.getItem("bgt-progetti");
                if (pr) setProgetti(JSON.parse(pr));
            } catch (_j) { }
            try {
                const rc = localStorage.getItem("bgt-ricette");
                if (rc) setRicette(JSON.parse(rc));
            } catch (_k) { }
            try {
                const mw = localStorage.getItem("bgt-mealweek");
                if (mw) setMealWeek(JSON.parse(mw));
            } catch (_l) { }
            setLoaded(true);
        }
        load();
    }, []);
    const saveHistory = async (v) => { setHistory(v); localStorage.setItem("bgt-history", JSON.stringify(v)); };
    const saveNames = async (v) => { setNames(v); localStorage.setItem("bgt-names", JSON.stringify(v)); };
    const saveLang = async (l) => { setLang(l); localStorage.setItem("bgt-lang", l); };
    const tr = TRANSLATIONS[lang] || TRANSLATIONS.it;
    const t = (key) => tr[key] || TRANSLATIONS.it[key] || key;
    const MONTHS = tr.months;
    const CATEGORIE = CATEGORIE_BASE.map(c => (Object.assign(Object.assign({}, c), { label: t(c.tKey) })));
    const exportData = () => {
        const data = { names, history, plan, uscite, bollette, pelletLog };
        return JSON.stringify(data, null, 2);
    };
    const importData = async (jsonStr) => {
        try {
            const data = JSON.parse(jsonStr);
            if (data.names) {
                setNames(data.names);
                localStorage.setItem("bgt-names", JSON.stringify(data.names));
            }
            if (data.history) {
                setHistory(data.history);
                localStorage.setItem("bgt-history", JSON.stringify(data.history));
            }
            if (data.plan) {
                setPlan(data.plan);
                localStorage.setItem("bgt-plan", JSON.stringify(data.plan));
            }
            if (data.uscite) {
                setUscite(data.uscite);
                localStorage.setItem("bgt-uscite", JSON.stringify(data.uscite));
            }
            if (data.bollette) {
                setBollette(data.bollette);
                localStorage.setItem("bgt-bollette", JSON.stringify(data.bollette));
            }
            if (data.pelletLog) {
                setPelletLog(data.pelletLog);
                localStorage.setItem("bgt-pellet", JSON.stringify(data.pelletLog));
            }
            setImportStatus("ok");
            setTimeout(() => { setImportStatus(null); setImportText(""); setShowExportImport(false); }, 2000);
        }
        catch (_a) {
            setImportStatus("error");
        }
    };
    const savePlan = async (v) => { setPlan(v); localStorage.setItem("bgt-plan", JSON.stringify(v)); };
    const saveStructure = async (v) => { setStructure(v); localStorage.setItem("bgt-structure", JSON.stringify(v)); };
    const saveUscite = async (v) => { setUscite(v); localStorage.setItem("bgt-uscite", JSON.stringify(v)); };
    const saveBollette = async (v) => { setBollette(v); localStorage.setItem("bgt-bollette", JSON.stringify(v)); };
    const savePelletLog = async (v) => { setPelletLog(v); localStorage.setItem("bgt-pellet", JSON.stringify(v)); };
    const saveMutuoRate = async (v) => { setMutuoRate(v); localStorage.setItem("bgt-mutuo", JSON.stringify(v)); };
    const saveProgetti = async (v) => { setProgetti(v); localStorage.setItem("bgt-progetti", JSON.stringify(v)); };
    const saveRicette = async (v) => { setRicette(v); localStorage.setItem("bgt-ricette", JSON.stringify(v)); };
    const saveMealWeek = async (v) => { setMealWeek(v); localStorage.setItem("bgt-mealweek", JSON.stringify(v)); };
    const N1 = names.p1 || "Persona 1";
    const N2 = names.p2 || "Persona 2";
    const hasNames = names.p1 && names.p2;
    const current = history[key] || { diego: [], carmen: [] };
    // Support old format (string) and new format (array)
    const normalizeEntries = (val) => {
        if (!val)
            return [];
        if (typeof val === "string" || typeof val === "number") {
            const n = parseFloat(val);
            return n > 0 ? [{ id: "default", label: "Stipendio", amount: n }] : [];
        }
        return Array.isArray(val) ? val : [];
    };
    const diegoEntries = normalizeEntries(current.diego);
    const carmenEntries = normalizeEntries(current.carmen);
    const netAmount = (e) => {
        const gross = parseFloat(e.amount) || 0;
        const tax = parseFloat(e.tax) || 0;
        return tax > 0 ? gross * (1 - tax / 100) : gross;
    };
    const diegoVal = diegoEntries.reduce((a, e) => a + netAmount(e), 0);
    const carmenVal = carmenEntries.reduce((a, e) => a + netAmount(e), 0);
    const total = diegoVal + carmenVal;
    const diegoPct = total > 0 ? (diegoVal / total) * 100 : 50;
    const carmenPct = total > 0 ? (carmenVal / total) * 100 : 50;
    const updateSalary = (person, value) => saveHistory(Object.assign(Object.assign({}, history), { [key]: Object.assign(Object.assign({}, current), { [person]: value }) }));
    const updateIncome = (person, entries) => saveHistory(Object.assign(Object.assign({}, history), { [key]: Object.assign(Object.assign({}, current), { [person]: entries }) }));
    const addIncomeEntry = (person) => {
        const entries = person === "diego" ? [...diegoEntries] : [...carmenEntries];
        entries.push({ id: Date.now().toString(), label: "", amount: "" });
        updateIncome(person, entries);
    };
    const updateIncomeEntry = (person, id, field, value) => {
        const entries = (person === "diego" ? diegoEntries : carmenEntries).map(e => e.id === id ? Object.assign(Object.assign({}, e), { [field]: value }) : e);
        updateIncome(person, entries);
    };
    const removeIncomeEntry = (person, id) => {
        const entries = (person === "diego" ? diegoEntries : carmenEntries).filter(e => e.id !== id);
        updateIncome(person, entries);
    };
    const currentPlan = plan[key] || {};
    const updateAutoItem = (itemId, value) => savePlan(Object.assign(Object.assign({}, plan), { [key]: Object.assign(Object.assign({}, currentPlan), { [itemId]: value }) }));
    const updateManualItem = (itemId, person, value) => {
        const existing = currentPlan[itemId] || {};
        savePlan(Object.assign(Object.assign({}, plan), { [key]: Object.assign(Object.assign({}, currentPlan), { [itemId]: Object.assign(Object.assign({}, existing), { [person]: value }) }) }));
    };
    const toggleCollapse = (id) => setCollapsed(c => (Object.assign(Object.assign({}, c), { [id]: !c[id] })));
    const toggleDesc = (id) => setExpandedDesc(c => (Object.assign(Object.assign({}, c), { [id]: !c[id] })));
    // USCITE helpers
    const monthUscite = uscite.filter(u => {
        const d = new Date(u.date);
        return d.getFullYear() === year && d.getMonth() === month;
    });
    // Scheduled items from Plan (revolut_cointestato with day) as virtual uscite
    const scheduledUscite = (() => {
        const revGroup = structure.find(g => g.id === "revolut_cointestato");
        if (!revGroup)
            return [];
        return revGroup.items
            .filter(item => item.day && parseFloat(currentPlan[item.id]) > 0)
            .map(item => ({
            id: `sched_${item.id}`,
            categoria: "programmati",
            esercente: item.name,
            date: `${year}-${String(month + 1).padStart(2, "0")}-${String(item.day).padStart(2, "0")}`,
            amount: parseFloat(currentPlan[item.id]) || 0,
            isScheduled: true,
        }));
    })();
    const allMonthUscite = [...monthUscite, ...scheduledUscite];
    const addUscita = () => {
        if (!newAmount || !newDate)
            return;
        if (editingId) {
            // Edit mode
            const newU = uscite.map(u => u.id === editingId
                ? Object.assign(Object.assign({}, u), { categoria: newCat, esercente: newEsercente.trim(), date: newDate, amount: parseFloat(newAmount) }) : u);
            saveUscite(newU);
            setEditingId(null);
        }
        else {
            const entry = {
                id: Date.now(),
                categoria: newCat,
                esercente: newEsercente.trim(),
                date: newDate,
                amount: parseFloat(newAmount),
            };
            saveUscite([entry, ...uscite]);
        }
        setNewEsercente("");
        setNewAmount("");
        setNewDate(today());
        setNewCat(CATEGORIE[0].id);
        setShowForm(false);
    };
    const startEdit = (u) => {
        setEditingId(u.id);
        setNewCat(u.categoria);
        setNewEsercente(u.esercente || "");
        setNewDate(u.date);
        setNewAmount(String(u.amount));
        setShowForm(true);
        window.scrollTo({ top: 0, behavior: "smooth" });
    };
    const deleteUscita = (id) => saveUscite(uscite.filter(u => u.id !== id));
    const filteredUscite = allMonthUscite
        .filter(u => filterCat === "all" || u.categoria === filterCat)
        .sort((a, b) => {
        if (sortBy === "date_desc")
            return new Date(b.date) - new Date(a.date);
        if (sortBy === "date_asc")
            return new Date(a.date) - new Date(b.date);
        if (sortBy === "amount_desc")
            return b.amount - a.amount;
        if (sortBy === "cat")
            return a.categoria.localeCompare(b.categoria);
        return 0;
    });
    const totalMonthUscite = allMonthUscite.reduce((a, u) => a + u.amount, 0);
    // Totals by category
    const catTotals = CATEGORIE.map(c => (Object.assign(Object.assign({}, c), { total: allMonthUscite.filter(u => u.categoria === c.id).reduce((a, u) => a + u.amount, 0) }))).filter(c => c.total > 0);
    const getCat = (id) => CATEGORIE.find(c => c.id === id) || CATEGORIE[CATEGORIE.length - 1];
    // Plan totals
    const getGroupTotal = (group) => {
        return group.items.reduce((acc, item) => {
            if (group.splitMode === "auto")
                return acc + (parseFloat(currentPlan[item.id]) || 0);
            const v = currentPlan[item.id] || {};
            return acc + (parseFloat(v.diego) || 0) + (parseFloat(v.carmen) || 0);
        }, 0);
    };
    const getPlanTotals = () => {
        let comuneTotal = 0, personaleTotal = 0, rispTotal = 0, dTotal = 0, cTotal = 0;
        structure.forEach(group => {
            const gt = getGroupTotal(group);
            if (group.section === "COMUNE")
                comuneTotal += gt;
            else if (group.section === "PERSONALE")
                personaleTotal += gt;
            else
                rispTotal += gt;
            group.items.forEach(item => {
                if (group.splitMode === "auto") {
                    const amt = parseFloat(currentPlan[item.id]) || 0;
                    dTotal += amt * (diegoPct / 100);
                    cTotal += amt * (carmenPct / 100);
                }
                else {
                    const v = currentPlan[item.id] || {};
                    dTotal += parseFloat(v.diego) || 0;
                    cTotal += parseFloat(v.carmen) || 0;
                }
            });
        });
        return { comuneTotal, personaleTotal, rispTotal, grandTotal: comuneTotal + personaleTotal + rispTotal, dTotal, cTotal };
    };
    const updateItemMeta = (groupId, itemId, day, desc) => {
        saveStructure(structure.map(g => g.id === groupId
            ? Object.assign(Object.assign({}, g), { items: g.items.map(i => i.id === itemId ? Object.assign(Object.assign({}, i), { day: day ? parseInt(day) : undefined, desc }) : i) }) : g));
        setEditingItem(null);
    };
    const reorderItem = (groupId, fromIdx, toIdx) => {
        if (fromIdx === toIdx)
            return;
        saveStructure(structure.map(g => {
            if (g.id !== groupId)
                return g;
            const items = [...g.items];
            const [moved] = items.splice(fromIdx, 1);
            items.splice(toIdx, 0, moved);
            return Object.assign(Object.assign({}, g), { items });
        }));
    };
    const addItem = (groupId) => {
        const name = prompt("Nome voce:");
        if (!name)
            return;
        const id = "custom_" + Date.now();
        saveStructure(structure.map(g => g.id === groupId ? Object.assign(Object.assign({}, g), { items: [...g.items, { id, name, desc: "" }] }) : g));
    };
    const removeItem = (groupId, itemId) => saveStructure(structure.map(g => g.id === groupId ? Object.assign(Object.assign({}, g), { items: g.items.filter(i => i.id !== itemId) }) : g));
    const historyEntries = Object.entries(history)
        .sort((a, b) => b[0].localeCompare(a[0]))
        .map(([k, v]) => {
        const [y, m] = k.split("-");
        const d = parseFloat(v.diego) || 0;
        const c = parseFloat(v.carmen) || 0;
        const tot = d + c;
        return { key: k, year: y, month: MONTHS[parseInt(m) - 1], diego: d, carmen: c, total: tot, dPct: tot > 0 ? (d / tot) * 100 : 50, cPct: tot > 0 ? (c / tot) * 100 : 50 };
    });
    const planTotals = getPlanTotals();
    const sections = ["COMUNE", "PERSONALE", "RISPARMI"];
    if (!loaded)
        return (React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "center", height: "100vh", background: "#0d0d0f", color: "#fff", fontFamily: "sans-serif" } }, lang ? "Loading..." : "Caricamento..."));
    // Onboarding / Settings screen
    if (!hasNames || showSetup)
        return (React.createElement("div", { style: { minHeight: "100vh", background: "#0d0d0f", fontFamily: "'DM Sans','Segoe UI',sans-serif", color: "#f0ede8", display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center", padding: 24 } },
            React.createElement("style", null, `@import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=DM+Serif+Display&display=swap'); * { box-sizing:border-box; margin:0; padding:0; } input[type=text],select { background:#181820; border:1px solid #252530; color:#f0ede8; border-radius:10px; padding:14px 16px; font-size:15px; width:100%; outline:none; font-family:inherit; transition:border-color 0.2s; } input[type=text]:focus { border-color:#e8c547; } button { cursor:pointer; border:none; font-family:inherit; }`),
            React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 28, color: "#e8c547", marginBottom: 8, textAlign: "center" } }, showSetup ? t("settingsTitle") : t("appSubtitle")),
            React.createElement("div", { style: { fontSize: 13, color: "#555", marginBottom: 32, textAlign: "center" } }, showSetup ? `${N1} & ${N2}` : t("settingsOnboardingTitle")),
            React.createElement("div", { style: { width: "100%", maxWidth: 380, display: "flex", flexDirection: "column", gap: 16 } },
                React.createElement("div", null,
                    React.createElement("div", { style: { fontSize: 11, color: "#e8c547", fontWeight: 700, letterSpacing: 1, marginBottom: 8 } }, t("settingsLang").toUpperCase()),
                    React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 8 } }, LANG_OPTIONS.map(l => (React.createElement("button", { key: l.code, onClick: () => saveLang(l.code), style: { padding: "8px 14px", borderRadius: 20, fontSize: 13, fontWeight: 700, background: lang === l.code ? "#e8c547" : "#181820", color: lang === l.code ? "#0d0d0f" : "#555", border: `1.5px solid ${lang === l.code ? "#e8c547" : "#252530"}`, transition: "all 0.15s" } }, l.label))))),
                React.createElement("div", { style: { height: 1, background: "#1f1f28" } }),
                React.createElement("div", null,
                    React.createElement("div", { style: { fontSize: 11, color: "#4a9eff", fontWeight: 700, letterSpacing: 1, marginBottom: 8 } }, t("settingsPerson1").toUpperCase()),
                    React.createElement("input", { type: "text", placeholder: "es. Marco", value: setupDraft.p1 || names.p1, onChange: e => setSetupDraft(d => (Object.assign(Object.assign({}, d), { p1: e.target.value }))) })),
                React.createElement("div", null,
                    React.createElement("div", { style: { fontSize: 11, color: "#ff6b9d", fontWeight: 700, letterSpacing: 1, marginBottom: 8 } }, t("settingsPerson2").toUpperCase()),
                    React.createElement("input", { type: "text", placeholder: "es. Sara", value: setupDraft.p2 || names.p2, onChange: e => setSetupDraft(d => (Object.assign(Object.assign({}, d), { p2: e.target.value }))) })),
                React.createElement("button", { onClick: () => {
                        const n = { p1: setupDraft.p1 || names.p1, p2: setupDraft.p2 || names.p2 };
                        if (!n.p1 || !n.p2)
                            return;
                        saveNames(n);
                        setSetupDraft({ p1: "", p2: "" });
                        setShowSetup(false);
                    }, style: { background: "#e8c547", color: "#0d0d0f", borderRadius: 12, padding: "14px", fontSize: 15, fontWeight: 700, marginTop: 8 } }, showSetup ? t("settingsSave") : t("settingsStart")),
                showSetup && (React.createElement("button", { onClick: () => { setShowSetup(false); setSetupDraft({ p1: "", p2: "" }); }, style: { background: "transparent", color: "#555", padding: "10px", fontSize: 13 } }, t("settingsCancel"))),
                React.createElement(FamilyCodeModal, null),
                window._logout && (React.createElement("button", { onClick: () => window._logout(), style: { background: "rgba(192,57,43,0.1)", color: "#e74c3c", borderRadius: 12, padding: "12px", fontSize: 13, fontWeight: 600, border: "1px solid rgba(192,57,43,0.3)", marginTop: 8, width: "100%", fontFamily: "inherit", cursor: "pointer" } }, "\uD83D\uDEAA Esci dall'account")))));
    return (React.createElement("div", { style: { minHeight: "100vh", background: "#0d0d0f", fontFamily: "'DM Sans','Segoe UI',sans-serif", color: "#f0ede8", display: "flex", flexDirection: "column" } },
        React.createElement("div", { className: "mp-sidebar", style: { display: "none", position: "fixed", top: 0, left: 0, width: 220, height: "100vh", background: "#0a0a0c", borderRight: "1px solid #1a1a22", flexDirection: "column", padding: "28px 0", zIndex: 40 } },
            React.createElement("div", { style: { padding: "0 24px 28px" } },
                React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 26, color: "#e8c547" } }, "Nestly"),
                React.createElement("div", { style: { fontSize: 11, color: "#444", marginTop: 4 } },
                    N1,
                    " & ",
                    N2)),
            React.createElement("div", { style: { flex: 1, display: "flex", flexDirection: "column", gap: 2, padding: "0 12px", overflowY: "auto" } }, [["entrate", "üí∞", "tabEntrate"], ["budget", "üìã", "tabBudget"], ["spese", "üí∏", "tabSpese"], ["casa", "üè†", "tabCasa"], ["meal", "üçΩÔ∏è", "tabMeal"]].map(([t_, icon, tkey]) => (React.createElement("button", { key: t_, onClick: () => { setTab(t_); setSubTab(t_ === "entrate" ? "entrate_main" : t_ === "budget" ? "plan" : t_ === "spese" ? "uscite" : t_ === "casa" ? "bollette" : "ricette"); }, style: { display: "flex", alignItems: "center", gap: 12, padding: "11px 14px", borderRadius: 12, border: "none", background: tab === t_ ? "rgba(232,197,71,0.12)" : "none", color: tab === t_ ? "#e8c547" : "#555", fontFamily: "inherit", fontSize: 14, fontWeight: tab === t_ ? 600 : 400, cursor: "pointer", textAlign: "left", width: "100%", transition: "all 0.15s" } },
                React.createElement("span", { style: { fontSize: 18 } }, icon),
                React.createElement("span", null, t(tkey)),
                tab === t_ && React.createElement("div", { style: { marginLeft: "auto", width: 5, height: 5, borderRadius: "50%", background: "#e8c547" } }))))),
            React.createElement("div", { style: { padding: "8px 12px 0", borderTop: "1px solid #1a1a22" } },
                React.createElement("button", { onClick: () => { setSetupDraft({ p1: names.p1, p2: names.p2 }); setShowSetup(true); }, style: { display: "flex", alignItems: "center", gap: 10, padding: "10px 14px", borderRadius: 12, border: "none", background: "none", color: "#444", fontFamily: "inherit", fontSize: 13, cursor: "pointer", width: "100%" } },
                    React.createElement("span", null, "\u2699\uFE0F"),
                    React.createElement("span", null, "Impostazioni")),
                React.createElement("button", { onClick: () => setShowExportImport(true), style: { display: "flex", alignItems: "center", gap: 10, padding: "10px 14px", borderRadius: 12, border: "none", background: "none", color: "#444", fontFamily: "inherit", fontSize: 13, cursor: "pointer", width: "100%" } },
                    React.createElement("span", null, "\uD83D\uDCBE"),
                    React.createElement("span", null, "Esporta / Importa")))),
        showExportImport && (React.createElement("div", { style: { position: "fixed", inset: 0, background: "rgba(0,0,0,0.85)", zIndex: 100, display: "flex", alignItems: "center", justifyContent: "center", padding: 20 } },
            React.createElement("div", { style: { background: "#141418", border: "1px solid #2a2a35", borderRadius: 18, padding: 24, width: "100%", maxWidth: 480 } },
                React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 20 } },
                    React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 18, color: "#e8c547" } },
                        "\uD83D\uDCBE ",
                        t("exportImportTitle")),
                    React.createElement("button", { onClick: () => { setShowExportImport(false); setImportText(""); setImportStatus(null); }, style: { color: "#555", fontSize: 22 } }, "\u00D7")),
                React.createElement("div", { style: { marginBottom: 20 } },
                    React.createElement("div", { style: { fontSize: 11, color: "#666", fontWeight: 700, letterSpacing: 1, textTransform: "uppercase", marginBottom: 10 } },
                        "\uD83D\uDCE4 ",
                        t("exportTitle")),
                    React.createElement("div", { style: { fontSize: 12, color: "#555", marginBottom: 10 } }, t("exportDesc")),
                    React.createElement("textarea", { readOnly: true, value: exportData(), style: { width: "100%", height: 120, background: "#0f0f13", border: "1px solid #252530", borderRadius: 10, padding: "10px 12px", color: "#888", fontSize: 11, fontFamily: "monospace", resize: "none", outline: "none" }, onClick: e => e.target.select() }),
                    React.createElement("button", { onClick: () => {
                            const el = document.createElement("textarea");
                            el.value = exportData();
                            document.body.appendChild(el);
                            el.select();
                            document.execCommand("copy");
                            document.body.removeChild(el);
                        }, style: { width: "100%", marginTop: 8, background: "#252530", color: "#e8c547", borderRadius: 10, padding: "11px", fontSize: 13, fontWeight: 600 } }, t("exportCopy"))),
                React.createElement("div", { style: { height: 1, background: "#1f1f28", marginBottom: 20 } }),
                React.createElement("div", null,
                    React.createElement("div", { style: { fontSize: 11, color: "#666", fontWeight: 700, letterSpacing: 1, textTransform: "uppercase", marginBottom: 10 } },
                        "\uD83D\uDCE5 ",
                        t("importTitle")),
                    React.createElement("div", { style: { fontSize: 12, color: "#555", marginBottom: 10 } },
                        t("importDesc"),
                        " ",
                        React.createElement("span", { style: { color: "#e74c3c" } }, t("importWarning"))),
                    React.createElement("textarea", { value: importText, onChange: e => { setImportText(e.target.value); setImportStatus(null); }, placeholder: t("importDesc"), style: { width: "100%", height: 100, background: "#0f0f13", border: `1px solid ${importStatus === "error" ? "#e74c3c" : importStatus === "ok" ? "#27ae60" : "#252530"}`, borderRadius: 10, padding: "10px 12px", color: "#ccc", fontSize: 11, fontFamily: "monospace", resize: "none", outline: "none" } }),
                    importStatus === "ok" && React.createElement("div", { style: { fontSize: 12, color: "#27ae60", marginTop: 6 } }, t("importOk")),
                    importStatus === "error" && React.createElement("div", { style: { fontSize: 12, color: "#e74c3c", marginTop: 6 } }, t("importErr")),
                    React.createElement("button", { onClick: () => importData(importText), disabled: !importText.trim(), style: { width: "100%", marginTop: 10, background: importText.trim() ? "#e8c547" : "#1f1f28", color: importText.trim() ? "#0d0d0f" : "#444", borderRadius: 10, padding: "11px", fontSize: 13, fontWeight: 700 } }, t("importBtn")))))),
        React.createElement("style", null, `
        @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=DM+Serif+Display&display=swap');
        * { box-sizing:border-box; margin:0; padding:0; }
        ::-webkit-scrollbar { width:4px; } ::-webkit-scrollbar-track { background:#1a1a1f; } ::-webkit-scrollbar-thumb { background:#333; border-radius:2px; }
        /* Desktop sidebar layout */
        @media (min-width: 768px) {
          .mp-sidebar { display: flex !important; }
          .mp-header { padding-left: 252px !important; }
          .mp-content { margin-left: 220px !important; }
        }
        @media (max-width: 767px) {
          .mp-sidebar { display: none !important; }
        }
        input[type=number],input[type=text],input[type=date],textarea { background:#181820; border:1px solid #252530; color:#f0ede8; border-radius:8px; padding:10px 14px; font-size:14px; width:100%; outline:none; font-family:inherit; transition:border-color 0.2s; -moz-appearance:textfield; }
        input[type=number]::-webkit-inner-spin-button { -webkit-appearance:none; }
        input[type=date]::-webkit-calendar-picker-indicator { filter:invert(0.4); }
        input:focus { border-color:#e8c547; }
        input::placeholder { color:#444; }
        select { font-family:inherit; cursor:pointer; background:#181820; border:1px solid #252530; color:#f0ede8; border-radius:8px; padding:9px 12px; font-size:13px; width:100%; outline:none; }
        button { cursor:pointer; border:none; font-family:inherit; background:none; }
        .tag { display:inline-flex; align-items:center; font-size:10px; font-weight:700; padding:2px 9px; border-radius:20px; letter-spacing:0.8px; text-transform:uppercase; color:#fff; white-space:nowrap; }
      `),
        React.createElement("div", { style: { padding: isMobile ? "16px 16px 0" : "16px 32px 0", borderBottom: "1px solid #1a1a22", position: "sticky", top: 0, background: "#0d0d0f", zIndex: 20, paddingTop: "env(safe-area-inset-top, 16px)", marginLeft: isMobile ? 0 : 220 } },
            React.createElement("div", { style: { maxWidth: isMobile ? 680 : "none" } },
                React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 12 } },
                    React.createElement("div", null, isMobile && React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 24, color: "#e8c547" } }, "Nestly")),
                    React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8 } },
                        isMobile && React.createElement(React.Fragment, null,
                            React.createElement("button", { onClick: () => { setSetupDraft({ p1: names.p1, p2: names.p2 }); setShowSetup(true); }, style: { background: "none", color: "#444", fontSize: 18, padding: "4px 6px", borderRadius: 8 } }, "\u2699\uFE0F"),
                            React.createElement("button", { onClick: () => setShowExportImport(true), style: { background: "none", color: "#444", fontSize: 18, padding: "4px 6px", borderRadius: 8 } }, "\uD83D\uDCBE")),
                        React.createElement("div", { style: { display: "flex", gap: 6 } },
                            React.createElement("select", { value: month, onChange: e => setMonth(parseInt(e.target.value)), style: { padding: "6px 10px", fontSize: 12, width: "auto" } }, MONTHS.map((m, i) => React.createElement("option", { key: i, value: i }, m))),
                            React.createElement("select", { value: year, onChange: e => setYear(parseInt(e.target.value)), style: { padding: "6px 10px", fontSize: 12, width: 76 } }, YEARS.map(y => React.createElement("option", { key: y, value: y }, y)))))),
                React.createElement("div", { style: { height: 1, background: "#1a1a22" } }),
                tab === "entrate" && (React.createElement("div", { style: { display: "flex", gap: 6, padding: "10px 0 12px" } }, [["entrate_main", "tabEntrate"], ["storico", "subStorico"]].map(([s, k]) => (React.createElement("button", { key: s, onClick: () => setSubTab(s), style: { flex: 1, padding: "9px 0", borderRadius: 12, border: "none", fontFamily: "inherit", fontSize: 13, fontWeight: 600, cursor: "pointer", background: subTab === s ? "#e8c547" : "#1a1a22", color: subTab === s ? "#0d0d0f" : "#555", transition: "all 0.15s" } }, t(k)))))),
                tab === "budget" && (React.createElement("div", { style: { display: "flex", gap: 6, padding: "10px 0 12px" } }, [["plan", "subPlan"], ["daily", "subDaily"], ["overview", "subOverview"]].map(([s, k]) => (React.createElement("button", { key: s, onClick: () => setSubTab(s), style: { flex: 1, padding: "9px 0", borderRadius: 12, border: "none", fontFamily: "inherit", fontSize: 13, fontWeight: 600, cursor: "pointer", background: subTab === s ? "#e8c547" : "#1a1a22", color: subTab === s ? "#0d0d0f" : "#555", transition: "all 0.15s" } }, t(k)))))),
                tab === "spese" && (React.createElement("div", { style: { display: "flex", gap: 6, padding: "10px 0 12px" } }, [["uscite", "subUscite"]].map(([s, k]) => (React.createElement("button", { key: s, onClick: () => setSubTab(s), style: { flex: 1, padding: "9px 0", borderRadius: 12, border: "none", fontFamily: "inherit", fontSize: 13, fontWeight: 600, cursor: "pointer", background: subTab === s ? "#e8c547" : "#1a1a22", color: subTab === s ? "#0d0d0f" : "#555", transition: "all 0.15s" } }, t(k)))))),
            tab === "meal" && (React.createElement("div", { style: { display: "flex", gap: 6, padding: "10px 0 12px" } }, [["ricette", "mealRicette"], ["settimana", "mealWeek"]].map(([s, k]) => (React.createElement("button", { key: s, onClick: () => setMealSubTab(s), style: { flex: 1, padding: "9px 0", borderRadius: 12, border: "none", fontFamily: "inherit", fontSize: 13, fontWeight: 600, cursor: "pointer", background: mealSubTab === s ? "#e8c547" : "#1a1a22", color: mealSubTab === s ? "#0d0d0f" : "#555", transition: "all 0.15s" } }, t(k)))))),
                tab === "casa" && (React.createElement("div", { style: { display: "flex", gap: 6, padding: "10px 0 12px" } }, [["bollette", "subBollette"], ["progetti", "subProgetti"], ["mutuo", "subMutuo"]].map(([s, k]) => (React.createElement("button", { key: s, onClick: () => setSubTab(s), style: { flex: 1, padding: "9px 0", borderRadius: 12, border: "none", fontFamily: "inherit", fontSize: 13, fontWeight: 600, cursor: "pointer", background: subTab === s ? "#e8c547" : "#1a1a22", color: subTab === s ? "#0d0d0f" : "#555", transition: "all 0.15s" } }, t(k)))))))),
        React.createElement("div", { style: { maxWidth: isMobile ? 680 : "none", margin: isMobile ? "0 auto" : "0", marginLeft: isMobile ? "auto" : 220, padding: isMobile ? "20px 16px 90px" : "28px 40px 40px" } },
            (tab === "entrate" && subTab !== "storico") && (() => {
                const prevMonthE = month === 0 ? 11 : month - 1;
                const prevYearE = month === 0 ? year - 1 : year;
                const prevKeyE = `${prevYearE}-${String(prevMonthE + 1).padStart(2, "0")}`;
                const prevHistE = history[prevKeyE];
                const currentEmptyE = diegoEntries.length === 0 && carmenEntries.length === 0;
                const hasPrevE = prevHistE && (normalizeEntries(prevHistE.diego).length > 0 || normalizeEntries(prevHistE.carmen).length > 0);
                return (React.createElement("div", null,
                    React.createElement("div", { style: { fontSize: 10, color: "#555", letterSpacing: 1.5, textTransform: "uppercase", marginBottom: 16 } },
                        MONTHS[month],
                        " ",
                        year),
                    hasPrevE && (React.createElement("button", { onClick: () => {
                            updateIncome("diego", normalizeEntries(prevHistE.diego));
                            updateIncome("carmen", normalizeEntries(prevHistE.carmen));
                            // Save both together
                            saveHistory(Object.assign(Object.assign({}, history), { [key]: {
                                    diego: normalizeEntries(prevHistE.diego),
                                    carmen: normalizeEntries(prevHistE.carmen)
                                } }));
                        }, style: {
                            width: "100%", display: "flex", alignItems: "center", justifyContent: "center", gap: 8,
                            background: currentEmptyE ? "rgba(232,197,71,0.10)" : "rgba(255,255,255,0.03)",
                            border: `1px dashed ${currentEmptyE ? "rgba(232,197,71,0.4)" : "#2a2a35"}`,
                            borderRadius: 10, padding: "11px 16px", marginBottom: 16,
                            color: currentEmptyE ? "#e8c547" : "#555", fontSize: 13, fontWeight: currentEmptyE ? 600 : 500,
                            cursor: "pointer"
                        } },
                        React.createElement("span", { style: { fontSize: 15 } }, "\u2398"),
                        "Copia Entrate da ",
                        MONTHS[prevMonthE],
                        " ",
                        prevYearE,
                        !currentEmptyE && React.createElement("span", { style: { fontSize: 10, color: "#3a3a44" } }, "(sovrascrive)"))),
                    React.createElement("div", { style: { display: "grid", gridTemplateColumns: isMobile ? "1fr" : "1fr 1fr", gap: 12, marginBottom: 20 } }, [
                        { k: "diego", label: N1, color: "#4a9eff", bg: "rgba(74,158,255,0.07)", border: "rgba(74,158,255,0.2)", entries: diegoEntries },
                        { k: "carmen", label: N2, color: "#ff6b9d", bg: "rgba(255,107,157,0.07)", border: "rgba(255,107,157,0.2)", entries: carmenEntries }
                    ].map(({ k, label, color, bg, border, entries }) => {
                        const val = k === "diego" ? diegoVal : carmenVal;
                        const p = k === "diego" ? diegoPct : carmenPct;
                        return (React.createElement("div", { key: k, style: { background: bg, border: `1px solid ${border}`, borderRadius: 14, padding: 18 } },
                            React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 14 } },
                                React.createElement("div", { style: { fontSize: 11, color, fontWeight: 700, letterSpacing: 1.2, textTransform: "uppercase" } }, label),
                                val > 0 && React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 20, color } }, fmt(val))),
                            React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 8 } }, (entries.length === 0 ? [{ id: "new_default", label: "", amount: "" }] : entries).map((entry, ei) => {
                                const gross = parseFloat(entry.amount) || 0;
                                const tax = parseFloat(entry.tax) || 0;
                                const net = tax > 0 ? gross * (1 - tax / 100) : 0;
                                return (React.createElement("div", { key: entry.id },
                                    React.createElement("div", { style: { display: "flex", gap: 6, alignItems: "center" } },
                                        React.createElement("input", { type: "text", placeholder: "es. Stipendio", value: entry.label, onChange: e => updateIncomeEntry(k, entry.id, "label", e.target.value), style: { flex: 1, padding: "8px 10px", fontSize: 12, background: "rgba(0,0,0,0.25)", borderColor: `${color}33` } }),
                                        React.createElement("div", { style: { position: "relative", flex: "0 0 105px" } },
                                            React.createElement("span", { style: { position: "absolute", left: 10, top: "50%", transform: "translateY(-50%)", color: "#555", fontSize: 13 } }, "\u20AC"),
                                            React.createElement("input", { type: "number", placeholder: "0,00", value: entry.amount, onChange: e => updateIncomeEntry(k, entry.id, "amount", e.target.value), style: { paddingLeft: 24, padding: "8px 10px 8px 24px", fontSize: 13, background: "rgba(0,0,0,0.25)", borderColor: `${color}33` } })),
                                        React.createElement("div", { style: { position: "relative", flex: "0 0 70px" } },
                                            React.createElement("input", { type: "number", placeholder: "0%", min: "0", max: "100", value: entry.tax || "", onChange: e => updateIncomeEntry(k, entry.id, "tax", e.target.value), style: { padding: "8px 20px 8px 8px", fontSize: 12, background: "rgba(0,0,0,0.25)", borderColor: tax > 0 ? "rgba(231,76,60,0.4)" : "#252530", textAlign: "right" } }),
                                            React.createElement("span", { style: { position: "absolute", right: 8, top: "50%", transform: "translateY(-50%)", color: tax > 0 ? "#e74c3c" : "#444", fontSize: 11, pointerEvents: "none" } }, "%")),
                                        entries.length > 1 && (React.createElement("button", { onClick: () => removeIncomeEntry(k, entry.id), style: { color: "#3a3a44", fontSize: 18, padding: "0 2px", flexShrink: 0 } }, "\u00D7"))),
                                    tax > 0 && gross > 0 && (React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginTop: 4, marginBottom: 2, padding: "5px 10px", background: "rgba(231,76,60,0.06)", border: "1px solid rgba(231,76,60,0.15)", borderRadius: 7 } },
                                        React.createElement("span", { style: { fontSize: 11, color: "#888" } },
                                            "Lordo ",
                                            fmt(gross),
                                            " \u2212 ",
                                            tax,
                                            "% tasse (",
                                            fmt(gross * tax / 100),
                                            ")"),
                                        React.createElement("span", { style: { fontSize: 13, fontWeight: 600, color } },
                                            "Netto ",
                                            fmt(net))))));
                            })),
                            React.createElement("button", { onClick: () => addIncomeEntry(k), style: {
                                    width: "100%", marginTop: 10, padding: "7px", borderRadius: 8,
                                    border: `1px dashed ${color}33`, color: `${color}99`, fontSize: 12,
                                    background: "transparent", cursor: "pointer"
                                } }, "+ Aggiungi voce"),
                            val > 0 && entries.length > 1 && (React.createElement("div", { style: { marginTop: 10, display: "flex", justifyContent: "space-between", alignItems: "center" } },
                                React.createElement("span", { style: { fontSize: 11, color: "#555" } }, "Totale"),
                                React.createElement("span", { style: { fontSize: 18, fontFamily: "'DM Serif Display',serif", color } }, fmt(val)))),
                            val > 0 && (React.createElement("div", { style: { marginTop: 8, display: "flex", justifyContent: "space-between", alignItems: "center" } },
                                React.createElement("span", { style: { fontSize: 11, color: "#555" } }, t("contribution")),
                                React.createElement("span", { style: { fontSize: 16, fontFamily: "'DM Serif Display',serif", color } }, pct(p))))));
                    })),
                    total > 0 && (React.createElement("div", { style: { background: "#141418", border: "1px solid #222", borderRadius: 14, padding: 18 } },
                        React.createElement("div", { style: { display: "flex", justifyContent: "space-between", marginBottom: 12 } },
                            React.createElement("span", { style: { fontSize: 12, color: "#555" } }, t("familyTotal")),
                            React.createElement("span", { style: { fontSize: 22, fontFamily: "'DM Serif Display',serif", color: "#e8c547" } }, fmt(total))),
                        React.createElement("div", { style: { height: 8, borderRadius: 4, overflow: "hidden", display: "flex", marginBottom: 8 } },
                            React.createElement("div", { style: { width: `${diegoPct}%`, background: "#4a9eff", transition: "width 0.6s ease" } }),
                            React.createElement("div", { style: { width: `${carmenPct}%`, background: "#ff6b9d", transition: "width 0.6s ease" } })),
                        React.createElement("div", { style: { display: "flex", justifyContent: "space-between" } },
                            React.createElement("span", { style: { fontSize: 12, color: "#4a9eff" } },
                                "\u25CF ",
                                N1,
                                " ",
                                fmt(diegoVal),
                                " (",
                                diegoPct.toFixed(1),
                                "%)"),
                            React.createElement("span", { style: { fontSize: 12, color: "#ff6b9d" } },
                                N2,
                                " ",
                                fmt(carmenVal),
                                " (",
                                carmenPct.toFixed(1),
                                "%) \u25CF"))))));
            })(),
            (tab === "budget" && subTab === "plan") && (React.createElement("div", null,
                total === 0 && (React.createElement("div", { style: { background: "rgba(232,197,71,0.07)", border: "1px solid rgba(232,197,71,0.2)", borderRadius: 10, padding: "10px 14px", fontSize: 12, color: "#e8c547", marginBottom: 16 } }, "\u26A0\uFE0F Inserisci gli stipendi in Entrate per il calcolo automatico")),
                (() => {
                    const prevMonth = month === 0 ? 11 : month - 1;
                    const prevYear = month === 0 ? year - 1 : year;
                    const prevKey = `${prevYear}-${String(prevMonth + 1).padStart(2, "0")}`;
                    const prevPlan = plan[prevKey];
                    const currentEmpty = !plan[key] || Object.keys(plan[key]).length === 0;
                    const hasPrev = prevPlan && Object.keys(prevPlan).length > 0;
                    if (!hasPrev)
                        return null;
                    if (!currentEmpty && !confirmCopy) {
                        return (React.createElement("button", { onClick: () => setConfirmCopy(true), style: {
                                width: "100%", display: "flex", alignItems: "center", justifyContent: "center", gap: 8,
                                background: "rgba(255,255,255,0.03)", border: "1px dashed #2a2a35",
                                borderRadius: 10, padding: "11px 16px", marginBottom: 16,
                                color: "#555", fontSize: 13, fontWeight: 500
                            } },
                            React.createElement("span", { style: { fontSize: 15 } }, "\u2398"),
                            "Copia Plan da ",
                            MONTHS[prevMonth],
                            " ",
                            prevYear,
                            React.createElement("span", { style: { fontSize: 10, color: "#3a3a44" } }, "(sovrascrive)")));
                    }
                    if (!currentEmpty && confirmCopy) {
                        return (React.createElement("div", { style: { background: "rgba(232,197,71,0.08)", border: "1px solid rgba(232,197,71,0.3)", borderRadius: 10, padding: "12px 14px", marginBottom: 16 } },
                            React.createElement("div", { style: { fontSize: 13, color: "#e8c547", marginBottom: 10 } },
                                "\u26A0\uFE0F Sovrascrivere ",
                                MONTHS[month],
                                " ",
                                year,
                                " con i valori di ",
                                MONTHS[prevMonth],
                                " ",
                                prevYear,
                                "?"),
                            React.createElement("div", { style: { display: "flex", gap: 8 } },
                                React.createElement("button", { onClick: () => { savePlan(Object.assign(Object.assign({}, plan), { [key]: Object.assign({}, prevPlan) })); setConfirmCopy(false); }, style: { flex: 1, background: "#e8c547", color: "#0d0d0f", borderRadius: 8, padding: "9px", fontSize: 13, fontWeight: 700 } }, "S\u00EC, copia"),
                                React.createElement("button", { onClick: () => setConfirmCopy(false), style: { flex: 1, background: "#1f1f28", color: "#888", borderRadius: 8, padding: "9px", fontSize: 13 } }, "Annulla"))));
                    }
                    // Current month is empty ‚Üí copy directly
                    return (React.createElement("button", { onClick: () => savePlan(Object.assign(Object.assign({}, plan), { [key]: Object.assign({}, prevPlan) })), style: {
                            width: "100%", display: "flex", alignItems: "center", justifyContent: "center", gap: 8,
                            background: "rgba(232,197,71,0.1)", border: "1px dashed rgba(232,197,71,0.4)",
                            borderRadius: 10, padding: "11px 16px", marginBottom: 16,
                            color: "#e8c547", fontSize: 13, fontWeight: 600
                        } },
                        React.createElement("span", { style: { fontSize: 15 } }, "\u2398"),
                        "Copia Plan da ",
                        MONTHS[prevMonth],
                        " ",
                        prevYear));
                })(),
                React.createElement("div", { style: { display: isMobile ? "block" : "grid", gridTemplateColumns: "minmax(0,1fr) minmax(0,400px)", gap: 20, alignItems: "start", paddingRight: isMobile ? 0 : 4, overflow: "visible" } }, sections.map(sectionName => {
                    const sectionGroups = structure.filter(g => g.section === sectionName);
                    if (!sectionGroups.length)
                        return null;
                    const sectionInfo = SECTION_LABELS[sectionName];
                    const sectionTotal = sectionGroups.reduce((acc, g) => acc + getGroupTotal(g), 0);
                    const isSecCollapsed = collapsed[`sec_${sectionName}`];
                    return (React.createElement("div", { key: sectionName, style: { marginBottom: 18 } },
                        React.createElement("button", { onClick: () => toggleCollapse(`sec_${sectionName}`), style: { width: "100%", display: "flex", alignItems: "center", justifyContent: "space-between", background: `${sectionInfo.color}18`, border: `1.5px solid ${sectionInfo.color}44`, borderRadius: isSecCollapsed ? 12 : "12px 12px 0 0", padding: "11px 16px", position: "sticky", top: isMobile ? 110 : 106, zIndex: 10, backdropFilter: "blur(12px)" } },
                            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8 } },
                                React.createElement("div", { style: { width: 4, height: 20, borderRadius: 2, background: sectionInfo.color } }),
                                React.createElement("span", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 16, color: sectionInfo.color } }, t(sectionInfo.tKey)),
                                React.createElement("span", { style: { fontSize: 10, color: "#444", fontStyle: "italic" } }, sectionName === "COMUNE" ? t("autoSplit") : t("manualSplit"))),
                            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8 } },
                                sectionTotal > 0 && React.createElement("span", { style: { fontSize: 14, fontFamily: "'DM Serif Display',serif", color: "#e8c547" } }, fmt(sectionTotal)),
                                React.createElement("span", { style: { color: "#444", fontSize: 11 } }, isSecCollapsed ? "‚ñ∂" : "‚ñº"))),
                        !isSecCollapsed && (React.createElement("div", { style: { border: `1.5px solid ${sectionInfo.color}44`, borderTop: "none", borderRadius: "0 0 12px 12px", overflow: "hidden" } }, sectionGroups.map((group, gi) => {
                            const groupTotal = getGroupTotal(group);
                            const isGroupCollapsed = collapsed[group.id];
                            return (React.createElement("div", { key: group.id, style: { borderTop: gi > 0 ? "1px solid #1c1c24" : "none" } },
                                React.createElement("button", { onClick: () => toggleCollapse(group.id), style: { width: "100%", display: "flex", alignItems: "center", justifyContent: "space-between", background: group.bg, padding: "9px 16px" } },
                                    React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8 } },
                                        React.createElement("span", { className: "tag", style: { background: group.pill } }, group.label),
                                        groupTotal > 0 && React.createElement("span", { style: { fontSize: 12, color: "#888" } }, fmt(groupTotal))),
                                    React.createElement("span", { style: { color: "#444", fontSize: 11 } }, isGroupCollapsed ? "‚ñ∂" : "‚ñº")),
                                !isGroupCollapsed && (React.createElement("div", { style: { background: "#0f0f13", display: isMobile ? "block" : "grid", gridTemplateColumns: isMobile ? "1fr" : "repeat(auto-fill, minmax(340px, 1fr))" } },
                                    group.items.map((item, idx) => {
                                        const isManual = group.splitMode === "manual";
                                        const autoAmt = parseFloat(currentPlan[item.id]) || 0;
                                        const manualVal = currentPlan[item.id] || {};
                                        const roundFn = group.id === "vaults" ? Math.ceil : (x) => Math.round(x * 100) / 100;
                                        const dAmt = isManual ? (parseFloat(manualVal.diego) || 0) : roundFn(autoAmt * (diegoPct / 100));
                                        const cAmt = isManual ? (parseFloat(manualVal.carmen) || 0) : roundFn(autoAmt * (carmenPct / 100));
                                        const rowTotal = isManual ? dAmt + cAmt : autoAmt;
                                        const hasDesc = !!item.desc;
                                        const isDescOpen = expandedDesc[item.id];
                                        return (React.createElement("div", { key: item.id, draggable: true, onDragStart: () => setDragItem({ groupId: group.id, itemId: item.id, index: idx }), onDragEnd: () => { setDragItem(null); setDragOver(null); }, onDragOver: e => { e.preventDefault(); setDragOver({ groupId: group.id, index: idx }); }, onDrop: () => { if (dragItem && dragItem.groupId === group.id)
                                                reorderItem(group.id, dragItem.index, idx); setDragItem(null); setDragOver(null); }, style: { borderTop: "1px solid #181820", padding: "11px 16px", cursor: "grab", opacity: (dragItem === null || dragItem === void 0 ? void 0 : dragItem.itemId) === item.id ? 0.4 : 1, background: (dragOver === null || dragOver === void 0 ? void 0 : dragOver.groupId) === group.id && (dragOver === null || dragOver === void 0 ? void 0 : dragOver.index) === idx && (dragItem === null || dragItem === void 0 ? void 0 : dragItem.itemId) !== item.id ? "rgba(232,197,71,0.06)" : "transparent", borderLeft: (dragOver === null || dragOver === void 0 ? void 0 : dragOver.groupId) === group.id && (dragOver === null || dragOver === void 0 ? void 0 : dragOver.index) === idx && (dragItem === null || dragItem === void 0 ? void 0 : dragItem.itemId) !== item.id ? "2px solid #e8c547" : "2px solid transparent", transition: "background 0.15s, border-color 0.15s" } },
                                            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 6, marginBottom: editingItem === item.id ? 0 : 8 } },
                                                React.createElement("div", { style: { color: "#333", fontSize: 14, cursor: "grab", flexShrink: 0, lineHeight: 1, userSelect: "none" } }, "\u283F"),
                                                React.createElement("span", { style: { flex: 1, fontSize: 13, color: "#d0ccc7", fontWeight: 500 } }, item.name),
                                                item.day && editingItem !== item.id && React.createElement("span", { style: { fontSize: 10, color: "#e8c547", background: "rgba(232,197,71,0.1)", border: "1px solid rgba(232,197,71,0.25)", borderRadius: 5, padding: "1px 6px", flexShrink: 0 } },
                                                    t("dayLabel"),
                                                    " ",
                                                    item.day),
                                                !editingItem || editingItem !== item.id ? (React.createElement("button", { onClick: () => { setEditingItem(item.id); setEditItemDraft({ day: item.day || "", desc: item.desc || "" }); }, style: { fontSize: 10, color: "#444", padding: "1px 6px", border: "1px solid #2a2a35", borderRadius: 4 } }, "\u270F\uFE0F")) : null,
                                                React.createElement("button", { onClick: () => removeItem(group.id, item.id), style: { color: "#2a2a35", fontSize: 16, padding: "0 2px" } }, "\u00D7")),
                                            editingItem === item.id && (React.createElement("div", { style: { background: "#0f0f14", border: "1px solid #2a2a35", borderRadius: 8, padding: "10px 12px", marginBottom: 8, marginTop: 6 } },
                                                React.createElement("div", { style: { display: "flex", gap: 8, marginBottom: 8 } },
                                                    React.createElement("div", { style: { flex: "0 0 80px" } },
                                                        React.createElement("div", { style: { fontSize: 9, color: "#e8c547", fontWeight: 700, letterSpacing: 0.8, marginBottom: 4 } }, "GIORNO"),
                                                        React.createElement("input", { type: "number", placeholder: "\u2014", min: "1", max: "31", value: editItemDraft.day, onChange: e => setEditItemDraft(d => (Object.assign(Object.assign({}, d), { day: e.target.value }))), style: { padding: "6px 10px", fontSize: 13, textAlign: "center" } })),
                                                    React.createElement("div", { style: { flex: 1 } },
                                                        React.createElement("div", { style: { fontSize: 9, color: "#888", fontWeight: 700, letterSpacing: 0.8, marginBottom: 4 } }, "DESCRIZIONE"),
                                                        React.createElement("input", { type: "text", placeholder: "Note opzionali...", value: editItemDraft.desc, onChange: e => setEditItemDraft(d => (Object.assign(Object.assign({}, d), { desc: e.target.value }))), style: { padding: "6px 10px", fontSize: 12 } }))),
                                                React.createElement("div", { style: { display: "flex", gap: 6 } },
                                                    React.createElement("button", { onClick: () => updateItemMeta(group.id, item.id, editItemDraft.day, editItemDraft.desc), style: { flex: 1, background: "#e8c547", color: "#0d0d0f", borderRadius: 6, padding: "6px", fontSize: 12, fontWeight: 700 } }, "\uD83D\uDCBE Salva"),
                                                    React.createElement("button", { onClick: () => setEditingItem(null), style: { background: "#1f1f28", color: "#888", borderRadius: 6, padding: "6px 12px", fontSize: 12 } }, "\u2715")))),
                                            !editingItem || editingItem !== item.id ? (hasDesc && isDescOpen && (React.createElement("div", { style: { background: "#141418", borderRadius: 7, padding: "7px 10px", fontSize: 11, color: "#666", marginBottom: 8, lineHeight: 1.6 } }, item.desc))) : null,
                                            !isManual ? (React.createElement("div", { style: { position: "relative", marginBottom: autoAmt > 0 ? 8 : 0 } },
                                                React.createElement("span", { style: { position: "absolute", left: 12, top: "50%", transform: "translateY(-50%)", color: "#555", fontSize: 13 } }, "\u20AC"),
                                                React.createElement("input", { type: "number", placeholder: "0,00", value: currentPlan[item.id] || "", onChange: e => updateAutoItem(item.id, e.target.value), style: { paddingLeft: 27, padding: "8px 12px 8px 27px" } }))) : (React.createElement("div", { style: { display: "flex", gap: 8, marginBottom: rowTotal > 0 ? 8 : 0 } }, ["diego", "carmen"].map(p => (React.createElement("div", { key: p, style: { flex: 1 } },
                                                React.createElement("div", { style: { fontSize: 9, color: p === "diego" ? "#4a9eff" : "#ff6b9d", fontWeight: 700, letterSpacing: 0.8, marginBottom: 4 } }, p === "diego" ? N1 : N2),
                                                React.createElement("div", { style: { position: "relative" } },
                                                    React.createElement("span", { style: { position: "absolute", left: 10, top: "50%", transform: "translateY(-50%)", color: "#555", fontSize: 12 } }, "\u20AC"),
                                                    React.createElement("input", { type: "number", placeholder: "0", value: manualVal[p] || "", onChange: e => updateManualItem(item.id, p, e.target.value), style: { paddingLeft: 24, padding: "8px 10px 8px 24px", fontSize: 13 } }))))))),
                                            !isManual && autoAmt > 0 && total > 0 && (React.createElement("div", { style: { display: "flex", gap: 6 } }, [["diego", "#4a9eff", dAmt], ["carmen", "#ff6b9d", cAmt]].map(([p, c, a]) => (React.createElement("div", { key: p, style: { flex: 1, background: `${c}0d`, border: `1px solid ${c}1a`, borderRadius: 7, padding: "5px 10px" } },
                                                React.createElement("div", { style: { fontSize: 9, color: c, fontWeight: 700, marginBottom: 1 } }, p === "diego" ? N1 : N2),
                                                React.createElement("div", { style: { fontSize: 13 } }, fmt(a))))))),
                                            isManual && rowTotal > 0 && React.createElement("div", { style: { fontSize: 11, color: "#555", textAlign: "right" } },
                                                "Totale: ",
                                                fmt(rowTotal))));
                                    }),
                                    React.createElement("button", { onClick: () => addItem(group.id), style: { width: "100%", padding: "9px 16px", borderTop: "1px dashed #1c1c24", color: "#3a3a44", fontSize: 12, textAlign: "left" } }, "+ Aggiungi voce")))));
                        })))));
                })),
                planTotals.grandTotal > 0 && (React.createElement("div", { style: { background: "#131317", border: "1px solid #222", borderRadius: 14, padding: 18 } },
                    React.createElement("div", { style: { fontSize: 10, color: "#444", letterSpacing: 1.5, textTransform: "uppercase", marginBottom: 14 } },
                        t("planSummary"),
                        " ",
                        MONTHS[month],
                        " ",
                        year),
                    React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 12 } },
                        React.createElement("span", { style: { color: "#666", fontSize: 13 } }, t("grandTotal")),
                        React.createElement("span", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 26, color: "#e8c547" } }, fmt(planTotals.grandTotal))),
                    React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 4, marginBottom: 14 } }, [[t("sectionComune"), planTotals.comuneTotal, "#c0392b"], [t("sectionPersonale"), planTotals.personaleTotal, "#8e44ad"], [t("sectionRisparmi"), planTotals.rispTotal, "#27ae60"]].filter(r => r[1] > 0).map(([l, v, c]) => (React.createElement("div", { key: l, style: { display: "flex", justifyContent: "space-between" } },
                        React.createElement("span", { style: { fontSize: 12, color: c } },
                            "\u25CF ",
                            l),
                        React.createElement("span", { style: { fontSize: 12, color: "#888" } }, fmt(v)))))),
                    React.createElement("div", { style: { height: 1, background: "#1f1f28", marginBottom: 14 } }),
                    React.createElement("div", { style: { display: "flex", gap: 10 } }, [[N1, diegoPct, planTotals.dTotal, "#4a9eff"], [N2, carmenPct, planTotals.cTotal, "#ff6b9d"]].map(([l, p, v, c]) => (React.createElement("div", { key: l, style: { flex: 1, background: `${c}12`, border: `1px solid ${c}22`, borderRadius: 10, padding: "12px 14px" } },
                        React.createElement("div", { style: { fontSize: 9, color: c, fontWeight: 700, letterSpacing: 1, marginBottom: 4 } },
                            l,
                            " (",
                            p.toFixed(1),
                            "%)"),
                        React.createElement("div", { style: { fontSize: 19, fontWeight: 600 } }, fmt(v)))))))))),
            (tab === "spese" && subTab === "uscite") && (React.createElement("div", null,
                React.createElement("div", { style: { display: "flex", gap: 10, marginBottom: 16 } },
                    React.createElement("div", { style: { flex: 1, background: "#141418", border: "1px solid #222", borderRadius: 12, padding: "14px 16px" } },
                        React.createElement("div", { style: { fontSize: 10, color: "#555", letterSpacing: 1, textTransform: "uppercase", marginBottom: 6 } },
                            "Totale ",
                            MONTHS[month]),
                        React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 22, color: "#e8c547" } }, fmt(totalMonthUscite)),
                        React.createElement("div", { style: { fontSize: 11, color: "#444", marginTop: 2 } },
                            allMonthUscite.length,
                            " ",
                            t("numExpenses"))),
                    React.createElement("div", { style: { flex: 1, display: "flex", flexDirection: "column", gap: 6 } }, catTotals.slice(0, 3).map(c => (React.createElement("div", { key: c.id, style: { background: c.bg, borderRadius: 8, padding: "6px 10px", display: "flex", justifyContent: "space-between", alignItems: "center" } },
                        React.createElement("span", { style: { fontSize: 10, color: c.color, fontWeight: 700 } }, c.label),
                        React.createElement("span", { style: { fontSize: 12, color: "#ccc" } }, fmt(c.total))))))),
                React.createElement("button", { onClick: () => { setShowForm(!showForm); if (showForm) {
                        setEditingId(null);
                        setNewEsercente("");
                        setNewAmount("");
                        setNewDate(today());
                        setNewCat(CATEGORIE[0].id);
                    } }, style: { width: "100%", background: showForm ? "#1f1f28" : "#e8c547", color: showForm ? "#555" : "#0d0d0f", borderRadius: 12, padding: "12px", fontSize: 14, fontWeight: 600, marginBottom: 14, transition: "all 0.2s" } }, showForm ? "‚úï Annulla" : t("newExpense")),
                showForm && (React.createElement("div", { style: { background: "#141418", border: "1px solid #252530", borderRadius: 14, padding: 16, marginBottom: 16 } },
                    React.createElement("div", { style: { fontSize: 11, color: "#555", letterSpacing: 1, textTransform: "uppercase", marginBottom: 12 } }, editingId ? t("editExpense") : t("newExpense")),
                    React.createElement("div", { style: { display: isMobile ? "flex" : "grid", flexDirection: "column", gridTemplateColumns: isMobile ? "1fr" : "repeat(auto-fill, minmax(420px, 1fr))", gap: 10 } },
                        React.createElement("div", null,
                            React.createElement("div", { style: { fontSize: 11, color: "#666", marginBottom: 5 } }, t("category")),
                            React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 6 } }, CATEGORIE.map(c => (React.createElement("button", { key: c.id, onClick: () => setNewCat(c.id), style: { padding: "5px 12px", borderRadius: 20, fontSize: 11, fontWeight: 700, letterSpacing: 0.6, background: newCat === c.id ? c.color : "transparent", color: newCat === c.id ? "#fff" : c.color, border: `1.5px solid ${c.color}`, transition: "all 0.15s" } }, c.label))))),
                        React.createElement("div", null,
                            React.createElement("div", { style: { fontSize: 11, color: "#666", marginBottom: 5 } }, t("merchant")),
                            React.createElement("input", { type: "text", placeholder: t("merchantPlaceholder"), value: newEsercente, onChange: e => setNewEsercente(e.target.value) })),
                        React.createElement("div", { style: { display: "flex", gap: 8 } },
                            React.createElement("div", { style: { flex: 1 } },
                                React.createElement("div", { style: { fontSize: 11, color: "#666", marginBottom: 5 } }, t("date")),
                                React.createElement("input", { type: "date", value: newDate, onChange: e => setNewDate(e.target.value) })),
                            React.createElement("div", { style: { flex: 1 } },
                                React.createElement("div", { style: { fontSize: 11, color: "#666", marginBottom: 5 } }, t("amount")),
                                React.createElement("div", { style: { position: "relative" } },
                                    React.createElement("span", { style: { position: "absolute", left: 13, top: "50%", transform: "translateY(-50%)", color: "#555" } }, "\u20AC"),
                                    React.createElement("input", { type: "number", placeholder: "0,00", value: newAmount, onChange: e => setNewAmount(e.target.value), style: { paddingLeft: 28 } })))),
                        React.createElement("button", { onClick: addUscita, style: { background: "#e8c547", color: "#0d0d0f", borderRadius: 10, padding: "12px", fontSize: 14, fontWeight: 700, marginTop: 2 } }, editingId ? t("saveChanges") : t("saveExpense"))))),
                allMonthUscite.length > 0 && (React.createElement("div", { style: { display: "flex", gap: 8, marginBottom: 14 } },
                    React.createElement("select", { value: filterCat, onChange: e => setFilterCat(e.target.value), style: { flex: 1, padding: "7px 10px", fontSize: 12 } },
                        React.createElement("option", { value: "all" }, t("allCategories")),
                        CATEGORIE.map(c => React.createElement("option", { key: c.id, value: c.id }, c.label))),
                    React.createElement("select", { value: sortBy, onChange: e => setSortBy(e.target.value), style: { flex: 1, padding: "7px 10px", fontSize: 12 } },
                        React.createElement("option", { value: "date_desc" }, t("sortDateDesc")),
                        React.createElement("option", { value: "date_asc" }, t("sortDateAsc")),
                        React.createElement("option", { value: "amount_desc" }, t("sortAmountDesc")),
                        React.createElement("option", { value: "cat" }, t("sortByCat"))))),
                filteredUscite.length === 0 && (React.createElement("div", { style: { textAlign: "center", color: "#333", fontSize: 13, padding: "40px 0" } }, allMonthUscite.length === 0 ? t("noExpenses") : t("noFilter"))),
                React.createElement("div", { style: { display: isMobile ? "flex" : "grid", flexDirection: "column", gridTemplateColumns: isMobile ? "1fr" : "repeat(auto-fill, minmax(380px, 1fr))", gap: 8 } }, filteredUscite.map(u => {
                    const cat = getCat(u.categoria);
                    const d = new Date(u.date);
                    const dateStr = `${String(d.getDate()).padStart(2, "0")}/${String(d.getMonth() + 1).padStart(2, "0")}`;
                    return (React.createElement("div", { key: u.id, style: { background: u.isScheduled ? "rgba(41,128,185,0.06)" : "#141418", borderRadius: 11, padding: "12px 14px", display: "flex", alignItems: "center", gap: 12, borderLeft: `3px solid ${cat.color}`, opacity: u.isScheduled ? 0.85 : 1 } },
                        React.createElement("div", { style: { flex: 1, minWidth: 0 } },
                            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 7, marginBottom: 3 } },
                                React.createElement("span", { className: "tag", style: { background: cat.color, fontSize: 9 } }, cat.label),
                                React.createElement("span", { style: { fontSize: 11, color: "#555" } }, dateStr),
                                u.isScheduled && React.createElement("span", { style: { fontSize: 9, color: "#2980b9", background: "rgba(41,128,185,0.15)", borderRadius: 4, padding: "1px 5px", fontWeight: 700 } }, "AUTO")),
                            React.createElement("div", { style: { fontSize: 14, color: "#ddd", fontWeight: 500, overflow: "hidden", textOverflow: "ellipsis", whiteSpace: "nowrap" } }, u.esercente || React.createElement("span", { style: { color: "#444", fontStyle: "italic" } }, "\u2014"))),
                        React.createElement("div", { style: { fontSize: 16, fontFamily: "'DM Serif Display',serif", color: "#f0ede8", flexShrink: 0 } }, fmt(u.amount)),
                        !u.isScheduled && React.createElement("button", { onClick: () => startEdit(u), style: { color: "#555", fontSize: 14, padding: "0 3px", flexShrink: 0 } }, "\u270F\uFE0F"),
                        !u.isScheduled && React.createElement("button", { onClick: () => deleteUscita(u.id), style: { color: "#2a2a35", fontSize: 18, padding: "0 2px", flexShrink: 0 } }, "\u00D7"),
                        u.isScheduled && React.createElement("span", { style: { fontSize: 11, color: "#2a2a35", flexShrink: 0 } }, "\uD83D\uDD12")));
                })),
                catTotals.length > 0 && (React.createElement("div", { style: { marginTop: 20, background: "#131317", border: "1px solid #1f1f28", borderRadius: 12, padding: 16 } },
                    React.createElement("div", { style: { fontSize: 10, color: "#444", letterSpacing: 1.5, textTransform: "uppercase", marginBottom: 12 } }, t("byCategory")),
                    catTotals.map(c => (React.createElement("div", { key: c.id, style: { display: "flex", alignItems: "center", gap: 10, marginBottom: 8 } },
                        React.createElement("span", { className: "tag", style: { background: c.color, minWidth: 100 } }, c.label),
                        React.createElement("div", { style: { flex: 1, height: 4, borderRadius: 2, background: "#1f1f28", overflow: "hidden" } },
                            React.createElement("div", { style: { height: "100%", width: `${(c.total / totalMonthUscite) * 100}%`, background: c.color, borderRadius: 2 } })),
                        React.createElement("span", { style: { fontSize: 13, color: "#aaa", minWidth: 70, textAlign: "right" } }, fmt(c.total))))))))),
            (tab === "budget" && subTab === "daily") && (() => {
                // Budget mensile = totale Revolut Cointestato dal Plan
                const revGroup = structure.find(g => g.id === "revolut_cointestato");
                const budgetMensile = revGroup
                    ? revGroup.items.reduce((acc, item) => acc + (parseFloat(currentPlan[item.id]) || 0), 0)
                    : 0;
                // Scheduled items (programmati dal Plan con giorno fisso)
                const scheduledPerGiorno = {};
                if (revGroup) {
                    revGroup.items.forEach(item => {
                        if (item.day && currentPlan[item.id]) {
                            const amt = parseFloat(currentPlan[item.id]) || 0;
                            if (amt > 0) {
                                if (!scheduledPerGiorno[item.day])
                                    scheduledPerGiorno[item.day] = [];
                                scheduledPerGiorno[item.day].push({ name: item.name, amount: amt });
                            }
                        }
                    });
                }
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const todayDate = new Date();
                const isCurrentMonth = todayDate.getFullYear() === year && todayDate.getMonth() === month;
                const todayDay = isCurrentMonth ? todayDate.getDate() : daysInMonth;
                // Aggregate uscite by day (exclude programmati - already in plan)
                const spesaPerGiorno = {};
                monthUscite.filter(u => u.categoria !== "programmati").forEach(u => {
                    const d = new Date(u.date).getDate();
                    spesaPerGiorno[d] = (spesaPerGiorno[d] || 0) + u.amount;
                });
                // Build running totals
                let runningBudget = budgetMensile;
                const days = [];
                for (let d = 1; d <= daysInMonth; d++) {
                    const speso = spesaPerGiorno[d] || 0;
                    const scheduled = scheduledPerGiorno[d] || [];
                    const scheduledTotal = scheduled.reduce((a, s) => a + s.amount, 0);
                    const totalDay = speso + scheduledTotal;
                    const giorniRimanenti = daysInMonth - d;
                    runningBudget -= totalDay;
                    const budgetGiornaliero = giorniRimanenti > 0 ? runningBudget / giorniRimanenti : runningBudget;
                    const isPast = d < todayDay;
                    const isToday = d === todayDay;
                    const isFuture = d > todayDay;
                    const date = new Date(year, month, d);
                    const dowLabel = ["Dom", "Lun", "Mar", "Mer", "Gio", "Ven", "Sab"][date.getDay()];
                    days.push({ d, speso, scheduled, scheduledTotal, totalDay, runningBudget, budgetGiornaliero, isPast, isToday, isFuture, dowLabel, giorniRimanenti });
                }
                const budgetGiornalieroIniziale = daysInMonth > 0 ? budgetMensile / daysInMonth : 0;
                const spesaTotaleFinora = monthUscite.reduce((a, u) => a + u.amount, 0);
                const rimanente = budgetMensile - spesaTotaleFinora;
                const giorniRimanentiOggi = daysInMonth - todayDay;
                const budgetGiornalieroOggi = giorniRimanentiOggi > 0 ? rimanente / giorniRimanentiOggi : rimanente;
                const isUnderBudget = rimanente >= 0;
                if (budgetMensile === 0)
                    return (React.createElement("div", { style: { textAlign: "center", padding: "40px 20px" } },
                        React.createElement("div", { style: { fontSize: 32, marginBottom: 12 } }, "\uD83D\uDCCB"),
                        React.createElement("div", { style: { color: "#555", fontSize: 14 } }, t("noPlanData"))));
                return (React.createElement("div", null,
                    React.createElement("div", { style: { display: "grid", gridTemplateColumns: isMobile ? "1fr 1fr" : "repeat(4, 1fr)", gap: 10, marginBottom: 16 } },
                        React.createElement("div", { style: { background: "#141418", border: "1px solid #222", borderRadius: 12, padding: "14px 16px" } },
                            React.createElement("div", { style: { fontSize: 10, color: "#555", letterSpacing: 1, textTransform: "uppercase", marginBottom: 5 } }, t("dailyBudget")),
                            React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 20, color: "#e8c547" } }, fmt(budgetMensile)),
                            React.createElement("div", { style: { fontSize: 11, color: "#555", marginTop: 2 } }, t("revolut"))),
                        React.createElement("div", { style: { background: isUnderBudget ? "rgba(39,174,96,0.08)" : "rgba(231,76,60,0.08)", border: `1px solid ${isUnderBudget ? "rgba(39,174,96,0.2)" : "rgba(231,76,60,0.2)"}`, borderRadius: 12, padding: "14px 16px" } },
                            React.createElement("div", { style: { fontSize: 10, color: "#555", letterSpacing: 1, textTransform: "uppercase", marginBottom: 5 } }, t("remaining")),
                            React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 20, color: isUnderBudget ? "#27ae60" : "#e74c3c" } }, fmt(rimanente)),
                            React.createElement("div", { style: { fontSize: 11, color: "#555", marginTop: 2 } },
                                t("spent"),
                                ": ",
                                fmt(spesaTotaleFinora))),
                        React.createElement("div", { style: { background: "#141418", border: "1px solid #222", borderRadius: 12, padding: "14px 16px" } },
                            React.createElement("div", { style: { fontSize: 10, color: "#555", letterSpacing: 1, textTransform: "uppercase", marginBottom: 5 } }, t("initialAvg")),
                            React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 20, color: "#aaa" } }, fmt(budgetGiornalieroIniziale)),
                            React.createElement("div", { style: { fontSize: 11, color: "#555", marginTop: 2 } },
                                daysInMonth,
                                " ",
                                t("daysLeft").split(" ").pop())),
                        React.createElement("div", { style: { background: budgetGiornalieroOggi >= budgetGiornalieroIniziale ? "rgba(39,174,96,0.08)" : "rgba(231,76,60,0.08)", border: `1px solid ${budgetGiornalieroOggi >= budgetGiornalieroIniziale ? "rgba(39,174,96,0.2)" : "rgba(231,76,60,0.2)"}`, borderRadius: 12, padding: "14px 16px" } },
                            React.createElement("div", { style: { fontSize: 10, color: "#555", letterSpacing: 1, textTransform: "uppercase", marginBottom: 5 } }, t("updatedAvg")),
                            React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 20, color: budgetGiornalieroOggi >= budgetGiornalieroIniziale ? "#27ae60" : "#e74c3c" } }, fmt(budgetGiornalieroOggi)),
                            React.createElement("div", { style: { fontSize: 11, color: "#555", marginTop: 2 } },
                                giorniRimanentiOggi,
                                " ",
                                t("daysLeft")))),
                    React.createElement("div", { style: { background: "#141418", border: "1px solid #222", borderRadius: 12, padding: "12px 16px", marginBottom: 16 } },
                        React.createElement("div", { style: { display: "flex", justifyContent: "space-between", fontSize: 11, color: "#555", marginBottom: 8 } },
                            React.createElement("span", null, t("budgetUse")),
                            React.createElement("span", null,
                                budgetMensile > 0 ? ((spesaTotaleFinora / budgetMensile) * 100).toFixed(1) : 0,
                                "%")),
                        React.createElement("div", { style: { height: 8, borderRadius: 4, background: "#1f1f28", overflow: "hidden" } },
                            React.createElement("div", { style: { height: "100%", width: `${Math.min((spesaTotaleFinora / budgetMensile) * 100, 100)}%`, background: isUnderBudget ? "#27ae60" : "#e74c3c", borderRadius: 4, transition: "width 0.5s ease" } })),
                        React.createElement("div", { style: { position: "relative", height: 14 } },
                            React.createElement("div", { style: { position: "absolute", left: `${((todayDay - 1) / daysInMonth) * 100}%`, top: 2, width: 2, height: 10, background: "#e8c547", borderRadius: 1 } })),
                        React.createElement("div", { style: { fontSize: 10, color: "#444", textAlign: "center" } },
                            "\u25B2 ",
                            t("todayMarker"),
                            " (",
                            todayDay,
                            " ",
                            MONTHS[month],
                            ")")),
                    React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 3 } }, days.map(({ d, speso, scheduled, scheduledTotal, totalDay, runningBudget, budgetGiornaliero, isPast, isToday, isFuture, dowLabel, giorniRimanenti }) => {
                        const isSunSat = new Date(year, month, d).getDay() === 0 || new Date(year, month, d).getDay() === 6;
                        const bgColor = isToday ? "rgba(232,197,71,0.08)" : isFuture ? "#0f0f12" : "#141418";
                        const borderColor = isToday ? "rgba(232,197,71,0.4)" : "transparent";
                        const overBudgetDay = isPast && speso > (budgetMensile / daysInMonth) * 1.5;
                        return (React.createElement("div", { key: d, style: { background: bgColor, border: `1px solid ${borderColor}`, borderRadius: 8, padding: "9px 12px" } },
                            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } },
                                React.createElement("div", { style: { width: 38, flexShrink: 0 } },
                                    React.createElement("div", { style: { fontSize: 10, color: isSunSat ? "#e8c547" : "#555", textTransform: "uppercase" } }, dowLabel),
                                    React.createElement("div", { style: { fontSize: 15, fontWeight: isToday ? 700 : 400, color: isToday ? "#e8c547" : isFuture ? "#333" : "#ddd" } }, d)),
                                React.createElement("div", { style: { flex: 1, minWidth: 0 } },
                                    speso > 0 && (React.createElement("div", { style: { fontSize: 14, color: "#ddd", fontWeight: 500 } }, fmt(speso))),
                                    scheduled.length > 0 && scheduled.map((s, i) => (React.createElement("div", { key: i, style: { display: "flex", alignItems: "center", gap: 5, marginTop: i === 0 && speso === 0 ? 0 : 3 } },
                                        React.createElement("span", { style: { fontSize: 9, color: "#2980b9", background: "rgba(41,128,185,0.15)", borderRadius: 4, padding: "1px 5px", fontWeight: 700 } }, "AUTO"),
                                        React.createElement("span", { style: { fontSize: 11, color: "#666" } }, s.name),
                                        React.createElement("span", { style: { fontSize: 11, color: "#888", marginLeft: "auto" } }, fmt(s.amount))))),
                                    speso === 0 && scheduled.length === 0 && (React.createElement("div", { style: { fontSize: 13, color: isFuture ? "#252530" : "#2a2a35" } }, "\u2014"))),
                                !isFuture && giorniRimanenti > 0 && (React.createElement("div", { style: { textAlign: "right", flexShrink: 0 } },
                                    React.createElement("div", { style: { fontSize: 9, color: "#444", textTransform: "uppercase", letterSpacing: 0.6 } }, t("perDay")),
                                    React.createElement("div", { style: { fontSize: 13, color: budgetGiornaliero >= budgetGiornalieroIniziale ? "#27ae60" : budgetGiornaliero >= 0 ? "#e67e22" : "#e74c3c" } }, fmt(budgetGiornaliero)))),
                                React.createElement("div", { style: { textAlign: "right", minWidth: 72, flexShrink: 0 } }, !isFuture ? (React.createElement(React.Fragment, null,
                                    React.createElement("div", { style: { fontSize: 9, color: "#444", textTransform: "uppercase", letterSpacing: 0.6 } }, t("remaining")),
                                    React.createElement("div", { style: { fontSize: 13, fontWeight: 500, color: runningBudget >= 0 ? "#aaa" : "#e74c3c" } }, fmt(runningBudget)))) : (React.createElement("div", { style: { fontSize: 12, color: "#252530" } }, "\u00B7\u00B7\u00B7"))))));
                    }))));
            })(),
            (tab === "budget" && subTab === "overview") && (() => {
                const CAT_COLORS = { essential: "#e74c3c", extra: "#e67e22", saving: "#27ae60" };
                const CAT_LABELS = { essential: t("essential"), extra: t("extra"), saving: t("saving") };
                // Compute per-person per-cat totals for each month in history
                const allKeys = [...new Set([...Object.keys(history), ...Object.keys(plan)])].sort();
                const getMonthStats = (k) => {
                    const p = plan[k] || {};
                    const h = history[k] || {};
                    const dVal = parseFloat(h.diego) || 0;
                    const cVal = parseFloat(h.carmen) || 0;
                    const tot = dVal + cVal;
                    const dPct = tot > 0 ? dVal / tot : 0.5;
                    const cPct = tot > 0 ? cVal / tot : 0.5;
                    const stats = {
                        diego: { essential: 0, extra: 0, saving: 0, total: 0 },
                        carmen: { essential: 0, extra: 0, saving: 0, total: 0 },
                    };
                    PLAN_STRUCTURE.forEach(group => {
                        // use stored structure cat if available
                        const storedGroup = structure.find(g => g.id === group.id);
                        const items = storedGroup ? storedGroup.items : group.items;
                        items.forEach(item => {
                            const defaultItem = group.items.find(i => i.id === item.id);
                            const cat = item.cat || (defaultItem && defaultItem.cat) || "extra";
                            if (group.splitMode === "auto") {
                                const amt = parseFloat(p[item.id]) || 0;
                                const d = amt * dPct;
                                const c = amt * cPct;
                                stats.diego[cat] = (stats.diego[cat] || 0) + d;
                                stats.carmen[cat] = (stats.carmen[cat] || 0) + c;
                                stats.diego.total += d;
                                stats.carmen.total += c;
                            }
                            else {
                                const v = p[item.id] || {};
                                const d = parseFloat(v.diego) || 0;
                                const c = parseFloat(v.carmen) || 0;
                                stats.diego[cat] = (stats.diego[cat] || 0) + d;
                                stats.carmen[cat] = (stats.carmen[cat] || 0) + c;
                                stats.diego.total += d;
                                stats.carmen.total += c;
                            }
                        });
                    });
                    return stats;
                };
                // Build chart data for last 6 months
                const chartMonths = allKeys.slice(-6);
                const chartData = chartMonths.map(k => {
                    const [y, m] = k.split("-");
                    const label = MONTHS[parseInt(m) - 1].slice(0, 3);
                    const stats = getMonthStats(k);
                    return {
                        name: label,
                        key: k,
                        d_essential: Math.round(stats.diego.essential),
                        d_extra: Math.round(stats.diego.extra),
                        d_saving: Math.round(stats.diego.saving),
                        c_essential: Math.round(stats.carmen.essential),
                        c_extra: Math.round(stats.carmen.extra),
                        c_saving: Math.round(stats.carmen.saving),
                    };
                });
                // Current month stats
                const currentStats = getMonthStats(key);
                const [y2, m2] = key.split("-");
                const monthLabel = `${MONTHS[parseInt(m2) - 1]} ${y2}`;
                const CustomTooltip = ({ active, payload, label }) => {
                    if (!active || !payload)
                        return null;
                    return (React.createElement("div", { style: { background: "#1a1a22", border: "1px solid #2a2a35", borderRadius: 8, padding: "10px 14px" } },
                        React.createElement("div", { style: { fontSize: 12, color: "#e8c547", fontWeight: 600, marginBottom: 6 } }, label),
                        payload.map((p, i) => (React.createElement("div", { key: i, style: { fontSize: 11, color: p.color, marginBottom: 2 } },
                            p.name,
                            ": ",
                            fmt(p.value))))));
                };
                return (React.createElement("div", { style: { width: "100%", minWidth: 0 } },
                    React.createElement("div", { style: { fontSize: 10, color: "#555", letterSpacing: 1.5, textTransform: "uppercase", marginBottom: 20 } }, t("overviewTitle")),
                    React.createElement("div", { style: { display: "grid", gridTemplateColumns: isMobile ? "1fr 1fr" : "1fr 1fr", gap: isMobile ? 10 : 24, marginBottom: 24 } }, [[`diego`, N1, `#4a9eff`], [`carmen`, N2, `#ff6b9d`]].map(([p, label, color]) => (React.createElement("div", { key: p, style: { background: `${color}0d`, border: `1px solid ${color}22`, borderRadius: 14, padding: 16 } },
                        React.createElement("div", { style: { fontSize: 11, color, fontWeight: 700, letterSpacing: 1, textTransform: "uppercase", marginBottom: 12 } }, label),
                        React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 20, color: "#f0ede8", marginBottom: 12 } }, fmt(currentStats[p].total)),
                        ["essential", "extra", "saving"].map(cat => (React.createElement("div", { key: cat, style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 5 } },
                            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 5 } },
                                React.createElement("div", { style: { width: 6, height: 6, borderRadius: "50%", background: CAT_COLORS[cat] } }),
                                React.createElement("span", { style: { fontSize: 11, color: "#888" } }, CAT_LABELS[cat])),
                            React.createElement("span", { style: { fontSize: 12, color: "#ccc" } }, fmt(currentStats[p][cat]))))),
                        React.createElement("div", { style: { marginTop: 10, height: 5, borderRadius: 3, overflow: "hidden", display: "flex" } }, ["essential", "extra", "saving"].map(cat => {
                            const w = currentStats[p].total > 0 ? (currentStats[p][cat] / currentStats[p].total) * 100 : 0;
                            return React.createElement("div", { key: cat, style: { width: `${w}%`, background: CAT_COLORS[cat] } });
                        })),
                        React.createElement("div", { style: { display: "flex", justifyContent: "space-between", marginTop: 4 } }, ["essential", "extra", "saving"].map(cat => {
                            const w = currentStats[p].total > 0 ? (currentStats[p][cat] / currentStats[p].total) * 100 : 0;
                            return w > 5 ? React.createElement("span", { key: cat, style: { fontSize: 9, color: CAT_COLORS[cat] } },
                                w.toFixed(0),
                                "%") : null;
                        })))))),
                    chartData.length > 0 && (React.createElement(React.Fragment, null,
                        React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 16, width: "100%" } },
                            React.createElement("div", { style: { background: "#141418", border: "1px solid #1f1f28", borderRadius: 16, padding: isMobile ? "14px 8px 8px" : "20px 16px 16px" } },
                                React.createElement("div", { style: { fontSize: isMobile ? 11 : 13, color: "#4a9eff", fontWeight: 700, letterSpacing: 1, textTransform: "uppercase", marginBottom: isMobile ? 10 : 18, paddingLeft: isMobile ? 0 : 28 } }, `üìä ${N1} ‚Äî ${t("monthlyPlanLabel")}`),
                                React.createElement(SimpleBarChart, { data: chartData, height: isMobile ? 200 : 420, showValues: !isMobile, bars: [
                                        { dataKey: "d_essential", name: t("essential"), fill: CAT_COLORS.essential },
                                        { dataKey: "d_extra", name: t("extra"), fill: CAT_COLORS.extra },
                                        { dataKey: "d_saving", name: t("saving"), fill: CAT_COLORS.saving }
                                    ] })),
                            React.createElement("div", { style: { background: "#141418", border: "1px solid #1f1f28", borderRadius: 16, padding: isMobile ? "14px 8px 8px" : "20px 16px 16px" } },
                                React.createElement("div", { style: { fontSize: isMobile ? 11 : 13, color: "#ff6b9d", fontWeight: 700, letterSpacing: 1, textTransform: "uppercase", marginBottom: isMobile ? 10 : 18, paddingLeft: isMobile ? 0 : 28 } }, `üìä ${N2} ‚Äî ${t("monthlyPlanLabel")}`),
                                React.createElement(SimpleBarChart, { data: chartData, height: isMobile ? 200 : 420, showValues: !isMobile, bars: [
                                        { dataKey: "c_essential", name: t("essential"), fill: CAT_COLORS.essential },
                                        { dataKey: "c_extra", name: t("extra"), fill: CAT_COLORS.extra },
                                        { dataKey: "c_saving", name: t("saving"), fill: CAT_COLORS.saving }
                                    ] })),
                            React.createElement("div", { style: { background: "#141418", border: "1px solid #1f1f28", borderRadius: 16, padding: isMobile ? "14px 8px 8px" : "20px 16px 16px" } },
                                React.createElement("div", { style: { fontSize: isMobile ? 11 : 13, color: "#e8c547", fontWeight: 700, letterSpacing: 1, textTransform: "uppercase", marginBottom: isMobile ? 10 : 18, paddingLeft: isMobile ? 0 : 28 } }, `üìä ${t("familyMonthlyLabel")}`),
                                React.createElement(SimpleBarChart, { data: chartData.map(d => (Object.assign(Object.assign({}, d), { diego_tot: d.d_essential + d.d_extra + d.d_saving, carmen_tot: d.c_essential + d.c_extra + d.c_saving }))), height: isMobile ? 200 : 380, showValues: !isMobile, bars: [
                                        { dataKey: "diego_tot", name: N1, fill: "#4a9eff" },
                                        { dataKey: "carmen_tot", name: N2, fill: "#ff6b9d" }
                                    ] }))))),
                    chartData.length === 0 && (React.createElement("div", { style: { textAlign: "center", color: "#333", fontSize: 13, padding: "40px 0" } }, "Inserisci i dati nel Plan per vedere i grafici"))));
            })(),
            (tab === "casa" && subTab === "bollette") && (() => {
                /* Internal Bollette sub-tab bar */
                const bSubTabs = [["inserimento","üìã Bollette"],["grafici","üìä Grafici"],["pellet","ü™µ Pellet"]];
                const renderBolletteInner = () => {
                if (bolletteSubTab === "grafici") { /* grafici */ }
                if (bolletteSubTab === "pellet") { /* pellet */ }
                }
                // Outer wrapper with internal tabs
                const bolletteTabBar = React.createElement("div", { style: { display: "flex", gap: 6, marginBottom: 20 } },
                    bSubTabs.map(([s, label]) => React.createElement("button", { key: s, onClick: () => setBolletteSubTab(s), style: { flex: 1, padding: "9px 0", borderRadius: 12, border: "none", fontFamily: "inherit", fontSize: 13, fontWeight: 600, cursor: "pointer", background: bolletteSubTab === s ? "#e8c547" : "#1a1a22", color: bolletteSubTab === s ? "#0d0d0f" : "#555" } }, label)));
                if (bolletteSubTab === "pellet") {
                    /* ‚îÄ‚îÄ‚îÄ PELLET content ‚îÄ‚îÄ‚îÄ */
                    var _a;
                    const sortedP = [...pelletLog].sort((a, b) => a.date.localeCompare(b.date));
                    let rimasti = 0;
                    let rows = sortedP.map((entry, i) => {
                        rimasti += (parseInt(entry.comprati) || 0) - (parseInt(entry.consumati) || 0);
                        const totalConsumed = sortedP.slice(0, i+1).reduce((a, e) => a + (parseInt(e.consumati)||0), 0);
                        const media = (i+1) > 0 ? totalConsumed / (i+1) : 0;
                        const giorniRimasti = media > 0 ? Math.floor(rimasti / media) : null;
                        const fineDate = giorniRimasti !== null ? (() => { const d = new Date(entry.date); d.setDate(d.getDate() + giorniRimasti); return d; })() : null;
                        return { ...entry, rimasti, media: media.toFixed(2), giorniRimasti, fineDate };
                    });
                    const latest = rows[rows.length - 1];
                    const formatDate = (d) => { const dt = new Date(d); return String(dt.getDate()).padStart(2,"0")+"/"+String(dt.getMonth()+1).padStart(2,"0")+"/"+dt.getFullYear(); };
                    const addOrUpdatePellet = () => {
                        if (!pelletForm.date) return;
                        if (editingPellet !== null) { savePelletLog(pelletLog.map(e => e.id === editingPellet ? {...e, ...pelletForm, comprati: parseInt(pelletForm.comprati)||0, consumati: parseInt(pelletForm.consumati)||0} : e)); setEditingPellet(null); }
                        else { savePelletLog([...pelletLog, { id: Date.now(), date: pelletForm.date, comprati: parseInt(pelletForm.comprati)||0, consumati: parseInt(pelletForm.consumati)||0 }]); }
                        setPelletForm({ date: today(), comprati: "", consumati: "" });
                        setShowPelletForm(false);
                    };
                    const startEditPellet = (entry) => { setEditingPellet(entry.id); setPelletForm({ date: entry.date, comprati: String(entry.comprati), consumati: String(entry.consumati) }); setShowPelletForm(true); };
                    const deletePellet = (id) => savePelletLog(pelletLog.filter(e => e.id !== id));
                    return React.createElement("div", null,
                        bolletteTabBar,
                        latest && React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10, marginBottom: 20 } },
                            React.createElement("div", { style: { background: "rgba(160,64,0,0.12)", border: "1px solid rgba(160,64,0,0.3)", borderRadius: 12, padding: "14px 16px", gridColumn: "1/-1" } },
                                React.createElement("div", { style: { fontSize: 10, color: "#a04000", letterSpacing: 1, textTransform: "uppercase", marginBottom: 6 } }, "Situazione attuale"),
                                React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center" } },
                                    React.createElement("div", null,
                                        React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 32, color: "#f0ede8" } }, latest.rimasti),
                                        React.createElement("div", { style: { fontSize: 11, color: "#888" } }, "sacchi rimasti")),
                                    React.createElement("div", { style: { textAlign: "right" } },
                                        React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 22, color: latest.giorniRimasti > 30 ? "#27ae60" : latest.giorniRimasti > 14 ? "#e67e22" : "#e74c3c" } }, (latest.giorniRimasti ?? "‚Äî") + " giorni"),
                                        latest.fineDate && React.createElement("div", { style: { fontSize: 12, color: "#888" } }, "finiscono il " + formatDate(latest.fineDate))))),
                            React.createElement("div", { style: { background: "#141418", border: "1px solid #1f1f28", borderRadius: 12, padding: "14px 16px" } },
                                React.createElement("div", { style: { fontSize: 10, color: "#555", textTransform: "uppercase", letterSpacing: 1, marginBottom: 6 } }, "Media/giorno"),
                                React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 22, color: "#e8c547" } }, latest.media),
                                React.createElement("div", { style: { fontSize: 11, color: "#555" } }, "sacchi")),
                            React.createElement("div", { style: { background: "#141418", border: "1px solid #1f1f28", borderRadius: 12, padding: "14px 16px" } },
                                React.createElement("div", { style: { fontSize: 10, color: "#555", textTransform: "uppercase", letterSpacing: 1, marginBottom: 6 } }, "Totale comprati"),
                                React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 22, color: "#a0d4ff" } }, sortedP.reduce((a,e) => a+(parseInt(e.comprati)||0), 0)),
                                React.createElement("div", { style: { fontSize: 11, color: "#555" } }, "sacchi"))),
                        !showPelletForm && !editingPellet ? React.createElement("button", { onClick: () => setShowPelletForm(true), style: { width: "100%", background: "#e8c547", color: "#0d0d0f", borderRadius: 12, padding: "13px", fontSize: 14, fontWeight: 700, marginBottom: 16, cursor: "pointer" } }, "‚ûï Nuova riga") :
                        React.createElement("div", { style: { background: "#141418", border: "1px solid #252530", borderRadius: 14, padding: 16, marginBottom: 16 } },
                            React.createElement("div", { style: { display: "flex", justifyContent: "space-between", marginBottom: 12 } },
                                React.createElement("div", { style: { fontSize: 11, color: "#555", letterSpacing: 1, textTransform: "uppercase" } }, editingPellet ? "‚úèÔ∏è Modifica riga" : "‚ûï Nuova riga"),
                                !editingPellet && React.createElement("button", { onClick: () => { setShowPelletForm(false); setPelletForm({ date: today(), comprati: "", consumati: "" }); }, style: { color: "#444", fontSize: 20 } }, "√ó")),
                            React.createElement("div", { style: { display: "flex", gap: 8, marginBottom: 10 } },
                                React.createElement("div", { style: { flex: 2 } },
                                    React.createElement("div", { style: { fontSize: 10, color: "#666", marginBottom: 4 } }, "Data"),
                                    React.createElement("input", { type: "date", value: pelletForm.date, onChange: e => setPelletForm(f => ({...f, date: e.target.value})) })),
                                React.createElement("div", { style: { flex: 1 } },
                                    React.createElement("div", { style: { fontSize: 10, color: "#a0d4ff", marginBottom: 4 } }, "üõí Comprati"),
                                    React.createElement("input", { type: "number", placeholder: "0", value: pelletForm.comprati, onChange: e => setPelletForm(f => ({...f, comprati: e.target.value})) })),
                                React.createElement("div", { style: { flex: 1 } },
                                    React.createElement("div", { style: { fontSize: 10, color: "#a04000", marginBottom: 4 } }, "üî• Consumati"),
                                    React.createElement("input", { type: "number", placeholder: "0", value: pelletForm.consumati, onChange: e => setPelletForm(f => ({...f, consumati: e.target.value})) }))),
                            React.createElement("div", { style: { display: "flex", gap: 8 } },
                                React.createElement("button", { onClick: () => { addOrUpdatePellet(); }, style: { flex: 1, background: "#e8c547", color: "#0d0d0f", borderRadius: 10, padding: "11px", fontSize: 13, fontWeight: 700 } }, editingPellet ? "üíæ Salva" : "Aggiungi"),
                                editingPellet && React.createElement("button", { onClick: () => { setEditingPellet(null); setPelletForm({ date: today(), comprati: "", consumati: "" }); }, style: { background: "#1f1f28", color: "#888", borderRadius: 10, padding: "11px 16px", fontSize: 13 } }, "Annulla"))),
                        rows.length === 0 ? React.createElement("div", { style: { textAlign: "center", color: "#333", fontSize: 13, padding: "40px 0" } }, "Aggiungi la prima riga per iniziare il tracking") :
                        React.createElement("div", null,
                            React.createElement("div", { style: { display: "grid", gridTemplateColumns: "72px 42px 42px 52px 52px 52px 36px", gap: 3, padding: "6px 8px", marginBottom: 4 } },
                                ["Data","üõí","üî•","Rim.","Med.","Gg",""].map((h,i) => React.createElement("div", { key: i, style: { fontSize: 9, color: "#555", fontWeight: 700, textTransform: "uppercase", textAlign: i > 1 ? "right" : "left" } }, h))),
                            React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 3 } },
                                [...rows].reverse().map((row, i) => {
                                    var _b;
                                    const isToday2 = row.date === today();
                                    return React.createElement("div", { key: row.id, style: { display: "grid", gridTemplateColumns: "72px 42px 42px 52px 52px 52px 36px", gap: 3, padding: "8px 8px", background: isToday2 ? "rgba(232,197,71,0.08)" : i%2===0 ? "#141418" : "#111115", borderRadius: 8, border: isToday2 ? "1px solid rgba(232,197,71,0.3)" : "1px solid transparent", alignItems: "center" } },
                                        React.createElement("div", { style: { fontSize: 12, color: isToday2 ? "#e8c547" : "#ccc" } }, formatDate(row.date)),
                                        React.createElement("div", { style: { fontSize: 12, color: row.comprati > 0 ? "#a0d4ff" : "#333", textAlign: "right", fontWeight: row.comprati > 0 ? 600 : 400 } }, row.comprati || "‚Äî"),
                                        React.createElement("div", { style: { fontSize: 12, color: row.consumati > 0 ? "#e67e22" : "#333", textAlign: "right" } }, row.consumati || "‚Äî"),
                                        React.createElement("div", { style: { fontSize: 12, color: "#f0ede8", textAlign: "right", fontWeight: 600 } }, row.rimasti),
                                        React.createElement("div", { style: { fontSize: 11, color: "#888", textAlign: "right" } }, row.media),
                                        React.createElement("div", { style: { fontSize: 12, color: row.giorniRimasti > 30 ? "#27ae60" : row.giorniRimasti > 14 ? "#e67e22" : "#e74c3c", textAlign: "right", fontWeight: 600 } }, (_b = row.giorniRimasti) !== null && _b !== void 0 ? _b : "‚Äî"),
                                        React.createElement("div", { style: { display: "flex", gap: 3, justifyContent: "flex-end" } },
                                            React.createElement("button", { onClick: () => startEditPellet(row), style: { fontSize: 11, color: "#555" } }, "‚úèÔ∏è"),
                                            React.createElement("button", { onClick: () => deletePellet(row.id), style: { fontSize: 13, color: "#2a2a35" } }, "√ó")));
                                }))));
                }
                if (bolletteSubTab === "grafici") {
                    /* ‚îÄ‚îÄ‚îÄ GRAFICI content ‚îÄ‚îÄ‚îÄ */
                    const sortedG = [...bollette].sort((a, b) => a.key.localeCompare(b.key));
                    const monthlyData = sortedG.map(b => { const [y, m] = b.key.split("-"); return { name: MONTHS[parseInt(m)-1].slice(0,3)+" "+y.slice(2), luce: Math.round(((parseFloat(b.luce)||0)-(parseFloat(b.pannelli)||0))*100)/100, pannelli: parseFloat(b.pannelli)||0, gas: parseFloat(b.gas)||0, pellet: parseFloat(b.pellet)||0, acqua: parseFloat(b.acqua)||0 }; });
                    const yearMap = {}; bollette.forEach(b => { const y = b.key.split("-")[0]; if(!yearMap[y]) yearMap[y]={luce:0,pannelli:0,gas:0,pellet:0,acqua:0}; yearMap[y].luce+=parseFloat(b.luce)||0; yearMap[y].pannelli+=parseFloat(b.pannelli)||0; yearMap[y].gas+=parseFloat(b.gas)||0; yearMap[y].pellet+=parseFloat(b.pellet)||0; yearMap[y].acqua+=parseFloat(b.acqua)||0; });
                    const yearlyData = Object.entries(yearMap).sort((a,b)=>b[0].localeCompare(a[0])).map(([y,v])=>({ name:y, luceNetta: Math.round((v.luce-v.pannelli)*100)/100, gas: Math.round(v.gas*100)/100, pellet: Math.round(v.pellet*100)/100, acqua: Math.round(v.acqua*100)/100 }));
                    const chartStyle = { background:"#141418", border:"1px solid #1f1f28", borderRadius:14, padding:"14px 8px 8px", marginBottom:14 };
                    const titleStyle2 = { fontSize:11, fontWeight:700, letterSpacing:0.8, textTransform:"uppercase", marginBottom:12, paddingLeft:8 };
                    if (monthlyData.length === 0) return React.createElement("div", null, bolletteTabBar, React.createElement("div", { style: { textAlign:"center",color:"#333",fontSize:13,padding:"40px 0" } }, "Inserisci dati nelle Bollette per vedere i grafici"));
                    return React.createElement("div", null,
                        bolletteTabBar,
                        React.createElement("div", { style: chartStyle }, React.createElement("div", { style: {...titleStyle2, color:"#f1c40f"} }, "‚ö° Luce Netta mensile"), React.createElement(SimpleBarChart, { data: monthlyData, height: 180, bars: [{ dataKey: "luce", name: "Luce netta", fill: "#f1c40f" }] })),
                        React.createElement("div", { style: chartStyle }, React.createElement("div", { style: {...titleStyle2, color:"#e67e22"} }, "üî• Gas e Pellet mensile"), React.createElement(SimpleBarChart, { data: monthlyData, height: 180, bars: [{ dataKey: "gas", name: "Gas", fill: "#e67e22" }, { dataKey: "pellet", name: "Pellet", fill: "#a04000" }] })),
                        React.createElement("div", { style: chartStyle }, React.createElement("div", { style: {...titleStyle2, color:"#3498db"} }, "üíß Acqua mensile"), React.createElement(SimpleBarChart, { data: monthlyData, height: 180, bars: [{ dataKey: "acqua", name: "Acqua", fill: "#3498db" }] })),
                        yearlyData.length > 0 && React.createElement(React.Fragment, null,
                            React.createElement("div", { style: chartStyle }, React.createElement("div", { style: {...titleStyle2, color:"#f1c40f"} }, "‚ö° Luce per Anno"), React.createElement(SimpleBarChart, { data: yearlyData, height: 180, bars: [{ dataKey: "luceNetta", name: "Luce netta", fill: "#f1c40f" }] })),
                            React.createElement("div", { style: chartStyle }, React.createElement("div", { style: {...titleStyle2, color:"#e67e22"} }, "üî• Gas & Pellet per Anno"), React.createElement(SimpleBarChart, { data: yearlyData, height: 180, bars: [{ dataKey: "gas", name: "Gas", fill: "#e67e22" }, { dataKey: "pellet", name: "Pellet", fill: "#a04000" }] })),
                            React.createElement("div", { style: chartStyle }, React.createElement("div", { style: {...titleStyle2, color:"#3498db"} }, "üíß Acqua per Anno"), React.createElement(SimpleBarChart, { data: yearlyData, height: 180, bars: [{ dataKey: "acqua", name: "Acqua", fill: "#3498db" }] }))));
                }
                /* ‚îÄ‚îÄ‚îÄ BOLLETTE INSERIMENTO content ‚îÄ‚îÄ‚îÄ */
                // falls through to original bollette code below
                const BCOLS = [
                    { id: "luce", label: "Luce", color: "#f1c40f", unit: "‚Ç¨" },
                    { id: "pannelli", label: "Pannelli", color: "#2ecc71", unit: "‚Ç¨", isCredit: true },
                    { id: "gas", label: "Gas", color: "#e67e22", unit: "‚Ç¨" },
                    { id: "pellet", label: "Pellet", color: "#a04000", unit: "‚Ç¨" },
                    { id: "acqua", label: "Acqua", color: "#3498db", unit: "‚Ç¨" },
                ];
                const getNetLuce = (row) => {
                    const luce = parseFloat(row.luce) || 0;
                    const pannelli = parseFloat(row.pannelli) || 0;
                    return luce - pannelli;
                };
                const getRowTotal = (row) => {
                    const netLuce = getNetLuce(row);
                    return netLuce + (parseFloat(row.gas) || 0) + (parseFloat(row.pellet) || 0) + (parseFloat(row.acqua) || 0);
                };
                const bKey = (m, y) => `${y}-${String(m + 1).padStart(2, "0")}`;
                const saveBollettaRow = (rowKey, field, value) => {
                    const existing = bollette.find(b => b.key === rowKey) || { key: rowKey };
                    const updated = Object.assign(Object.assign({}, existing), { [field]: value });
                    const newB = bollette.find(b => b.key === rowKey)
                        ? bollette.map(b => b.key === rowKey ? updated : b)
                        : [...bollette, updated];
                    saveBollette(newB);
                };
                const deleteBollettaRow = (rowKey) => saveBollette(bollette.filter(b => b.key !== rowKey));
                // Build list of all months with data + last 24 months
                const allBKeys = new Set(bollette.map(b => b.key));
                const now = new Date();
                for (let i = 0; i < 24; i++) {
                    const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
                    allBKeys.add(bKey(d.getMonth(), d.getFullYear()));
                }
                const sortedKeys = [...allBKeys].sort((a, b) => b.localeCompare(a));
                // Yearly summaries
                const yearTotals = {};
                bollette.forEach(b => {
                    const y = b.key.split("-")[0];
                    if (!yearTotals[y])
                        yearTotals[y] = { luce: 0, pannelli: 0, lucenet: 0, gas: 0, pellet: 0, acqua: 0 };
                    yearTotals[y].luce += parseFloat(b.luce) || 0;
                    yearTotals[y].pannelli += parseFloat(b.pannelli) || 0;
                    yearTotals[y].lucenet += getNetLuce(b);
                    yearTotals[y].gas += parseFloat(b.gas) || 0;
                    yearTotals[y].pellet += parseFloat(b.pellet) || 0;
                    yearTotals[y].acqua += parseFloat(b.acqua) || 0;
                });
                const years = Object.keys(yearTotals).sort((a, b) => b.localeCompare(a));
                const getRow = (k) => bollette.find(b => b.key === k) || {};
                return (React.createElement("div", null,
                    bolletteTabBar,
                    React.createElement("div", { style: { fontSize: 10, color: "#555", letterSpacing: 1.5, textTransform: "uppercase", marginBottom: 16 } }, t("bolletteTitle")),
                    years.length > 0 && (React.createElement("div", { style: { marginBottom: 20 } },
                        React.createElement("div", { style: { fontSize: 11, color: "#666", marginBottom: 10 } }, t("yearSummary")),
                        years.map(y => {
                            const yt = yearTotals[y];
                            const rowTotal = BCOLS.reduce((a, c) => a + (yt[c.id] || 0), 0);
                            return (React.createElement("div", { key: y, style: { background: "#141418", border: "1px solid #1f1f28", borderRadius: 12, padding: "12px 14px", marginBottom: 8 } },
                                React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 10 } },
                                    React.createElement("span", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 16, color: "#e8c547" } }, y),
                                    React.createElement("span", { style: { fontSize: 15, fontWeight: 600, color: "#f0ede8" } }, fmt(yearTotals[y].lucenet + yearTotals[y].gas + yearTotals[y].pellet + yearTotals[y].acqua))),
                                React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 6 } },
                                    yearTotals[y].luce > 0 && (React.createElement("div", { style: { background: "rgba(241,196,15,0.1)", border: "1px solid rgba(241,196,15,0.25)", borderRadius: 7, padding: "5px 10px" } },
                                        React.createElement("div", { style: { fontSize: 9, color: "#f1c40f", fontWeight: 700, marginBottom: 1 } }, t("netLuce").toUpperCase()),
                                        React.createElement("div", { style: { fontSize: 12, color: "#ccc" } }, fmt(yearTotals[y].lucenet)),
                                        yearTotals[y].pannelli > 0 && (React.createElement("div", { style: { fontSize: 9, color: "#2ecc71", marginTop: 2 } },
                                            "- Pannelli ",
                                            fmt(yearTotals[y].pannelli))))),
                                    [["gas", "#e67e22"], ["pellet", "#a04000"], ["acqua", "#3498db"]].filter(([id]) => yearTotals[y][id] > 0).map(([id, color]) => (React.createElement("div", { key: id, style: { background: `${color}15`, border: `1px solid ${color}30`, borderRadius: 7, padding: "5px 10px" } },
                                        React.createElement("div", { style: { fontSize: 9, color, fontWeight: 700, marginBottom: 1 } }, id.toUpperCase()),
                                        React.createElement("div", { style: { fontSize: 12, color: "#ccc" } }, fmt(yearTotals[y][id]))))))));
                        }))),
                    React.createElement("div", { style: { fontSize: 11, color: "#666", marginBottom: 10 } },
                        t("monthlyDetail"),
                        " "),
                    React.createElement("div", { style: { display: isMobile ? "flex" : "grid", flexDirection: "column", gridTemplateColumns: isMobile ? "1fr" : "repeat(auto-fill, minmax(420px, 1fr))", gap: 10 } }, sortedKeys.map(k => {
                        const [ky, km] = k.split("-");
                        const label = `${MONTHS[parseInt(km) - 1]} ${ky}`;
                        const row = getRow(k);
                        const hasData = BCOLS.some(c => parseFloat(row[c.id]) > 0) || row.note;
                        const rowTotal = getRowTotal(row);
                        const netLuce = getNetLuce(row);
                        const isExpanded = activeCell && activeCell.startsWith(k);
                        return (React.createElement("div", { key: k, style: { background: hasData ? "#141418" : "#0f0f12", border: `1px solid ${hasData ? "#1f1f28" : "#161618"}`, borderRadius: 12, overflow: "hidden" } },
                            React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "space-between", padding: "11px 14px" }, onClick: () => setActiveCell(isExpanded ? null : `${k}-luce`) },
                                React.createElement("span", { style: { fontSize: 13, color: hasData ? "#ddd" : "#333", fontWeight: hasData ? 500 : 400 } }, label),
                                React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } },
                                    rowTotal > 0 && React.createElement("span", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 14, color: "#e8c547" } }, fmt(rowTotal)),
                                    React.createElement("span", { style: { fontSize: 11, color: "#333" } }, isExpanded ? "‚ñ≤" : "‚ñº"))),
                            isExpanded && (React.createElement("div", { style: { borderTop: "1px solid #1a1a22", padding: "12px 14px", display: "flex", flexDirection: "column", gap: 10 } },
                                React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8 } },
                                    React.createElement("div", null,
                                        React.createElement("div", { style: { fontSize: 10, color: "#f1c40f", fontWeight: 700, letterSpacing: 0.8, marginBottom: 4 } }, t("luceSpesa")),
                                        React.createElement("div", { style: { position: "relative" } },
                                            React.createElement("span", { style: { position: "absolute", left: 10, top: "50%", transform: "translateY(-50%)", color: "#555", fontSize: 12 } }, "\u20AC"),
                                            React.createElement("input", { type: "number", placeholder: "0,00", value: row.luce || "", onChange: e => saveBollettaRow(k, "luce", e.target.value), style: { paddingLeft: 24, padding: "8px 10px 8px 24px", fontSize: 13, borderColor: parseFloat(row.luce) > 0 ? "rgba(241,196,15,0.4)" : undefined } }))),
                                    React.createElement("div", null,
                                        React.createElement("div", { style: { fontSize: 10, color: "#2ecc71", fontWeight: 700, letterSpacing: 0.8, marginBottom: 4 } }, t("pannelliCredit")),
                                        React.createElement("div", { style: { position: "relative" } },
                                            React.createElement("span", { style: { position: "absolute", left: 10, top: "50%", transform: "translateY(-50%)", color: "#555", fontSize: 12 } }, "\u20AC"),
                                            React.createElement("input", { type: "number", placeholder: "0,00", value: row.pannelli || "", onChange: e => saveBollettaRow(k, "pannelli", e.target.value), style: { paddingLeft: 24, padding: "8px 10px 8px 24px", fontSize: 13, borderColor: parseFloat(row.pannelli) > 0 ? "rgba(46,204,113,0.4)" : undefined } }))),
                                    (parseFloat(row.luce) > 0 || parseFloat(row.pannelli) > 0) && (React.createElement("div", { style: { gridColumn: "1/-1", background: "rgba(241,196,15,0.07)", border: "1px solid rgba(241,196,15,0.2)", borderRadius: 8, padding: "8px 12px", display: "flex", justifyContent: "space-between", alignItems: "center" } },
                                        React.createElement("span", { style: { fontSize: 11, color: "#888" } },
                                            t("netLuce"),
                                            " (",
                                            fmt(row.luce || 0),
                                            " \u2212 ",
                                            fmt(row.pannelli || 0),
                                            ")"),
                                        React.createElement("span", { style: { fontSize: 15, fontWeight: 600, color: netLuce <= 0 ? "#2ecc71" : "#f1c40f" } }, fmt(netLuce)))),
                                    [{ id: "gas", color: "#e67e22", label: "Gas" }, { id: "pellet", color: "#a04000", label: "Pellet" }, { id: "acqua", color: "#3498db", label: "Acqua" }].map(c => (React.createElement("div", { key: c.id },
                                        React.createElement("div", { style: { fontSize: 10, color: c.color, fontWeight: 700, letterSpacing: 0.8, marginBottom: 4 } }, c.label.toUpperCase()),
                                        React.createElement("div", { style: { position: "relative" } },
                                            React.createElement("span", { style: { position: "absolute", left: 10, top: "50%", transform: "translateY(-50%)", color: "#555", fontSize: 12 } }, "\u20AC"),
                                            React.createElement("input", { type: "number", placeholder: "0,00", value: row[c.id] || "", onChange: e => saveBollettaRow(k, c.id, e.target.value), style: { paddingLeft: 24, padding: "8px 10px 8px 24px", fontSize: 13, borderColor: parseFloat(row[c.id]) > 0 ? `${c.color}44` : undefined } })))))),
                                React.createElement("div", null,
                                    React.createElement("div", { style: { fontSize: 10, color: "#666", fontWeight: 700, letterSpacing: 0.8, marginBottom: 4 } }, t("note")),
                                    React.createElement("input", { type: "text", placeholder: "Note...", value: row.note || "", onChange: e => saveBollettaRow(k, "note", e.target.value), style: { fontSize: 13 } })),
                                hasData && (React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginTop: 2 } },
                                    React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 5 } }, BCOLS.filter(c => parseFloat(row[c.id]) > 0).map(c => (React.createElement("span", { key: c.id, style: { fontSize: 10, color: c.color } },
                                        "\u25CF ",
                                        c.label,
                                        ": ",
                                        fmt(row[c.id]))))),
                                    React.createElement("button", { onClick: () => { deleteBollettaRow(k); setActiveCell(null); }, style: { fontSize: 11, color: "#c0392b", padding: "4px 8px", border: "1px solid rgba(192,57,43,0.3)", borderRadius: 6 } }, "Elimina"))))),
                            !isExpanded && hasData && (React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 5, padding: "0 14px 10px" } },
                                (parseFloat(row.luce) > 0) && (React.createElement("span", { style: { fontSize: 10, color: "#f1c40f", background: "rgba(241,196,15,0.1)", borderRadius: 5, padding: "2px 7px" } },
                                    "Luce ",
                                    fmt(netLuce),
                                    parseFloat(row.pannelli) > 0 && React.createElement("span", { style: { color: "#2ecc71" } },
                                        " (-",
                                        fmt(row.pannelli),
                                        ")"))),
                                ["gas", "pellet", "acqua"].filter(id => parseFloat(row[id]) > 0).map(id => {
                                    const col = BCOLS.find(c => c.id === id);
                                    return React.createElement("span", { key: id, style: { fontSize: 10, color: col.color, background: `${col.color}12`, borderRadius: 5, padding: "2px 7px" } },
                                        col.label,
                                        " ",
                                        fmt(row[id]));
                                }),
                                row.note && React.createElement("span", { style: { fontSize: 10, color: "#666", fontStyle: "italic" } },
                                    "\"",
                                    row.note,
                                    "\"")))));
                    }))));
            })(),
            (tab === "entrate" && subTab === "storico") && (React.createElement("div", null,
                React.createElement("div", { style: { fontSize: 10, color: "#555", letterSpacing: 1.5, textTransform: "uppercase", marginBottom: 18 } }, t("storicoTitle")),
                historyEntries.length === 0 ? (React.createElement("div", { style: { textAlign: "center", color: "#333", fontSize: 13, padding: "40px 0" } }, t("noData"))) : (React.createElement("div", { style: { display: isMobile ? "flex" : "grid", flexDirection: "column", gridTemplateColumns: isMobile ? "1fr" : "repeat(auto-fill, minmax(420px, 1fr))", gap: 10 } }, historyEntries.map(e => (React.createElement("div", { key: e.key, style: { background: "#141418", borderRadius: 12, padding: 16 } },
                    React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "baseline", marginBottom: 10 } },
                        React.createElement("span", { style: { fontSize: 15, fontWeight: 500 } },
                            e.month,
                            " ",
                            e.year),
                        React.createElement("span", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 18, color: "#e8c547" } }, fmt(e.total))),
                    React.createElement("div", { style: { height: 5, borderRadius: 3, overflow: "hidden", display: "flex", marginBottom: 8 } },
                        React.createElement("div", { style: { width: `${e.dPct}%`, background: "#4a9eff" } }),
                        React.createElement("div", { style: { width: `${e.cPct}%`, background: "#ff6b9d" } })),
                    React.createElement("div", { style: { display: "flex", justifyContent: "space-between" } },
                        React.createElement("span", { style: { fontSize: 12, color: "#4a9eff" } },
                            N1,
                            " ",
                            fmt(e.diego),
                            " (",
                            e.dPct.toFixed(1),
                            "%)"),
                        React.createElement("span", { style: { fontSize: 12, color: "#ff6b9d" } },
                            N2,
                            " ",
                            fmt(e.carmen),
                            " (",
                            e.cPct.toFixed(1),
                            "%)")))))))))),
        /* ====== MUTUO ====== */
        (tab === "casa" && subTab === "mutuo") && (() => {
            const sorted = [...(Array.isArray(mutuoRate) ? mutuoRate : [])].sort((a, b) => b.data.localeCompare(a.data));
            const totPagato = (Array.isArray(mutuoRate) ? mutuoRate : []).reduce((acc, r) => acc + (parseFloat(r.totale) || 0), 0);
            const totCapitale = (Array.isArray(mutuoRate) ? mutuoRate : []).reduce((acc, r) => acc + (parseFloat(r.capitale) || 0), 0);
            const totInteressi = (Array.isArray(mutuoRate) ? mutuoRate : []).reduce((acc, r) => acc + (parseFloat(r.interessi) || 0), 0);
            const lastResidue = sorted.length > 0 ? (parseFloat(sorted[0].residuo) || 0) : 0;
            const formatD = (d) => { const dt = new Date(d); return String(dt.getDate()).padStart(2,"0") + "/" + String(dt.getMonth()+1).padStart(2,"0") + "/" + dt.getFullYear(); };
            const addOrUpdateMutuo = () => {
                if (!mutuoForm.data) return;
                if (editingMutuo !== null) {
                    saveMutuoRate((Array.isArray(mutuoRate) ? mutuoRate : []).map(r => r.id === editingMutuo ? {...r, ...mutuoForm} : r));
                    setEditingMutuo(null);
                } else {
                    saveMutuoRate([...(Array.isArray(mutuoRate) ? mutuoRate : []), { id: Date.now(), ...mutuoForm }]);
                }
                setMutuoForm({ data: today(), capitale: "", interessi: "", totale: "", residuo: "", note: "" });
                setShowMutuoForm(false);
            };
            const startEditMutuo = (r) => { setEditingMutuo(r.id); setMutuoForm({ data: r.data, capitale: r.capitale||"", interessi: r.interessi||"", totale: r.totale||"", residuo: r.residuo||"", note: r.note||"" }); setShowMutuoForm(true); };
            const deleteMutuo = (id) => saveMutuoRate((Array.isArray(mutuoRate) ? mutuoRate : []).filter(r => r.id !== id));
            return React.createElement("div", null,
                React.createElement("div", { style: { fontSize: 10, color: "#555", letterSpacing: 1.5, textTransform: "uppercase", marginBottom: 16 } }, t("mutuoTitle")),
                /* Overview cards */
                (Array.isArray(mutuoRate) && mutuoRate.length > 0) && React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10, marginBottom: 16 } },
                    React.createElement("div", { style: { background: "rgba(74,158,255,0.08)", border: "1px solid rgba(74,158,255,0.2)", borderRadius: 12, padding: "14px 16px", gridColumn: "1/-1" } },
                        React.createElement("div", { style: { fontSize: 10, color: "#4a9eff", letterSpacing: 1, textTransform: "uppercase", marginBottom: 6 } }, t("mutuoOverview")),
                        React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center" } },
                            React.createElement("div", null,
                                React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 26, color: "#e8c547" } }, fmt(totPagato)),
                                React.createElement("div", { style: { fontSize: 11, color: "#888" } }, t("mutuoTotalePagato"), " (", mutuoRate.length, " rate)")),
                            lastResidue > 0 && React.createElement("div", { style: { textAlign: "right" } },
                                React.createElement("div", { style: { fontSize: 10, color: "#555", marginBottom: 2 } }, "Residuo attuale"),
                                React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 20, color: "#e74c3c" } }, fmt(lastResidue))))),
                    React.createElement("div", { style: { background: "#141418", border: "1px solid #1f1f28", borderRadius: 12, padding: "14px 16px" } },
                        React.createElement("div", { style: { fontSize: 10, color: "#27ae60", textTransform: "uppercase", letterSpacing: 1, marginBottom: 6 } }, t("mutuoTotaleCapitale")),
                        React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 20, color: "#27ae60" } }, fmt(totCapitale))),
                    React.createElement("div", { style: { background: "#141418", border: "1px solid #1f1f28", borderRadius: 12, padding: "14px 16px" } },
                        React.createElement("div", { style: { fontSize: 10, color: "#e74c3c", textTransform: "uppercase", letterSpacing: 1, marginBottom: 6 } }, t("mutuoTotaleInteressi")),
                        React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 20, color: "#e74c3c" } }, fmt(totInteressi)))),
                /* Add button */
                !showMutuoForm && React.createElement("button", { onClick: () => setShowMutuoForm(true), style: { width: "100%", background: "#e8c547", color: "#0d0d0f", borderRadius: 12, padding: "13px", fontSize: 14, fontWeight: 700, marginBottom: 14, cursor: "pointer", display: "flex", alignItems: "center", justifyContent: "center", gap: 8 } }, t("mutuoAddRate")),
                /* Form */
                showMutuoForm && React.createElement("div", { style: { background: "#141418", border: "1px solid #2a2a35", borderRadius: 16, padding: 20, marginBottom: 16, maxWidth: 680, width: "100%" } },
                    React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 18 } },
                        React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: "#e8c547" } }, editingMutuo ? "‚úèÔ∏è " + t("mutuoEdit") : "‚ûï " + t("mutuoAddRate")),
                        React.createElement("button", { onClick: () => { setShowMutuoForm(false); setEditingMutuo(null); setMutuoForm({ data: today(), capitale: "", interessi: "", totale: "", residuo: "", note: "" }); }, style: { color: "#666", fontSize: 22, cursor: "pointer", background: "none", border: "none" } }, "√ó")),
                    React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 14 } },
                        React.createElement("div", null,
                            React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#ccc", marginBottom: 7, letterSpacing: 0.5, textTransform: "uppercase" } }, t("mutuoData")),
                            React.createElement("input", { type: "date", value: mutuoForm.data, onChange: e => setMutuoForm(f => ({...f, data: e.target.value})) })),
                        React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12 } },
                            React.createElement("div", null,
                                React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#27ae60", marginBottom: 7, letterSpacing: 0.5, textTransform: "uppercase" } }, t("mutuoCapitale")),
                                React.createElement("div", { style: { position: "relative" } },
                                    React.createElement("span", { style: { position: "absolute", left: 10, top: "50%", transform: "translateY(-50%)", color: "#555", fontSize: 12 } }, "‚Ç¨"),
                                    React.createElement("input", { type: "number", placeholder: "0,00", value: mutuoForm.capitale, onChange: e => setMutuoForm(f => ({...f, capitale: e.target.value})), style: { paddingLeft: 24 } }))),
                            React.createElement("div", null,
                                React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#e74c3c", marginBottom: 7, letterSpacing: 0.5, textTransform: "uppercase" } }, t("mutuoInteressi")),
                                React.createElement("div", { style: { position: "relative" } },
                                    React.createElement("span", { style: { position: "absolute", left: 10, top: "50%", transform: "translateY(-50%)", color: "#555", fontSize: 12 } }, "‚Ç¨"),
                                    React.createElement("input", { type: "number", placeholder: "0,00", value: mutuoForm.interessi, onChange: e => setMutuoForm(f => ({...f, interessi: e.target.value})), style: { paddingLeft: 24 } })))),
                        React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12 } },
                            React.createElement("div", null,
                                React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#e8c547", marginBottom: 7, letterSpacing: 0.5, textTransform: "uppercase" } }, t("mutuoTotale")),
                                React.createElement("div", { style: { position: "relative" } },
                                    React.createElement("span", { style: { position: "absolute", left: 10, top: "50%", transform: "translateY(-50%)", color: "#555", fontSize: 12 } }, "‚Ç¨"),
                                    React.createElement("input", { type: "number", placeholder: "0,00", value: mutuoForm.totale, onChange: e => setMutuoForm(f => ({...f, totale: e.target.value})), style: { paddingLeft: 24 } }))),
                            React.createElement("div", null,
                                React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#aaa", marginBottom: 7, letterSpacing: 0.5, textTransform: "uppercase" } }, t("mutuoResiduo")),
                                React.createElement("div", { style: { position: "relative" } },
                                    React.createElement("span", { style: { position: "absolute", left: 10, top: "50%", transform: "translateY(-50%)", color: "#555", fontSize: 12 } }, "‚Ç¨"),
                                    React.createElement("input", { type: "number", placeholder: "0,00", value: mutuoForm.residuo, onChange: e => setMutuoForm(f => ({...f, residuo: e.target.value})), style: { paddingLeft: 24 } })))),
                        React.createElement("div", null,
                            React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#ccc", marginBottom: 7, letterSpacing: 0.5, textTransform: "uppercase" } }, t("mutuoNote")),
                            React.createElement("input", { type: "text", placeholder: "Note...", value: mutuoForm.note, onChange: e => setMutuoForm(f => ({...f, note: e.target.value})) })),
                        React.createElement("button", { onClick: addOrUpdateMutuo, style: { width: "100%", background: "#e8c547", color: "#0d0d0f", borderRadius: 12, padding: "14px", fontSize: 15, fontWeight: 700, cursor: "pointer" } }, t("mutuoSave")))),
                /* Rate list */
                sorted.length === 0 ? React.createElement("div", { style: { textAlign: "center", color: "#333", fontSize: 13, padding: "40px 0" } }, t("mutuoNoRate")) :
                React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 8 } },
                    (sorted || []).map(r => React.createElement("div", { key: r.id, style: { background: "#141418", border: "1px solid #1f1f28", borderRadius: 12, padding: "14px 16px" } },
                        React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 8 } },
                            React.createElement("div", { style: { fontSize: 14, fontWeight: 600, color: "#ddd" } }, formatD(r.data)),
                            React.createElement("div", { style: { display: "flex", gap: 8, alignItems: "center" } },
                                React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 18, color: "#e8c547" } }, fmt(parseFloat(r.totale) || 0)),
                                React.createElement("button", { onClick: () => startEditMutuo(r), style: { color: "#555", fontSize: 14 } }, "‚úèÔ∏è"),
                                React.createElement("button", { onClick: () => deleteMutuo(r.id), style: { color: "#2a2a35", fontSize: 18 } }, "√ó"))),
                        React.createElement("div", { style: { display: "flex", gap: 10 } },
                            React.createElement("span", { style: { fontSize: 11, color: "#27ae60" } }, "Capitale: ", fmt(parseFloat(r.capitale)||0)),
                            React.createElement("span", { style: { fontSize: 11, color: "#e74c3c" } }, "Interessi: ", fmt(parseFloat(r.interessi)||0)),
                            parseFloat(r.residuo) > 0 && React.createElement("span", { style: { fontSize: 11, color: "#888" } }, "Residuo: ", fmt(parseFloat(r.residuo)))),
                        r.note && React.createElement("div", { style: { fontSize: 11, color: "#555", marginTop: 4, fontStyle: "italic" } }, r.note)))));
        })(),

        /* ====== PROGETTI ====== */
        (tab === "casa" && subTab === "progetti") && (() => {
            const STATI = { in_corso: { label: "In corso", color: "#e67e22", bg: "rgba(230,126,34,0.15)" }, completato: { label: "Completato", color: "#27ae60", bg: "rgba(39,174,96,0.15)" }, preventivo: { label: "Preventivo", color: "#8e44ad", bg: "rgba(142,68,173,0.15)" }, sospeso: { label: "Sospeso", color: "#7f8c8d", bg: "rgba(127,140,141,0.15)" } };
            const totale = progetti.reduce((a, p) => a + (parseFloat(p.importo)||0), 0);
            const totPagato = progetti.filter(p => p.stato === "completato").reduce((a, p) => a + (parseFloat(p.importo)||0), 0);
            const addOrUpdateProgetto = () => {
                if (!progettoForm.nome) return;
                if (editingProgetto !== null) {
                    saveProgetti(progetti.map(p => p.id === editingProgetto ? {...p, ...progettoForm} : p));
                    setEditingProgetto(null);
                } else {
                    saveProgetti([...progetti, { id: Date.now(), ...progettoForm }]);
                }
                setProgettoForm({ nome: "", fornitore: "", categoria: "Ristrutturazione", data: today(), importo: "", stato: "in_corso", note: "" });
                setShowProgettiForm(false);
            };
            const deleteProgetto = (id) => saveProgetti(progetti.filter(p => p.id !== id));
            return React.createElement("div", null,
                React.createElement("div", { style: { fontSize: 10, color: "#555", letterSpacing: 1.5, textTransform: "uppercase", marginBottom: 16 } }, t("progettiTitle")),
                /* Summary */
                progetti.length > 0 && React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10, marginBottom: 16 } },
                    React.createElement("div", { style: { background: "#141418", border: "1px solid #222", borderRadius: 12, padding: "14px 16px" } },
                        React.createElement("div", { style: { fontSize: 10, color: "#555", textTransform: "uppercase", letterSpacing: 1, marginBottom: 4 } }, t("progettiTotale")),
                        React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 22, color: "#e8c547" } }, fmt(totale)),
                        React.createElement("div", { style: { fontSize: 11, color: "#444" } }, progetti.length, " progetti")),
                    React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 6 } },
                        React.createElement("div", { style: { background: "rgba(39,174,96,0.08)", border: "1px solid rgba(39,174,96,0.2)", borderRadius: 8, padding: "8px 12px" } },
                            React.createElement("div", { style: { fontSize: 9, color: "#27ae60", fontWeight: 700 } }, "COMPLETATI"),
                            React.createElement("div", { style: { fontSize: 14, color: "#27ae60" } }, fmt(totPagato))),
                        React.createElement("div", { style: { background: "rgba(230,126,34,0.08)", border: "1px solid rgba(230,126,34,0.2)", borderRadius: 8, padding: "8px 12px" } },
                            React.createElement("div", { style: { fontSize: 9, color: "#e67e22", fontWeight: 700 } }, "IN CORSO"),
                            React.createElement("div", { style: { fontSize: 14, color: "#e67e22" } }, fmt(totale - totPagato))))),
                /* Add button */
                !showProgettiForm && React.createElement("button", { onClick: () => setShowProgettiForm(true), style: { width: "100%", background: "#e8c547", color: "#0d0d0f", borderRadius: 12, padding: "13px", fontSize: 14, fontWeight: 700, marginBottom: 14, cursor: "pointer" } }, t("progettiAdd")),
                /* Form */
                showProgettiForm && React.createElement("div", { style: { background: "#141418", border: "1px solid #2a2a35", borderRadius: 16, padding: 20, marginBottom: 16, maxWidth: 680, width: "100%" } },
                    React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 18 } },
                        React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: "#e8c547" } }, editingProgetto ? "‚úèÔ∏è Modifica Progetto" : "‚ûï Nuovo Progetto"),
                        React.createElement("button", { onClick: () => { setShowProgettiForm(false); setEditingProgetto(null); }, style: { color: "#666", fontSize: 22, cursor: "pointer", background: "none", border: "none" } }, "√ó")),
                    React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 14 } },
                        React.createElement("div", null,
                            React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#e8c547", marginBottom: 7, letterSpacing: 0.5, textTransform: "uppercase" } }, "Nome Progetto *"),
                            React.createElement("input", { type: "text", placeholder: "es. Rifacimento bagno, Giardino...", value: progettoForm.nome, onChange: e => setProgettoForm(f => ({...f, nome: e.target.value})) })),
                        React.createElement("div", null,
                            React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#ccc", marginBottom: 7, letterSpacing: 0.5, textTransform: "uppercase" } }, "Fornitore / Artigiano"),
                            React.createElement("input", { type: "text", placeholder: "es. Idraulico Rossi...", value: progettoForm.fornitore, onChange: e => setProgettoForm(f => ({...f, fornitore: e.target.value})) })),
                        React.createElement("div", null,
                            React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#ccc", marginBottom: 7, letterSpacing: 0.5, textTransform: "uppercase" } }, "Categoria"),
                            React.createElement("input", { type: "text", placeholder: "es. Ristrutturazione, Impianti...", value: progettoForm.categoria, onChange: e => setProgettoForm(f => ({...f, categoria: e.target.value})) })),
                        React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12 } },
                            React.createElement("div", null,
                                React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#ccc", marginBottom: 7, letterSpacing: 0.5, textTransform: "uppercase" } }, "Data"),
                                React.createElement("input", { type: "date", value: progettoForm.data, onChange: e => setProgettoForm(f => ({...f, data: e.target.value})) })),
                            React.createElement("div", null,
                                React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#e8c547", marginBottom: 7, letterSpacing: 0.5, textTransform: "uppercase" } }, "Importo ‚Ç¨"),
                                React.createElement("div", { style: { position: "relative" } },
                                    React.createElement("span", { style: { position: "absolute", left: 10, top: "50%", transform: "translateY(-50%)", color: "#555", fontSize: 12 } }, "‚Ç¨"),
                                    React.createElement("input", { type: "number", placeholder: "0,00", value: progettoForm.importo, onChange: e => setProgettoForm(f => ({...f, importo: e.target.value})), style: { paddingLeft: 24 } })))),
                        React.createElement("div", null,
                            React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#ccc", marginBottom: 8, letterSpacing: 0.5, textTransform: "uppercase" } }, "Stato"),
                            React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 8 } },
                                Object.entries(STATI).map(([k, v]) =>
                                    React.createElement("button", { key: k, onClick: () => setProgettoForm(f => ({...f, stato: k})), style: { padding: "7px 16px", borderRadius: 20, fontSize: 13, fontWeight: 700, cursor: "pointer", background: progettoForm.stato === k ? v.color : "transparent", color: progettoForm.stato === k ? "#fff" : v.color, border: "1.5px solid " + v.color } }, v.label)))),
                        React.createElement("div", null,
                            React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#ccc", marginBottom: 7, letterSpacing: 0.5, textTransform: "uppercase" } }, "Note"),
                            React.createElement("input", { type: "text", placeholder: "Note aggiuntive...", value: progettoForm.note, onChange: e => setProgettoForm(f => ({...f, note: e.target.value})) })),
                        React.createElement("button", { onClick: addOrUpdateProgetto, style: { width: "100%", background: "#e8c547", color: "#0d0d0f", borderRadius: 12, padding: "14px", fontSize: 15, fontWeight: 700, cursor: "pointer" } }, t("progettiSave")))),
                /* List */
                progetti.length === 0 ? React.createElement("div", { style: { textAlign: "center", color: "#333", fontSize: 13, padding: "40px 0" } }, t("progettiNoData")) :
                React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 8 } },
                    [...progetti].sort((a,b) => b.data.localeCompare(a.data)).map(p => {
                        const stato = STATI[p.stato] || STATI.in_corso;
                        return React.createElement("div", { key: p.id, style: { background: "#141418", borderRadius: 12, padding: "14px 16px", borderLeft: "3px solid " + stato.color } },
                            React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 6 } },
                                React.createElement("div", null,
                                    React.createElement("div", { style: { fontSize: 14, fontWeight: 600, color: "#ddd", marginBottom: 3 } }, p.nome),
                                    p.fornitore && React.createElement("div", { style: { fontSize: 12, color: "#666" } }, p.fornitore)),
                                React.createElement("div", { style: { display: "flex", gap: 6, alignItems: "center" } },
                                    React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 16, color: "#e8c547" } }, fmt(parseFloat(p.importo)||0)),
                                    React.createElement("button", { onClick: () => { setEditingProgetto(p.id); setProgettoForm({ nome: p.nome, fornitore: p.fornitore||"", categoria: p.categoria||"", data: p.data, importo: p.importo||"", stato: p.stato, note: p.note||"" }); setShowProgettiForm(true); }, style: { color: "#555", fontSize: 14 } }, "‚úèÔ∏è"),
                                    React.createElement("button", { onClick: () => deleteProgetto(p.id), style: { color: "#2a2a35", fontSize: 18 } }, "√ó"))),
                            React.createElement("div", { style: { display: "flex", gap: 8, alignItems: "center" } },
                                React.createElement("span", { style: { fontSize: 10, fontWeight: 700, padding: "2px 8px", borderRadius: 20, background: stato.bg, color: stato.color } }, stato.label),
                                p.categoria && React.createElement("span", { style: { fontSize: 11, color: "#555" } }, p.categoria),
                                React.createElement("span", { style: { fontSize: 11, color: "#444" } }, new Date(p.data).toLocaleDateString("it-IT"))),
                            p.note && React.createElement("div", { style: { fontSize: 11, color: "#555", marginTop: 4, fontStyle: "italic" } }, p.note));
                    })));
        })(),

        /* ====== MEAL PLANNER ====== */
        tab === "meal" && (() => {
            const WEEKDAYS = ["Luned√¨","Marted√¨","Mercoled√¨","Gioved√¨","Venerd√¨","Sabato","Domenica"];
            const addOrUpdateRicetta = () => {
                if (!ricettaForm.nome) return;
                if (editingRicetta !== null) {
                    saveRicette(ricette.map(r => r.id === editingRicetta ? {...r, ...ricettaForm} : r));
                    setEditingRicetta(null);
                } else {
                    saveRicette([...ricette, { id: Date.now(), ...ricettaForm }]);
                }
                setRicettaForm({ nome: "", ingredienti: "", preparazione: "", tempi: "", porte: "4", note: "" });
                setShowRicettaForm(false);
            };
            const deleteRicetta = (id) => { saveRicette(ricette.filter(r => r.id !== id)); if (ricettaDetail === id) setRicettaDetail(null); };
            const shuffleWeek = () => {
                if (ricette.length < 2) return;
                const newWeek = {};
                WEEKDAYS.forEach(d => {
                    const pr = ricette[Math.floor(Math.random() * ricette.length)];
                    const ce = ricette[Math.floor(Math.random() * ricette.length)];
                    newWeek[d] = { pranzo: pr.id, cena: ce.id };
                });
                saveMealWeek(newWeek);
            };
            const getRicetta = (id) => ricette.find(r => r.id === id);
            /* Ricetta detail view */
            if (ricettaDetail) {
                const r = getRicetta(ricettaDetail);
                if (!r) { setRicettaDetail(null); return null; }
                return React.createElement("div", null,
                    React.createElement("button", { onClick: () => setRicettaDetail(null), style: { color: "#e8c547", fontSize: 14, marginBottom: 16, display: "flex", alignItems: "center", gap: 6, background: "none", border: "none", cursor: "pointer" } }, "‚Üê Torna alle ricette"),
                    React.createElement("div", { style: { background: "#141418", border: "1px solid #252530", borderRadius: 16, padding: 20 } },
                        React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 24, color: "#e8c547", marginBottom: 16 } }, r.nome),
                        r.tempi && React.createElement("div", { style: { display: "flex", gap: 16, marginBottom: 16 } },
                            React.createElement("span", { style: { fontSize: 12, color: "#888" } }, "‚è± ", r.tempi, " min"),
                            r.porte && React.createElement("span", { style: { fontSize: 12, color: "#888" } }, "üçΩÔ∏è ", r.porte, " porzioni")),
                        r.ingredienti && React.createElement("div", { style: { marginBottom: 16 } },
                            React.createElement("div", { style: { fontSize: 11, color: "#e8c547", fontWeight: 700, letterSpacing: 1, textTransform: "uppercase", marginBottom: 8 } }, "Ingredienti"),
                            React.createElement("div", { style: { fontSize: 14, color: "#ccc", lineHeight: 1.7, whiteSpace: "pre-wrap" } }, r.ingredienti)),
                        r.preparazione && React.createElement("div", { style: { marginBottom: 16 } },
                            React.createElement("div", { style: { fontSize: 11, color: "#e8c547", fontWeight: 700, letterSpacing: 1, textTransform: "uppercase", marginBottom: 8 } }, "Preparazione"),
                            React.createElement("div", { style: { fontSize: 14, color: "#ccc", lineHeight: 1.8, whiteSpace: "pre-wrap" } }, r.preparazione)),
                        r.note && React.createElement("div", { style: { background: "rgba(232,197,71,0.07)", border: "1px solid rgba(232,197,71,0.2)", borderRadius: 8, padding: "10px 14px", fontSize: 13, color: "#888", fontStyle: "italic" } }, r.note)));
            }
            return React.createElement("div", null,
                /* meal content */
                /* RICETTE */
                mealSubTab === "ricette" && React.createElement("div", null,
                    !showRicettaForm && !editingRicetta && React.createElement("button", { onClick: () => setShowRicettaForm(true), style: { width: "100%", maxWidth: 520, background: "#e8c547", color: "#0d0d0f", borderRadius: 12, padding: "13px", fontSize: 14, fontWeight: 700, marginBottom: 16, cursor: "pointer", display: "block" } }, t("mealAddRicetta")),
                    showRicettaForm && React.createElement("div", { style: { background: "#141418", border: "1px solid #2a2a35", borderRadius: 16, padding: 20, marginBottom: 16, maxWidth: 680, width: "100%" } },
                        React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 18 } },
                            React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: "#e8c547" } }, editingRicetta ? "‚úèÔ∏è Modifica Ricetta" : "‚ûï " + t("mealAddRicetta")),
                            React.createElement("button", { onClick: () => { setShowRicettaForm(false); setEditingRicetta(null); setRicettaForm({ nome:"", ingredienti:"", preparazione:"", tempi:"", porte:"4", note:"" }); }, style: { color: "#666", fontSize: 22, cursor: "pointer", background: "none", border: "none" } }, "√ó")),
                        React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 14 } },
                            React.createElement("div", null,
                                React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#e8c547", marginBottom: 6, textTransform: "uppercase", letterSpacing: 0.4 } }, t("mealNome") + " *"),
                                React.createElement("input", { type: "text", value: ricettaForm.nome, onChange: e => setRicettaForm(f => ({...f, nome: e.target.value})) })),
                            React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12 } },
                                React.createElement("div", null,
                                    React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#aaa", marginBottom: 6, textTransform: "uppercase", letterSpacing: 0.4 } }, t("mealTempi")),
                                    React.createElement("input", { type: "number", placeholder: "30", value: ricettaForm.tempi, onChange: e => setRicettaForm(f => ({...f, tempi: e.target.value})) })),
                                React.createElement("div", null,
                                    React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#aaa", marginBottom: 6, textTransform: "uppercase", letterSpacing: 0.4 } }, t("mealPorte")),
                                    React.createElement("input", { type: "number", placeholder: "4", value: ricettaForm.porte, onChange: e => setRicettaForm(f => ({...f, porte: e.target.value})) }))),
                            React.createElement("div", null,
                                React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#e8c547", marginBottom: 6, textTransform: "uppercase", letterSpacing: 0.4 } }, t("mealIngredienti")),
                                React.createElement("textarea", { rows: 4, placeholder: "Un ingrediente per riga...", value: ricettaForm.ingredienti, onChange: e => setRicettaForm(f => ({...f, ingredienti: e.target.value})), style: { width: "100%", background: "#181820", border: "1px solid #252530", color: "#f0ede8", borderRadius: 8, padding: "10px 14px", fontSize: 13, fontFamily: "inherit", resize: "vertical", outline: "none" } })),
                            React.createElement("div", null,
                                React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#e8c547", marginBottom: 6, textTransform: "uppercase", letterSpacing: 0.4 } }, t("mealPreparazione")),
                                React.createElement("textarea", { rows: 5, placeholder: "Passo 1: ...", value: ricettaForm.preparazione, onChange: e => setRicettaForm(f => ({...f, preparazione: e.target.value})), style: { width: "100%", background: "#181820", border: "1px solid #252530", color: "#f0ede8", borderRadius: 8, padding: "10px 14px", fontSize: 13, fontFamily: "inherit", resize: "vertical", outline: "none" } })),
                            React.createElement("div", null,
                                React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: "#aaa", marginBottom: 6, textTransform: "uppercase", letterSpacing: 0.4 } }, "Note"),
                                React.createElement("input", { type: "text", value: ricettaForm.note, onChange: e => setRicettaForm(f => ({...f, note: e.target.value})) })),
                            React.createElement("button", { onClick: addOrUpdateRicetta, style: { width: "100%", background: "#e8c547", color: "#0d0d0f", borderRadius: 12, padding: "14px", fontSize: 15, fontWeight: 700, cursor: "pointer" } }, t("mealSave")))),
                    ricette.length === 0 ? React.createElement("div", { style: { textAlign: "center", color: "#333", fontSize: 13, padding: "40px 0" } }, t("mealNoRicette")) :
                    React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 } },
                        ricette.map(r => React.createElement("div", { key: r.id, style: { background: "#141418", border: "1px solid #1f1f28", borderRadius: 12, padding: "14px 12px", cursor: "pointer", position: "relative" }, onClick: () => setRicettaDetail(r.id) },
                            React.createElement("div", { style: { fontFamily: "'DM Serif Display',serif", fontSize: 16, color: "#f0ede8", marginBottom: 6, lineHeight: 1.2 } }, r.nome),
                            React.createElement("div", { style: { display: "flex", gap: 10 } },
                                r.tempi && React.createElement("span", { style: { fontSize: 10, color: "#888" } }, "‚è±", r.tempi, "m"),
                                r.porte && React.createElement("span", { style: { fontSize: 10, color: "#888" } }, "üçΩÔ∏è", r.porte)),
                            React.createElement("div", { style: { position: "absolute", top: 8, right: 8, display: "flex", gap: 4 } },
                                React.createElement("button", { onClick: e => { e.stopPropagation(); setEditingRicetta(r.id); setRicettaForm({nome: r.nome, ingredienti: r.ingredienti||"", preparazione: r.preparazione||"", tempi: r.tempi||"", porte: r.porte||"4", note: r.note||""}); setShowRicettaForm(true); }, style: { color: "#555", fontSize: 12, background: "none", border: "none", cursor: "pointer" } }, "‚úèÔ∏è"),
                                React.createElement("button", { onClick: e => { e.stopPropagation(); deleteRicetta(r.id); }, style: { color: "#2a2a35", fontSize: 16, background: "none", border: "none", cursor: "pointer" } }, "√ó")))))),
                /* SETTIMANA */
                mealSubTab === "settimana" && React.createElement("div", null,
                    React.createElement("button", { onClick: shuffleWeek, disabled: ricette.length < 2, style: { width: "100%", background: ricette.length >= 2 ? "rgba(232,197,71,0.15)" : "#1a1a22", color: ricette.length >= 2 ? "#e8c547" : "#444", border: "1px solid " + (ricette.length >= 2 ? "rgba(232,197,71,0.3)" : "#252530"), borderRadius: 12, padding: "13px", fontSize: 14, fontWeight: 600, marginBottom: 16, cursor: ricette.length >= 2 ? "pointer" : "not-allowed" } }, t("mealShuffle"), ricette.length < 2 ? " (aggiungi almeno 2 ricette)" : ""),
                    React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 10 } },
                        WEEKDAYS.map(day => {
                            const dayMeal = mealWeek[day] || {};
                            const pr = getRicetta(dayMeal.pranzo);
                            const ce = getRicetta(dayMeal.cena);
                            return React.createElement("div", { key: day, style: { background: "#141418", border: "1px solid #1f1f28", borderRadius: 12, padding: "12px 16px" } },
                                React.createElement("div", { style: { fontSize: 12, color: "#e8c547", fontWeight: 700, marginBottom: 10, letterSpacing: 0.5 } }, day.toUpperCase()),
                                React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8 } },
                                    ...[["pranzo","‚òÄÔ∏è","mealPranzo",pr],["cena","üåô","mealCena",ce]].map(([meal, icon, key, rec]) =>
                                        React.createElement("div", { key: meal, style: { background: "#0f0f13", borderRadius: 8, padding: "8px 10px" } },
                                            React.createElement("div", { style: { fontSize: 9, color: "#555", fontWeight: 700, textTransform: "uppercase", marginBottom: 4 } }, icon + " " + t(key)),
                                            rec ? React.createElement("div", null,
                                                React.createElement("div", { style: { fontSize: 12, color: "#ddd", fontWeight: 500, marginBottom: 4 } }, rec.nome),
                                                React.createElement("div", { style: { display: "flex", gap: 4 } },
                                                    React.createElement("button", { onClick: () => setRicettaDetail(rec.id), style: { fontSize: 10, color: "#4a9eff", background: "none", border: "none", cursor: "pointer", padding: 0 } }, "Vedi"),
                                                    React.createElement("button", { onClick: () => { const newW = {...mealWeek}; if(!newW[day]) newW[day]={}; newW[day][meal]=undefined; saveMealWeek(newW); }, style: { fontSize: 10, color: "#555", background: "none", border: "none", cursor: "pointer", padding: 0 } }, "√ó"))) :
                                            React.createElement("div", null,
                                                React.createElement("div", { style: { fontSize: 11, color: "#333", marginBottom: 4 } }, "‚Äî"),
                                                ricette.length > 0 && React.createElement("select", { value: "", onChange: e => { if(!e.target.value) return; const newW = {...mealWeek}; if(!newW[day]) newW[day]={}; newW[day][meal]=parseInt(e.target.value); saveMealWeek(newW); }, style: { fontSize: 10, padding: "3px 6px", borderRadius: 6, background: "#252530", border: "1px solid #333", color: "#888", width: "100%" } },
                                                    React.createElement("option", { value: "" }, "Scegli..."),
                                                    ricette.map(r => React.createElement("option", { key: r.id, value: r.id }, r.nome))))))));
                        }))));
        })(),

                isMobile && (React.createElement("div", { style: { position: "fixed", bottom: 0, left: 0, right: 0, background: "rgba(13,13,15,0.97)", backdropFilter: "blur(20px)", borderTop: "1px solid #1a1a22", display: "flex", paddingBottom: 20, zIndex: 50 } }, [["entrate", "üí∞", "tabEntrate"], ["budget", "üìã", "tabBudget"], ["spese", "üí∏", "tabSpese"], ["casa", "üè†", "tabCasa"], ["meal", "üçΩÔ∏è", "tabMeal"]].map(([t_, icon, tkey]) => (React.createElement("button", { key: t_, onClick: () => { setTab(t_); setSubTab(t_ === "entrate" ? "entrate_main" : t_ === "budget" ? "plan" : t_ === "spese" ? "uscite" : t_ === "casa" ? "bollette" : "ricette"); }, style: { flex: 1, display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center", padding: "12px 0 4px", border: "none", background: "none", cursor: "pointer", gap: 3, fontFamily: "inherit" } },
            React.createElement("div", { style: { fontSize: 22, lineHeight: 1, filter: tab === t_ ? "none" : "grayscale(1) opacity(0.35)", transition: "all 0.2s" } }, icon),
            React.createElement("div", { style: { fontSize: 10, fontWeight: tab === t_ ? 700 : 400, color: tab === t_ ? "#e8c547" : "#555", letterSpacing: 0.5, textTransform: "uppercase", transition: "all 0.2s" } }, t(tkey)),
            tab === t_ && React.createElement("div", { style: { width: 4, height: 4, borderRadius: "50%", background: "#e8c547" } }))))))));
}


          try {
            ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
          } catch(e) {
            document.getElementById('root').innerHTML = '<div style="color:#e74c3c;padding:40px;font-family:sans-serif">Errore: ' + e.message + '</div>';
          }
        });
      }

      // ‚îÄ‚îÄ Auth state observer ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      _auth.onAuthStateChanged(async (user) => {
        if (!user) {
          // Not logged in ‚Üí show auth screen
          document.getElementById('loading-screen').style.display = 'none';
          const authEl = document.getElementById('auth-screen');
          authEl.style.display = 'flex';
          // Load DM Serif for auth screen
          if (!document.querySelector('link[href*="DM+Serif"]')) {
            const l = document.createElement('link');
            l.rel = 'stylesheet';
            l.href = 'https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:wght@400;600;700&display=swap';
            document.head.appendChild(l);
          }
          return;
        }
        // Logged in ‚Üí find which family they belong to
        try {
          const famSnap = await _db.ref('userFamily/' + user.uid).once('value');
          const familyId = famSnap.val() || user.uid;
          // Expose logout + family info to React app
          window._authUser = user;
          window._logout = () => _auth.signOut().then(() => location.reload());
          window._getFamilyMeta = async () => {
            const m = await _db.ref('familyMeta/' + familyId).once('value');
            return m.val() || {};
          };
          startApp(familyId);
        } catch(e) {
          console.warn('Family lookup error:', e);
          startApp(user.uid);
        }
      });

    } catch(err) {
      document.getElementById('loading-screen').innerHTML = '<div style="color:#e74c3c;padding:40px;text-align:center;font-family:sans-serif">Errore: ' + err.message + '<br><br><button onclick="location.reload()" style="background:#e8c547;color:#000;border:none;padding:10px 20px;border-radius:8px;cursor:pointer">Ricarica</button></div>';
    }
  });
  </script>
</body>
</html>